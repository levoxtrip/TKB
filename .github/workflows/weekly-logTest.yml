name: Generate Weekly Newsletter

# Run this job every Monday at 9:00 AM (UTC)
on:
  schedule:
    - cron: '0 9 * * MON'

jobs:
  create-newsletter:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.x'

    - name: Generate list of new .md files
      id: new_files
      run: |
        last_week=$(date -d "7 days ago" +%Y-%m-%d)
        new_files=$(git log --diff-filter=A --since="$last_week" --name-only -- '*.md')
        
        # If there are no new files, set a default message
        if [ -z "$new_files" ]; then
          echo "No new markdown files added this week." > newsletter.md
        else
          echo "# Weekly Newsletter" > newsletter.md
          echo "## Newly Added Files (Last Week)" >> newsletter.md
          echo "$new_files" | while read file; do
            echo "- $file" >> newsletter.md
          done
        fi

    - name: Commit and push newsletter
      run: |
        git config --global user.name "levoxtrip"
        git config --global user.email "levoxtrip@gmail.com"
        git add newsletter.md
        git commit -m "Add weekly newsletter"
        git push
      if: success()

