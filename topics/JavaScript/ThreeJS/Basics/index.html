
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/levoxtrip/TKB/topics/JavaScript/ThreeJS/Basics/">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
  <title>TKB</title>

    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Basics - TKB" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://github.com/levoxtrip/TKB/assets/images/social/topics/JavaScript/ThreeJS/Basics.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://github.com/levoxtrip/TKB/topics/JavaScript/ThreeJS/Basics/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Basics - TKB" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://github.com/levoxtrip/TKB/assets/images/social/topics/JavaScript/ThreeJS/Basics.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#basics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
<p style="color:white;">If you would like to receive a weekly update of all new added content feel free to subscribe here</p>
<iframe src="https://embeds.beehiiv.com/0ab65b8f-52f8-42da-b9bd-369d93cfa498?slim=true" data-test-id="beehiiv-embed" height="52" frameborder="0" scrolling="no" style="margin: 0; border-radius: 0px !important; background-color: transparent;"></iframe>



          </div>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="TKB" class="md-header__button md-logo" aria-label="TKB" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TKB
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Basics
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../blog/" class="md-tabs__link">
          
  
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="TKB" class="md-nav__button md-logo" aria-label="TKB" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    TKB
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/category/general/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    General
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/category/til/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TIL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../../../tags/#tag:javascript" class="md-tag">Javascript</a>
      
    
      
      
      
        <a href="../../../../tags/#tag:threejs" class="md-tag">Three.js</a>
      
    
  </nav>



<h1 id="basics">Basics</h1>
<p>Three.JS is build on top of WebGL.
You can download the examples from the Three.JS site here
<a href="https://github.com/mrdoob/three.js/">Github Examples</a></p>
<p><img alt="Structure of Three.JS" src="./img/BasicStructureThree.JS.png" /></p>
<p>We create out of the single elements groups.</p>
<p>We have the <code>Scene</code> which holds all the information about the actual experience and the objects in a hierarchal way.
The <code>Camera</code> views the scene and tells the renderer what we looking at.
The <code>Renderer</code> responsible to give the user the images we want to see.</p>
<h1 id="hierarchal-structure-of-scene">Hierarchal structure of scene</h1>
<p>We have a parent-child relationship in our scene and between the meshes. Children of a parent will inherit
properties from the parent mesh.
So if we group elements the children of the group will be transformed relatively from the parents values.</p>
<h1 id="setup">Setup</h1>
<p>To install three js in your project <code>npm install three</code></p>
<p>To import the entire t3js library to our file
<code>import * as THREE from 'three'</code></p>
<h2 id="add-a-scene">Add a Scene</h2>
<p>The scene is like a container for objects, lights and particles etc.</p>
<p>In THREE.JS you can have one or multiple scenes. You add the meshes that you create to the Scenes you want.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">scene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">();</span>
</code></pre></div>
<h2 id="add-a-mesh">Add a Mesh</h2>
<p>A mesh is composed out of geometry(shape) and a material(surface color). We need to add both to the <code>Mesh</code> object. We then add the
mesh to the scene.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cubeGeo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BoxGeometry</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1">//We pass an object into the material containing all the options for that material</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cubeMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cubeMesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">cubeGeo</span><span class="p">,</span><span class="w"> </span><span class="nx">cubeMat</span><span class="p">);</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">cubeMesh</span><span class="p">);</span>
</code></pre></div>
<h2 id="create-a-group">Create a group</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Group</span><span class="p">();</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nx">group</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">cubeMesh</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nx">group</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">cubeMesh</span><span class="p">);</span>
</code></pre></div>
<p>By changing the transformations of the group we apply it to all the children of the group.</p>
<h2 id="add-a-camera">Add a Camera</h2>
<p>To see the elements in our scene we need to add a Camera</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nx">fieldOfView</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nx">aspectRatio</span><span class="p">,</span><span class="cm">/*window.innerWidth/window.innerHeight,*/</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nx">near</span><span class="w"> </span><span class="cm">/* everything closer thant this you wont see */</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="nx">further</span><span class="w"> </span><span class="cm">/*anything further than this you wont see*/</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="p">);</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="mf">75</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">  </span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">  </span><span class="mf">30</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="p">)</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="c1">// We need to move the camera back otherwise camera and object are both at (0,0,0)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">camera</span><span class="p">);</span>
</code></pre></div>
<p>We need to pass a canvas html element to our website that shows our Three.JS scene.
<code>canvas class="canvasClass"&gt;&lt;/canvas&gt;</code>
In the JS file we then grab that element and reference it to the renderer because it takes the canvas as an object as input.
<code>const canvas = document.querySelector('canvas.canvasClass)</code></p>
<h2 id="add-renderer">Add renderer</h2>
<p>The renderer renders the scene from the camera point of view and draws it onto a canvas.
We need to specify the <code>canvas</code> property corresponding to the HTML <code>&lt;canvas&gt;</code> element that we add to the page.
For that we can use<code>document.querySelector(...)</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">//Because we gonna use the canvas often for multiple operations it makes sense to assign it to a variablle</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;canvasClassName&#39;</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span><span class="p">({</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="nx">canvas</span><span class="o">:</span><span class="nx">canvas</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">})</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1">//To specify how big it should be rendered</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span><span class="nx">camera</span><span class="p">);</span>
</code></pre></div>
<p>If we would just call <code>renderer.render(...)</code> it would just render the scene one time.</p>
<p>In order to render the scene on every frame we create a function that executes at the speed of
the browsers framerate. We then call the renderer in that function. At the end we need to call
the function one time so it goes into the loop.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">animate</span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span><span class="nx">camera</span><span class="p">);</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">animate</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">}</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nx">animate</span><span class="p">();</span>
</code></pre></div>
<p>So anytime we want to make changes to the scene we need to set it before we call the animate loop because
renderer basically takes a snapshot of the current scene and shows it for that frame.</p>
<h1 id="change-background-of-scene">Change background of Scene</h1>
<p>We can change the background of our scene with
<code>scene.background = new THREE.Color(0xffffff)</code></p>
<h2 id="make-the-background-of-our-scene-transparent-fox-elastic-scroll">Make the Background of our Scene transparent / Fox elastic scroll</h2>
<p>To make the background of our scene not black but transparent
we can set <code>alpha:true</code> in the renderer</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Renderer</span><span class="p">({</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nx">canvas</span><span class="o">:</span><span class="nx">canvas</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="nx">alpha</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">})</span>
</code></pre></div>
<p>or you can use the <code>.setClearColor()</code> method to set a specific color or <code>.setClearAlpha(0)</code>
for the clear Alpha.</p>
<h1 id="resizing-scenecanvas-depending-on-screen-size">Resizing Scene/Canvas depending on screen size</h1>
<p>To make the canvas fit our viewport we use <code>window.innerWidth/.innerHeight</code></p>
<p>We also need to get rid of the default margins of the browsers</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="o">*</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">}</span>
</code></pre></div>
<p>To fix the canvas at the top</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">.</span><span class="nc">canvas</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">fixed</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="k">left</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="k">outline</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span><span class="w"> </span><span class="c">/*blue outline when drag and dropping*/</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="p">}</span>
</code></pre></div>
<p>To remove any kind of scrolling we can use</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">html</span><span class="o">,</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="p">}</span>
</code></pre></div>
<p>To handle resizing the canvas we need to know when the window gets resized.
For that we listen to the <code>resize</code> event of the window.
<code>window.addEventListener("resize", () =&gt; {})</code></p>
<p>When we do changes to the camera and the <code>camera.aspect</code> we need to call <code>camera.updateProjectionMatrix()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">//(eventName, callback function)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="nx">camera</span><span class="p">.</span><span class="nx">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="nx">camera</span><span class="p">.</span><span class="nx">updateProjectionMatrix</span><span class="p">();</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="p">})</span>
</code></pre></div>
<h1 id="handling-pixel-ratio">Handling pixel ratio</h1>
<p>Because different devices can have different pixel ratios we should
adapt the <code>pixelRatio</code> of the renderer to the pixel ratio to the
screen of our device.
To avoid performance issues on devices with higher pixel ratios we
set the maximum pixel ratio to 2 with the <code>Math.min()</code>.</p>
<p><code>renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))</code></p>
<p>We add this to the <code>window.addEventListener("resize",()=&gt;{})</code></p>
<h1 id="fullscreen">Fullscreen</h1>
<p>You first need to decide what interaction will trigger the fullscreen.
You could use a HTML button or a double click for example.
To toggle between fullscreen and no fullscreen every time we
execute the action we check if window is already in fullscreen.
The fullscreen method is linked with the html-element. So we need
to define which element we want to show in fullscreen.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;dblclick&quot;</span><span class="p">,()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="p">){</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">requestFullscreen</span><span class="p">()</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">exitFullscreen</span><span class="p">()</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="p">})</span>
</code></pre></div>
<p>To make sure this also works in other browser like <em>Safari</em>
we need to extend this with <code>document.webkitFullscreen</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;dblclick&quot;</span><span class="p">,()=&gt;{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fullscreenElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">webkitFullscreenElement</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">fullscreenElement</span><span class="p">){</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">requestFullscreen</span><span class="p">){</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">      </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">requestFullscreen</span><span class="p">()</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">webkitRequestFullscreen</span><span class="p">){</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">      </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">webkitRequestFullscreen</span><span class="p">();</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">exitFullscreen</span><span class="p">){</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">exitFullscreen</span><span class="p">();</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">webkitExitFullscreen</span><span class="p">){</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">webkitExitFullscreen</span><span class="p">();</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="p">})</span>
</code></pre></div>
<h1 id="antialiasing">Antialiasing</h1>
<h2 id="get-the-device-pixel-ration-we-can-use">Get the device pixel ration we can use</h2>
<p><code>window.devicePixelRatio</code></p>
<h2 id="set-the-pixel-ration">Set the pixel ration</h2>
<p><code>renderer.setPixelRatio(window.devicePixelRatio)</code></p>
<p>Because of different devices and ultra high pixel ratios we want to limit the max pixel ratio so
the code stays performant</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">maxPixelRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span><span class="p">,</span><span class="mf">2</span><span class="p">);</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nx">renderer</span><span class="p">.</span><span class="nx">setPixelRatio</span><span class="p">(</span><span class="nx">maxPixelRatio</span><span class="p">);</span>
</code></pre></div>
<h2 id="add-antialisaing-to-renderer">Add antialisaing to renderer</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">renderer</span><span class="p">({</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="nx">canvas</span><span class="o">:</span><span class="nx">canvas</span><span class="p">,</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nx">antialias</span><span class="o">:</span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="p">})</span>
</code></pre></div>
<h1 id="transforming-objects">Transforming Objects</h1>
<p>When we set the different parameters and transformations to our meshes we set the <em>local</em> rotation, scale, and transform.</p>
<p>All classes that inherit from the <code>Object3D</code> class possess <code>position, scale, rotate, quaternion</code> properties.</p>
<p>All these properties will internally be compiled to Matrices by Three.JS.</p>
<h2 id="to-see-the-axes-in-our-scene">To see the axes in our scene</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">axesHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">AxesHelper</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">axesHelper</span><span class="p">);</span>
</code></pre></div>
<p>red = x
green = y
blue = z</p>
<h2 id="set-positions">Set Positions</h2>
<p>To set the position we can set the single axes</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nx">cubeMesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="c1">//x right,left</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nx">cubeMesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="c1">// backward/forward</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nx">cueMesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="c1">// up and down</span>
</code></pre></div>
<p>The unity of 1 is up to you. It can be 1 centimeter, 1 meter or even 1 kilometer. It makes sense to adapt the unit to the size of what you want to build.</p>
<p>We also can use a <code>Vector3</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nx">cubeMesh</span><span class="p">.</span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector3</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">);</span>
</code></pre></div>
<p>or even copy a vector to set the position</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tempPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vector3</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.8</span><span class="p">);</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nx">cubeMesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">tempPosition</span><span class="p">);</span>
</code></pre></div>
<h2 id="set-scale">Set Scale</h2>
<p>To set scale of single axis
<code>cubeMesh.scale.y = 2</code></p>
<p>or use <code>.set()</code> to set all three values at once
<code>cubeMesh.scale.set(1,2,3)</code></p>
<p>or
<code>group.scale.setScalar(2)</code></p>
<h2 id="set-rotation">Set Rotation</h2>
<p>There are two ways of handling rotations in Three.JS. You can use the <code>rotation</code> properties, which are expressed in <em>Euler</em> angles in radians.
To create like half a rotation you can use <code>Math.PI</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Euler</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">1.57</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;XYZ&#39;</span><span class="p">);</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="c1">//Convert Vector 3 to euler</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="nx">b</span><span class="p">.</span><span class="nx">applyEuler</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</code></pre></div>
<p>Rotate 90°
<code>cubeMesh.rotation.y = Math.PI/2</code></p>
<p>There is also a Three.JS utility we can use to convert radians to degree
<code>cubeMesh.rotation.y = THREE.MathUtils.degToRad(45)</code></p>
<p>We also can use the <code>.quaternion</code> to set the rotation of an element. It is another way to express rotation.</p>
<p>Three.JS by default will always apply the rotation by the order XYZ even when in the code the Y rotation comes
before the x rotation.</p>
<p>If you want to change the order how it applies the rotation we can use
<code>cubeMesh.rotation.reorder('YXZ')</code>. this needs to be called before we are calling the rotations</p>
<h2 id="look-at-object">Look at object</h2>
<p>The <code>.lookAt(new THREE.Vector3(0,-1,0))</code> method allows us to let an object look at a certain point,object or position. The object will automatically rote its <code>-z</code> axis towards the target.</p>
<h1 id="animations">Animations</h1>
<p>We want to execute a function that moves the objects and renders each frame regardless of the frame rate.</p>
<p>For that we can use the JS function <code>window.requestAnimationFrame()</code>.
It executes the function you provide it <em>on the next frame</em>.</p>
<p>To get reference of the time we can initialize a clock.</p>
<p><code>const clock = new THREE.Clock()</code></p>
<p>With <code>clock.getElapsedTime()</code> we get the difference between when the method got called and when we first initialized the clock.</p>
<h2 id="get-delta-time">Get delta time</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Clock</span><span class="p">();</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">previousTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">renderLoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clock</span><span class="p">.</span><span class="nx">getElapsedTime</span><span class="p">();</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">previousTime</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">  </span><span class="nx">previousTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">renderLoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">deltaTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentTime</span><span class="o">-</span><span class="nx">time</span><span class="p">;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">  </span><span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.01</span><span class="w"> </span><span class="o">*</span><span class="nx">deltaTime</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="p">}</span>
</code></pre></div>
<p>With that <code>delta</code> we can create experiences that are independent of the speed of your device.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Clock</span><span class="p">();</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">previousTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">renderLoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">currenTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clock</span><span class="p">.</span><span class="nx">getElapsedTime</span><span class="p">();</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentTime</span><span class="o">-</span><span class="nx">previousTime</span><span class="p">;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">  </span><span class="nx">previousTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currenTime</span><span class="p">;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">  </span><span class="nx">cubeMesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MathUtils</span><span class="p">.</span><span class="nx">degToRad</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">delta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">20</span><span class="p">;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">  </span><span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span><span class="nx">camera</span><span class="p">);</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">renderLoop</span><span class="p">)</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="p">}</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="nx">renderLoop</span><span class="p">()</span>
</code></pre></div>
<h2 id="rotate-object-in-circle">Rotate object in circle</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Clock</span><span class="p">();</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">renderLoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">getElapsedTime</span><span class="p">();</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">);</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">);</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="p">}</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="nx">renderLoop</span><span class="p">();</span>
</code></pre></div>
<h2 id="let-objectcamera-follow-path">Let object/camera follow path</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">2</span><span class="p">),</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">2</span><span class="p">),</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">3</span><span class="p">),</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">2</span><span class="p">),</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="p">]</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="c1">//To close the path add true as second parameter to function</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">CatmullRowCurve3</span><span class="p">(</span><span class="nx">points</span><span class="p">);</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="kd">const</span><span class="w"> </span><span class="nx">animate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">time</span><span class="o">/</span><span class="mf">2000</span><span class="o">%</span><span class="mf">6</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="mf">6</span><span class="p">;</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">getPointAt</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">  </span><span class="nx">cam</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">  </span><span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">  </span><span class="nx">requestAnimationFrame</span><span class="p">();</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="p">}</span>
</code></pre></div>
<p>To orient the object we need the normalised tanged vector of the position.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">getTangentAt</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nx">normalize</span><span class="p">();</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nx">cam</span><span class="p">.</span><span class="nx">lookAt</span><span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">tangent</span><span class="p">));</span>
</code></pre></div>
<p>It gets interesting to use mouseScroll to move the animation.</p>
<p><a href="#scrolling">Scroll Interaction</a></p>
<h2 id="animate-with-a-library">Animate with a Library</h2>
<p>To get specific animations it can make sense to use specific JS animation libraries like <a href="https://gsap.com/">GSAP</a></p>
<h3 id="gsap">GSAP</h3>
<p>To add <code>GSAP</code> we need to at it to our project
<code>npm install --save gsap@latest</code></p>
<p><code>import gsap from 'gsap'</code></p>
<p>In <code>GSAP</code> we can create a <code>Tween</code> which is an animation from A to B
with <code>gsap.to(...)</code>
Because <code>GSAP</code> has a built-in <code>requestAnimationFrame</code> you don't need to update the animation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nx">gsap</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">,{</span><span class="nx">duration</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="nx">delay</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="nx">x</span><span class="o">:</span><span class="mf">2</span><span class="p">})</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">renderLoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span><span class="nx">camera</span><span class="p">);</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">renderLoop</span><span class="p">)</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="p">}</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="nx">renderLoop</span><span class="p">()</span>
</code></pre></div>
<h1 id="geometries">Geometries</h1>
<p>In Three.js geometries are composed out of vertices - which are point coordinates in 3D space - and
facets - which are triangles that join the vertices into surfaces.</p>
<p>Geometries are used to create Meshes but also for particles.</p>
<p>Three.js own geometries are called <em>primitives</em>.</p>
<h2 id="create-own-geometry">Create own Geometry</h2>
<p>If you want to create Geometry that is complex or with a precise shape it makes sense to create it in a 3D software. But for not to complex geometry we can use <code>new THREE.BufferGeometry();</code></p>
<p>We start with instantiating a BufferGeometry
<code>const buffGeo  = new THREE.BufferGeometry()</code></p>
<p>To add vertices to the geometry we save them in a JS <code>Float32Array</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">positionsArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Float32Array</span><span class="p">([</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// First vertex</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Second vertex</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w">  </span><span class="c1">// Third vertex</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="p">])</span>
</code></pre></div>
<p>Before you can pass the Array data into the <em>BufferGeometry</em> we need to transform it into a <em>BufferAttribute</em>.</p>
<p><code>const positionAttribute = new THREE.BufferAttribute(positionsArray,3)</code>
The <code>3</code> defines how many values define one vertex attribute.</p>
<p>Finally we can this attribute to the <em>BufferGeometry</em> by using <code>.setAttribute(nameAttribute,value)</code>
<code>geometry.setAttribute('position',positionAttribute)</code>
The Three.js shader will look for the <code>position</code> name to assign the values to the position of the vertices.
Then the faces will created depending of the order of the vertices in the array.</p>
<p>Another example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1">//Create geometry</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">geometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferGeometry</span><span class="p">()</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="c1">// Create Array with vertices points</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="c1">//Float32 Array only allows to store Floats and the length of the array is fixed</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="c1">//you also can set the length of the array with new Float32Array(9)</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Float32Array</span><span class="p">([</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">  </span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="c1">//First vertex</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">  </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="c1">//second vertex</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">  </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="c1">//third vertex</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">    </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">  </span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">  </span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="p">]);</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="c1">// pass array into BufferAttribute to store information about the position of the vertices</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="nx">geometry</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferAttribute</span><span class="p">(</span><span class="nx">vertices</span><span class="p">,</span><span class="mf">3</span><span class="p">));</span>
</code></pre></div>
<p>in <code>.setAttribute()</code> we also can manipulate the <code>uv</code>position of the vertices, <code>normals</code> etc.</p>
<p>The THREE.JS <em>primitives</em> also use <code>BufferGeometry</code> under the hood.</p>
<h3 id="create-random-triangles">Create random triangles</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">geo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferGeometry</span><span class="p">();</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="c1">//create 50 triangles = 450 values</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">50</span><span class="p">;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="c1">//50 *3 *3 = 50 triangle with 3 vertex points which need 3 values</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">ranTrianglePoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Float32Array</span><span class="p">(</span><span class="mf">50</span><span class="o">*</span><span class="mf">3</span><span class="o">*</span><span class="mf">3</span><span class="p">);</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="o">*</span><span class="mf">3</span><span class="o">*</span><span class="mf">3</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">  </span><span class="nx">ranTrianglePoints</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="mf">4</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="p">}</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">positionAttribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferAttribute</span><span class="p">(</span><span class="nx">ranTrianglePoints</span><span class="p">,</span><span class="mf">3</span><span class="p">);</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="nx">geo</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="nx">positionAttribute</span><span class="p">);</span>
</code></pre></div>
<iframe height="300" style="width: 100%;" scrolling="no" title="T3.JS - Random Triangles BuffferGeometry" src="https://codepen.io/levoxtrip/embed/ogNpWGw?default-tab=js%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href="https://codepen.io/levoxtrip/pen/ogNpWGw">
  T3.JS - Random Triangles BuffferGeometry</a> by levoxtrip (<a href="https://codepen.io/levoxtrip">@levoxtrip</a>)
  on <a href="https://codepen.io">CodePen</a>.
</iframe>

<h2 id="threejs-primitives">Three.js Primitives</h2>
<p>All Three.js inherit from the <code>ButterGeometry</code> class.
You can find all the primitive geometries from Three.JS in the documentation.</p>
<h3 id="boxgeometry">BoxGeometry</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BoxGeometry</span><span class="p">({</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="nx">width</span><span class="p">,</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span><span class="nx">height</span><span class="p">,</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">  </span><span class="nx">depth</span><span class="p">,</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">  </span><span class="nx">widthSegments</span><span class="p">,</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">  </span><span class="nx">heightSegments</span><span class="p">,</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">  </span><span class="nx">depthSegments</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="p">})</span>
</code></pre></div>
<h3 id="planegeometry">PlaneGeometry</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">plane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PlaneGeometry</span><span class="p">({</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="nx">width</span><span class="p">,</span><span class="nx">height</span><span class="p">,</span><span class="nx">widthSegments</span><span class="p">,</span><span class="nx">heightSegments</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="p">})</span>
</code></pre></div>
<h3 id="circlegeometry">CircleGeometry</h3>
<p><code>const geometry = new THREE.CircleGeometry(radius,segments)</code></p>
<h3 id="spheregeometry">SphereGeometry</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">sphereGeo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">32</span><span class="p">,</span><span class="mf">32</span><span class="p">)</span>
</code></pre></div>
<h3 id="conegeometry">ConeGeometry</h3>
<p><code>const geometry = new THREE.ConeGeometry(radius,height,radialSegments)</code></p>
<h3 id="cylindergeometry">CylinderGeometry</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cylinderGeometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">CylinderGeometry</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">32</span><span class="p">);</span>
</code></pre></div>
<h3 id="ringgeometry">RingGeometry</h3>
<p>To create a flat ring or a portion of a flat ring
<code>const ring = new THREE.RingGeometry(innerRadius,outerRadius,numSegments)</code></p>
<h3 id="torusgeometry">TorusGeometry</h3>
<p>To create a ring with thickness - like a donut
<code>const torus = new THREE.TorusGeometry(radius,radiusTube,radialSegments,tubularSegments,arc)</code></p>
<p>Other geometries are
<code>DodecahedronGeometry</code> - 12 faces sphere
<code>OctahedronGeometry</code> - 8 faces sphere
<code>TetrahedronGeometry</code> - 4 faces sphere</p>
<h3 id="shapegeometry">ShapeGeometry</h3>
<p>To create your own shapes</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">heartShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Shape</span><span class="p">();</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="nx">heartShape</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="nx">heartShape</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="nx">heartShape</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">7</span><span class="p">,</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="nx">heartShape</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">11</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">15.4</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">19</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="nx">heartShape</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">12</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">15.4</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">16</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">11</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">16</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="nx">heartShape</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">16</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">7</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">16</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="nx">heartShape</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">7</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<h3 id="tubegeometry">TubeGeometry</h3>
<p>Creates a tube that extrudes a long a 3d curve</p>
<p><code>const geometry = new THREE.TubeGeometry( path, 20, 2, 8, false );</code></p>
<h3 id="extrudegeometry">ExtrudeGeometry</h3>
<p>Creates extrudes geometry from a path shape.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">12</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8</span><span class="p">;</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Shape</span><span class="p">();</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="nx">shape</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="nx">shape</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="nx">shape</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="w"> </span><span class="nx">length</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="nx">shape</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="w"> </span><span class="nx">length</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="nx">shape</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">extrudeSettings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="nx">steps</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">    </span><span class="nx">depth</span><span class="o">:</span><span class="w"> </span><span class="mf">16</span><span class="p">,</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">    </span><span class="nx">bevelEnabled</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">    </span><span class="nx">bevelThickness</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">    </span><span class="nx">bevelSize</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="w">    </span><span class="nx">bevelOffset</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">    </span><span class="nx">bevelSegments</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="p">};</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="kd">const</span><span class="w"> </span><span class="nx">geometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">ExtrudeGeometry</span><span class="p">(</span><span class="w"> </span><span class="nx">shape</span><span class="p">,</span><span class="w"> </span><span class="nx">extrudeSettings</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<h3 id="lathegeometry">LatheGeometry</h3>
<p>Creates meshes with axial symmetry like vases. The lathe rotates around the Y Axis</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector2</span><span class="p">(</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="p">}</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">geometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">LatheGeometry</span><span class="p">(</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<h3 id="textgeometry">TextGeometry</h3>
<p>Because it is an add-on we need to import it
<code>import {TextGeometry} from 'three/addons/geometries/TextGeometry.js'</code></p>
<p>Three.js needs the font in a json format called typeface.
We can convert a font <a href="https://gero3.github.io/facetype.js/">here</a>
There are also fonts in the <code>/node_modules/three/examples/fonts/</code> which we can put in the <code>/static/</code> folder.
Another way is to directly import the json file in your script
<code>import typefaceFont from 'three/examples/fonts/helvetiker_regular.typeface.json</code></p>
<p>To load a font we need the Three.js class <code>FontLoader</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">TextGeometry</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three/addons/geometries/TextGeometry.js&#39;</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="p">...</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FontLoader</span><span class="p">();</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;fonts/helvetiker_regular.typeface.json&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nx">font</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">geometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextGeometry</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;Hello three.js!&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">        </span><span class="nx">font</span><span class="o">:</span><span class="w"> </span><span class="nx">font</span><span class="p">,</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">        </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">        </span><span class="nx">depth</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">        </span><span class="nx">curveSegments</span><span class="o">:</span><span class="w"> </span><span class="mf">12</span><span class="p">,</span>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="w">        </span><span class="nx">bevelEnabled</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">        </span><span class="nx">bevelThickness</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">        </span><span class="nx">bevelSize</span><span class="o">:</span><span class="w"> </span><span class="mf">8</span><span class="p">,</span>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">        </span><span class="nx">bevelOffset</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="w">        </span><span class="nx">bevelSegments</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span>
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>To create 3D fonts is quite some work for Three.js because of the amount of segments and vertices. Try to reduce the <code>curveSegments</code> and <code>bevelSegments</code> as much as you can.</p>
<h4 id="center-the-text">Center the text</h4>
<p>In Three.js geometry has a <em>bounding</em> which gives how much space the geometry takes in the scene. It can be a <em>sphere</em>(Default) or a _ box_.</p>
<p>We can use these boundings to position our text.
For text it makes sense to use a box as the bounding so we have to tell three.js to calculate the box
<code>textGeo.computeBoundingBox()</code>
<code>console.log(textGeometry.boundingBox)</code></p>
<p>We then look for the <code>.max</code> properties and move the geometry inside the mesh - so the mesh stays centered in the scene.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nx">textGeo</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span><span class="o">-</span><span class="nx">textGeo</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="o">-</span><span class="nx">textGeo</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span><span class="o">-</span><span class="nx">textGeo</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="p">)</span>
</code></pre></div>
<p>The bounding box has a bevel which we would need to subtract as well to be more precise.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nx">textGeo</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">  </span><span class="o">-</span><span class="nx">textGeo</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="o">-</span><span class="nx">textGeo</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="o">-</span><span class="nx">textGeo</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="o">-</span><span class="mf">0.02</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="p">)</span>
</code></pre></div>
<p>Three.js has a function for this to make it easier <code>.center()</code>
<code>textGeo.center()</code></p>
<h3 id="add-multiple-meshes-with-one-call">Add multiple Meshes with one call</h3>
<p><code>scene.add(plane,sphere,box)</code></p>
<h2 id="importing-geometries">Importing geometries</h2>
<p><em>GLTF</em> is the popular standard for importing models into Three.js.
It is very flexible and allows to have different sets of data. Not just for geometry and materials but also camera, light, animations etc.
It also supports different file formats like binary, json and embed textures.</p>
<p>If you just need a Geometry it also can make sense just to use a <em>OBJ</em>, <em>FBX</em></p>
<h3 id="gltf">GLTF</h3>
<p>GLTF can have different file formats and the most important are:</p>
<ul>
<li><a href="#gltf-1">glTF</a></li>
<li><a href="#gltf-binary">glTF-Binary</a></li>
<li><a href="#gltf-draco">glTF-Draco</a></li>
<li><a href="#gltf-embedded">glTF-Embedded</a></li>
</ul>
<p>To decide which format you gonna take depends on the use case how you want to handle the assets and its data.</p>
<p>If you want to be able to change the data it makes sense to use the <code>glTF-default</code>. It also makes loading faster because the files get loaded separately.
If you don't modify anything and you just want one file to handle it makes sense to use <code>glTF-binary</code>.</p>
<h4 id="gltf_1">glTF</h4>
<p>The .gltf, the default format, is a json file that contains information about the scene like lights, cameras, objects transformations materials. It doesn't contain information about the geometries or the textures. These are stored in the a binary file <code>.bin</code>. This file also stores information like uvs, vertex colors and more. The textures are stored associated <code>.png</code> files.</p>
<p>When we want to load our model from a <code>.gltf</code> we only load that file and it links to all the other corresponding files.</p>
<h4 id="gltf-binary">glTF-Binary</h4>
<p>This format contains all the information in just one file. This makes it a bit lighter and easier to load.
But also less flexible because you can't change it's data. For example you can't just change the compression of the texture because it is implemented in the binary.</p>
<h4 id="gltf-draco">glTF-Draco</h4>
<p>Similar to the <code>gltf</code> default format but the <em>buffer data</em> is compressed with a different algorithm - the <code>Draco alogrithm</code>.
It is also lighter as the default <code>gltf</code></p>
<h4 id="gltf-embedded">glTF-Embedded</h4>
<p>Like the <code>glTF-Binary</code> just one file but it is <em>JSON</em> data. The benefit of this format is that you have one file which is easily editable.</p>
<h3 id="load-in-gltf-files-into-threejs">Load in gltf files into THREE.JS</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">GLTFLoader</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three/examples/jsm/loaders/GLTFLoader.js&#39;</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GLTFLoader</span><span class="p">();</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">  </span><span class="p">(</span><span class="nx">gltf</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gltf</span><span class="p">);</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">  </span><span class="p">(</span><span class="nx">progress</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;progress&quot;</span><span class="p">)</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">progress</span><span class="p">)</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">  </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">GLTFLoader</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;three/examples/jsm/loaders/GLTFLoader&quot;</span><span class="p">;</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GLTFLoader</span><span class="p">();</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;src/assets/hand.glb&quot;</span><span class="p">,(</span><span class="nx">gltf</span><span class="p">)=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">);</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">  </span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">  </span><span class="c1">//When scaling it makes sense to scale the whole scene not just the single object</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">  </span><span class="nx">hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">);</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="p">})</span>
</code></pre></div>
<p>If you <em>gltf</em> contains of a whole scene with multiple objects or elements we can access the single children with</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nx">gltfLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">  </span><span class="s1">&#39;path&#39;</span><span class="p">,</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span><span class="p">(</span><span class="nx">gltf</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">    </span><span class="c1">//find the right index of child with console.log</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">    </span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">indexChild</span><span class="p">])</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="p">)</span>
</code></pre></div>
<p>When you move an object from one scene to another using:
<code>scene.add(gltf.scene.children[0]);</code>
you are simultaneously:</p>
<ul>
<li>Adding the first child of <code>gltf.scene</code> to <code>scene</code></li>
<li>Removing that child from <code>gltf.scene</code></li>
</ul>
<p>This causes the <code>gltf.scene.children</code> array to change dynamically as we move the objects.
If you loop through the array using a standard for loop or similar, you end up skipping elements because the array length and order change while iterating.</p>
<p>To avoid this we can ether use a <code>while</code> loop:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">while</span><span class="p">(</span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="p">}</span>
</code></pre></div>
<p>or instead of adding the elements from the gltf.scene we clone the children and add the clones to our Three.js scene.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">children</span><span class="p">]</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">child</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">children</span><span class="p">){</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">child</span><span class="p">);</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="p">}</span>
</code></pre></div>
<p>This way, you are iterating over a static list and moving each child without affecting the original array during the process.</p>
<p>And another way is to add the whole <code>gltf.scene</code>
<code>scene.add(gltf.scene)</code></p>
<h3 id="load-draco-gltf">Load Draco gltf</h3>
<p>To load gltf-draco files we need a special <code>DRACOLoader</code>. We also need to add the worker code into the our three.js project by copying the <em>Draco decoder folder</em>(folder is located in <code>/node_modules/three/examples/jsm/libs/</code>) into our <code>static</code> folder.</p>
<p>We then add the path to our <em>draco static folder</em>
<code>dracoLoader.setDecoderPath('/draco/')</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">DRACOLoader</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three/examples/jsm/loaders/DRACOLoader.js&#39;</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">dracoLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DracoLoader</span><span class="p">()</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="nx">dracoLoader</span><span class="p">.</span><span class="nx">setDecoderPath</span><span class="p">(</span><span class="s1">&#39;/draco/&#39;</span><span class="p">)</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="nx">gltfLoader</span><span class="p">.</span><span class="nx">setDRACOLoader</span><span class="p">(</span><span class="nx">dracoLoader</span><span class="p">)</span>
</code></pre></div>
<p>To decide if you use Draco or not depends of the size of your project. If you just have a small geometry file we don't need Draco. But if you want to load bigger models and you can accept can freezes at the beginning you should consider Draco.</p>
<h3 id="access-childs-of-element">Access Childs of element</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="w">      </span><span class="nx">firstFrameRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">paintingG3</span><span class="p">.</span><span class="nx">getObjectByName</span><span class="p">(</span><span class="s2">&quot;firstFrameRoom&quot;</span><span class="p">);</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">      </span><span class="nx">secondFrameRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">paintingG3</span><span class="p">.</span><span class="nx">getObjectByName</span><span class="p">(</span><span class="s2">&quot;SecondFrameRoom&quot;</span><span class="p">);</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">      </span><span class="nx">thirdFrameRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">paintingG3</span><span class="p">.</span><span class="nx">getObjectByName</span><span class="p">(</span><span class="s2">&quot;ThirdFrameRoom&quot;</span><span class="p">);</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">firstFrameRoom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;First Frame Room Mesh:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">firstFrameRoom</span><span class="p">);</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">        </span><span class="c1">// You can manipulate the mesh here</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">        </span><span class="nx">firstFrameRoom</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mh">0xff0000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Change color to red</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">secondFrameRoom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Second Frame Room Mesh:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">secondFrameRoom</span><span class="p">);</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">        </span><span class="c1">// Example of moving the mesh</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">        </span><span class="nx">secondFrameRoom</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">thirdFrameRoom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Third Frame Room Mesh:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">thirdFrameRoom</span><span class="p">);</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="w">        </span><span class="c1">// Example of changing visibility</span>
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a><span class="w">        </span><span class="nx">thirdFrameRoom</span><span class="p">.</span><span class="nx">visible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a>
<a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a><span class="w">      </span><span class="nx">paintingG3</span><span class="p">.</span><span class="nx">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Log the name of each child</span>
<a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isMesh</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a><span class="w">          </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Found a mesh:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">child</span><span class="p">);</span>
<a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a><span class="w">      </span><span class="p">});</span>
<a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a>
<a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a><span class="w">      </span><span class="c1">// Accessing a specific child by name or index</span>
<a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">firstChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">paintingG3</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;First child:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">firstChild</span><span class="p">);</span>
</code></pre></div>
<h3 id="access-animations-of-gltf">Access Animations of gltf</h3>
<p>GLTF supports animations.
The <code>gltf</code> object has an <code>animation</code> property which contains <code>AnimationClip</code>
To play an <code>AnimationClip</code> we need to create an <code>AnimationMixer</code>.
Each object that gets animated needs its own <code>AnimationClip</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mixer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GLTFLoader</span><span class="p">();</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,(</span><span class="nx">gltf</span><span class="p">)=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">  </span><span class="nx">mixer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">AnimationMixer</span><span class="p">(</span><span class="nx">gltf</span><span class="p">.</span><span class="nx">scene</span><span class="p">);</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">  </span><span class="c1">//adding AnimationClips to mixer</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">animationAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mixer</span><span class="p">.</span><span class="nx">clipAction</span><span class="p">(</span><span class="nx">gltf</span><span class="p">.</span><span class="nx">animations</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">  </span><span class="nx">animationAction</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="p">})</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="c1">//mixer must update each frame</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nx">mixer</span><span class="p">){</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">    </span><span class="nx">mixer</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">deltaTime</span><span class="p">);</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="p">}</span>
</code></pre></div>
<h2 id="particles">Particles</h2>
<p>With particles we can do dust, rain, snow, stars etc.
Each particle is one plane build out of two triangles which is always facing the camera.</p>
<h3 id="geometry">Geometry</h3>
<p>For the <code>Geometry</code> in Particles we use <code>BufferGeometry</code> which exists for all the standard mesh geometries like <code>SphereBufferGeometry</code> etc. <code>BufferGeometry</code> is more performant so it is better to use for Particles.
For every vertex on the <code>BufferGeometry</code> we gonna get one particle.</p>
<p><code>const particleBaseShape = new THREE.SphereBufferMaterial(radius,widthSubdivision,heightSubdivision)</code></p>
<h3 id="material">Material</h3>
<p>For the <code>Material</code> we can use the <code>PointsMaterial</code> which is optimized for particles and has also specific properties like
<code>size</code> and <code>sizeAttenuation</code>for particles.
<code>size</code> control the size of all particles
<code>sizeAttenuation</code> - should particles that are farther away be smaller than closer ones.</p>
<p>To change the color of the particle you can use the <code>color</code> property. We need to use the <code>THREE.Color</code> class for that after we created already the material.
<code>pointsMaterial.color = new THREE.Color('#ff88cc')</code></p>
<p>Similar to the other materials we also can load and assign a Texture to the particles.
<code>pointsMaterial.transparent = true</code></p>
<p>If you only want to keep the alpha values of the texture you can use the <code>.alphaMap</code>
<code>pointsMaterial.alphaMap = partTexture</code></p>
<p>If you want to have the whole texture assign it to <code>.map</code></p>
<p>The <code>color</code> property will affect the <code>Texture</code>.</p>
<h4 id="different-colors-for-each-particle">Different Colors for each particle</h4>
<p>To create varying colors for each of the particles we need to add a new <code>BufferAttribute</code> <code>color</code>. Then
we can use the same for-loop to assign for example random colors and set the Attribute at the end.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1">//Again here 3 because we have r,g,b values</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">positions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Float32Array</span><span class="p">(</span><span class="nx">count</span><span class="o">*</span><span class="mf">3</span><span class="p">);</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Float32Array</span><span class="p">(</span><span class="nx">count</span><span class="o">*</span><span class="mf">3</span><span class="p">);</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">count</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">  </span><span class="nx">colors</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">  </span><span class="nx">positions</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">10</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="p">}</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="nx">particles</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferAttribute</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span><span class="mf">3</span><span class="p">));</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="nx">particles</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferAttribute</span><span class="p">(</span><span class="nx">colors</span><span class="p">,</span><span class="mf">3</span><span class="p">));</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="c1">//At the end we need to active vertex colors in the material</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="nx">particlesMaterial</span><span class="p">.</span><span class="nx">vertexColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="c1">//Deactivate particlesMaterial.color = new THREE.Color...</span>
</code></pre></div>
<h4 id="improving-order-of-displaying-particles">Improving order of displaying particles</h4>
<p>WebGL is drawing in the same order how the particles got created and it doesn't know which particle is front of the other.This can cause some render artifacts. We can use different ways to improve this.</p>
<h5 id="alpha-test">Alpha Test</h5>
<p>With the alpha test we test if a pixel gets rendered or not depending on it's transparency.
The alpha test defines that every pixel under a threshold value is not gonna be rendered.
The default threshold is 0 so every pixel will be rendered. By changing it to like 0.001
we exclude all the pixel from being rendered that have an alpha value from 0.</p>
<p><code>pointMaterial.alphaTest = 0.001</code></p>
<h5 id="depthtest">DepthTest</h5>
<p>When rendering Three.js test if that object that gets drawn is closer than other already drawn object.
This is called <code>Depth testing</code>.
<code>particlesMaterial.depthTest = false</code> to disable.</p>
<p>Turning depthtesting of can create problems with other non particle objects in the scene.</p>
<h5 id="depthwrite">DepthWrite</h5>
<p>Three.js stores the depth of what is being drawn in a depth buffer. We can tell Three.js not to write the particles in the depth buffer.
<code>particlesMaterial.depthWrite = false</code>
Deactivating the <code>depthWrite</code> often can fix your problems.</p>
<h4 id="blending">Blending</h4>
<p>To create a nice effect when your particles overlap we can use <code>Blending</code>.
<code>particlesMaterial.depthWrite = false</code>
<code>particlesMaterial.blending = THREE.AdditiveBlending</code></p>
<p>The downside of this is that it can affect the performance of you scene.</p>
<p>You can find some particle textures <a href="https://www.kenney.nl/assets/particle-pack">here</a>;</p>
<p>Instead of creating an instance of <code>Mesh</code> we use <code>Points</code> instance.
<code>const particles = new THREE.Points(particleGeo,particleMat)</code></p>
<h3 id="custom-geometry">Custom Geometry</h3>
<p>To create our own geometry we start with a <code>BufferGeometry</code>, set the positions in an <code>Float32Array</code> and then assign
the values to the <code>position</code> attribute of the <code>BufferGeometry</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">partGeo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferGeometry</span><span class="p">();</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span><span class="p">;</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">positions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Float32Array</span><span class="p">(</span><span class="nx">count</span><span class="o">*</span><span class="mf">3</span><span class="p">);</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">  </span><span class="nx">positions</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="p">}</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="nx">partGeo</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferAttribute</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span><span class="mf">3</span><span class="p">));</span>
</code></pre></div>
<h3 id="animation">Animation</h3>
<p>There are multiple ways to animate particles.</p>
<h4 id="using-points-as-an-object">Using Points as an object</h4>
<p>You can move, scale, rotate the <code>Points</code> class like the other geometry.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clock</span><span class="p">.</span><span class="nx">getElapsedTime</span><span class="p">()</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">  </span><span class="nx">particles</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.3</span><span class="p">;</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="p">}</span>
</code></pre></div>
<p>This will animate all the particles as a whole.</p>
<h4 id="changing-attributes-of-particles">Changing Attributes of Particles</h4>
<p>To move the individual particles/ update the vertex positions, we have to change the <code>position</code> attribute of the Particle system.</p>
<p>The positions in the <code>Float32Array</code> are stored in an one dimensional array
<code>[p0.x,p0.y,p0.z,p1.x,p1.y,p1.z,...]</code>. If you for example only want to change all the y positions of the vertex
you need to loop through the array in certain steps.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">  </span><span class="c1">// ... elapsed time</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">&lt;</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">i3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="o">*</span><span class="mf">3</span><span class="p">;</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">    </span><span class="c1">//Move all the particles y position on Math.sin()</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">    </span><span class="nx">particlesGeometry</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">array</span><span class="p">[</span><span class="nx">i3</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="p">);</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">    </span><span class="c1">//We need to notify Three.js that the vertices changes</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">    </span><span class="nx">particlesGeometry</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">needsUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="p">}</span><span class="o">&gt;</span>
</code></pre></div>
<p>To get now the individual y positions depending on the x positions on the sin wave we need to get
the x position of the particle and add it to the <code>elapsedTime</code> in the <code>Math.sin</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clock</span><span class="p">.</span><span class="nx">elapsedTime</span><span class="p">()</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">count</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">i3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">count</span><span class="o">*</span><span class="mf">3</span><span class="p">;</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">particlesGeometry</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">position</span><span class="p">[</span><span class="nx">i3</span><span class="p">];</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">  </span><span class="nx">particlesGeometry</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">positions</span><span class="p">[</span><span class="nx">i3</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="o">+</span><span class="nx">x</span><span class="p">);</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="p">}</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="nx">particlesGeometry</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">needsUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="p">}</span>
</code></pre></div>
<p><mark>The problem with this technique is that is super costly on the performance because on every frame we are looping through the entire array</mark></p>
<p>It is more performant to create custom shaders.</p>
<h3 id="optimization">Optimization</h3>
<h1 id="fog">Fog</h1>
<p>To create fog around the center
<code>scene.fog = new THREE.Fog(0x000000,15,25);</code></p>
<p>You then should also set the renderer clear color to the fog color
<code>renderer.setClearColor('0x000000');</code></p>
<h1 id="calculate-distance-camera-and-a-certain-mesh">Calculate distance camera and a certain mesh</h1>
<p>We can use the distanceTo function to calculate it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nx">cubeMesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">distanceTo</span><span class="p">(</span><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>
</code></pre></div>
<p>So we actually can trigger something if the camera reaches an object. If the distance is &lt; than show something</p>
<h1 id="delete-margin-of-threejs-scene">Delete Margin of Three.JS scene</h1>
<p>Deletes the margin and the scrollbar</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">  </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">  </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="p">}</span>
</code></pre></div>
<h1 id="controls">Controls</h1>
<h2 id="controls_1">Controls</h2>
<p>Three.JS has a lot of different already pre-build controls integrated which you can use for interactions.
<img alt="Three.JS Controls" src="https://Three.JS.org/docs/index.html?q=controls#api/en/extras/Controls" /></p>
<p><em>DeviceOrientationControls:</em> Retrieves the device orientation of your device allows it and it rotates the camera accordingly.</p>
<p><em>FlyControls:</em> Enables you to move the camera like if you were on a spaceship. You can rotate on all 3 axes, go forward and backward.</p>
<p><em>FirstPersonControls:</em> Like the <em>FlyControls</em> but just with a fixed up axis. Like a flying bird that can't do a barrel roll.</p>
<p><em>PointerLockControls:</em> Its a JS API that hides the cursor, centers it, keeps sending the movement in the <code>mousemove</code> event callback. It allows you to create FPS games. But it just handles the camera rotation. Your have to do the camera position yourself.</p>
<p><em>OrbitControls:</em> Allows you to rotate around a point with the left mouse btn and translate with the right mouse btn, and zoom in with the mouse wheel.</p>
<p><em>TrackballControls:</em> They are similar to <em>OrbitControls</em> but without any limits for the vertical angle which allows upside down rotations.</p>
<h2 id="orbit-controls">Orbit Controls</h2>
<p>To import <em>OrbitCamera</em> we need to import it into our sketch
<code>import {OrbitControls} from 'three/addons/controls/OrbitControls.js'</code></p>
<p>Then set it in the code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">OrbitControls</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three/addons/controls/OrbitControls.js&#39;</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">controls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">OrbitControls</span><span class="p">(</span><span class="nx">camera</span><span class="p">,</span><span class="nx">canvas</span><span class="p">);</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="c1">//update controls in animate</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="kd">function</span><span class="w"> </span><span class="nx">animate</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">  </span><span class="c1">//required if controls.enableDamping or controls.autoRotate set to true</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">  </span><span class="nx">controls</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="p">}</span>
</code></pre></div>
<p>By default the <em>OrbitControls</em> is looking at the center of the scene.
With the <code>target</code> property we can change where it is looking.
<code>controls.target.y = -2</code></p>
<p>To smooth the animation of the <code>OrbitControls</code> we can use <code>.enableDamping</code> property and set it to <code>true</code>
<code>controls.enableDamping = true</code>
<code>controls.dampingFactor = 0.03;</code>
To let the orbit controls automatically rotate we can set
<code>controls.autoRotate = true;</code></p>
<h2 id="map-controls">Map controls</h2>
<p><a href="https://Three.JS.org/examples/misc_controls_map.html">Map Controls</a></p>
<h2 id="fly-controls">Fly controls</h2>
<p><a href="https://Three.JS.org/examples/misc_controls_fly.html">Fly Controls</a>
The camera follows where the mouse is without clicking thing mouse</p>
<h2 id="first-person-controls">First Person controls</h2>
<p>It goes under <em>pointerlock</em> in the examples.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">controls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PointerLockControls</span><span class="p">(</span><span class="nx">camera</span><span class="p">,</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="nx">controls</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;lock&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">  </span><span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">;</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="p">});</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="nx">controls</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;unlock&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">  </span><span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;block&#39;</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="p">}</span>
</code></pre></div>
<h2 id="drag-controls">Drag controls</h2>
<p>Drag elements
<a href="https://Three.JS.org/examples/?q=controls#misc_controls_drag">Trackball Controls</a></p>
<h2 id="trackball-controls">Trackball controls</h2>
<p><a href="https://Three.JS.org/examples/misc_controls_trackball.html">Trackball Controls</a></p>
<h1 id="camera">Camera</h1>
<p>By default, in Three.js the field of view is vertical meaning if you put objects at the top and bottom and then
rescale your window you still see them at the top and bottom part - they don't disappear.</p>
<h2 id="perspectivecamera">PerspectiveCamera</h2>
<p><em>FOV</em>: The field of view is how large your vision angle is.
The bigger that angle the more you can see from the scene/experience but also the elements in that scene get smaller and more distorted.
The smaller the angle the less you can see from the scene but the elements are gonna appear larger.
<img alt="Field of View" src="https://github.com/PineappleBeer/Three.JS-journey/raw/master/03-basic-scene/files/video-1.gif" /></p>
<p>In conventional photography a lot of people use 50° or 35° field of view. Play with values between <code>45</code> and <code>75</code></p>
<p><code>const camera = new THREE.PerspectiveCamera()</code></p>
<p><em>Aspect Ratio</em>- In most cases the width of the canvas divided by the height.</p>
<p><em>Near</em> - Anything within the distance between your camera and the near property you won't be able to see. Stick with numbers like 0.1 or 0.3. Values can be imagined in meters
<em>Far</em> - Anything after the distance between your camera and the far property you won'T be able to see. Stick numbers like 200.</p>
<h3 id="define-how-farclose-orbin-camera-can-move">Define how far/close orbin camera can move</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">controls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">OrbitControls</span><span class="p">(</span><span class="nx">camera</span><span class="p">,</span><span class="nx">renderer</span><span class="p">,</span><span class="nx">domElement</span><span class="p">);</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="nx">controls</span><span class="p">.</span><span class="nx">minDistance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="nx">controls</span><span class="p">.</span><span class="nx">maxDistance</span><span class="o">=</span><span class="mf">15</span><span class="p">;</span>
</code></pre></div>
<h3 id="look-at-specific-target-with-orbit-camera">Look at specific target with orbit camera</h3>
<p><code>controls.targer.set(0,0,0)</code></p>
<h2 id="orthographic-camera">Orthographic camera</h2>
<p>For orthographic renders without perspective. Elements will have the same size on the screen regardless of their distance from the camera.
All the lines are parallel. The values that the camera asks are the distance between the center of the camera
and the outer edges of the box.
The orthografic camera requires:
<em>left</em>:left edge
<em>right</em>:right edge
<em>top</em>:top edge
<em>bottom</em>:bottom edge
<em>near</em>:
<em>far</em>:</p>
<p>To not get a distortion of your elements we need to multiple the <em>left</em> and <em>right</em> values with the aspect <code>aspectRatio</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">aspectRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">orthoCamera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">OrthographicCamera</span><span class="p">(</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">  </span><span class="o">-</span><span class="mf">1</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="p">,</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">  </span><span class="mf">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">aspectRatio</span><span class="p">,</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="w">  </span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="w">  </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="w">  </span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w">  </span><span class="mf">200</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="p">)</span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span>
</code></pre></div>
<h2 id="change-the-aspect-of-the-camera">Change the aspect of the camera</h2>
<p><code>camera.aspect = 4</code></p>
<h2 id="render-multiple-camera">Render Multiple Camera</h2>
<h3 id="arraycamera">ArrayCamera</h3>
<p>To render multiple cameras performant for example for VR we can use
<code>ArrayCamera</code></p>
<p>Each camera will render a specific area o the canvas.</p>
<h3 id="stereocamera">StereoCamera</h3>
<p>The <code>StereoCamera</code> is used to render the scene through two camera that mimic the eyes in order to create a parallax effect. You need a VR headset or red and blue glasses to see the result.</p>
<h3 id="cubecamera">CubeCamera</h3>
<p>The <code>CubeCamera</code> is used to get a render facing each direction(forward, backward, leftward, rightward, upward, and downward) to create a render of the surrounding. You can use it to create an environmentmap for reflection or a shadow map.</p>
<h1 id="materials">Materials</h1>
<p>Materials are used to put color on each visible pixel of the geometry.
We write the algorithms that decide which color gets displaced at which pixel in shaders.</p>
<p><img alt="Material Overview" src="./img/Three.JSMaterialOverview.png" /></p>
<p>We can use one material for multiple meshes.</p>
<h2 id="mesh-basic-material">Mesh Basic Material</h2>
<p><code>THREE.MeshBasicMaterial</code> is a material that doesn't react to light.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">  </span><span class="c1">//We ether can assign colors by name or by hexadecimal color: 0xff0000, or even by an instance off the Color class</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">  </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">  </span><span class="nx">transparent</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">  </span><span class="nx">opacity</span><span class="o">:</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="p">})</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="c1">// We also can change the properties after creating the Material</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a><span class="w">  </span><span class="nx">color</span><span class="o">:</span><span class="s1">&#39;red&#39;</span>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="p">})</span>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="nx">material</span><span class="p">.</span><span class="nx">transparent</span><span class="w"> </span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="mh">0xff00ff</span><span class="p">);</span>
</code></pre></div>
<p>There are multiple ways to set the color:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="s1">&#39;#ff0000&#39;</span><span class="p">)</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="s1">&#39;#ff00&#39;</span><span class="p">)</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="s1">&#39;rgb(255,0,0)&#39;</span><span class="p">)</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="s1">&#39;0xff0000&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="set-transparency-of-material">Set transparency of material</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="nx">material</span><span class="p">.</span><span class="nx">transparency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="nx">material</span><span class="p">.</span><span class="nx">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
</code></pre></div>
<h2 id="control-transparency-with-texture">Control transparency with texture</h2>
<p>To be able to use an alpha mat on an object we need to enable transparency of the material</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="nx">material</span><span class="p">.</span><span class="nx">transparency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="nx">material</span><span class="p">.</span><span class="nx">alphaMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">alphaTexture</span>
</code></pre></div>
<h2 id="changing-sites-of-material">Changing sites of material</h2>
<p>Three.JS by default has one side materials. So with a plane if you Rotate
it 180° you wouldn't see the backside of the shape.</p>
<p>For that we can use <code>THREE.DoubleSide</code>
<code>material.side = THREE.DoubleSide</code></p>
<p><code>THREE.DoubleSide</code> is a Three.JS constant so we don't need to use <code>new</code>
If not necessary try to avoid <em>DoubleSide</em> because it raises the number of triangles to render.</p>
<p><code>THREE.BackSide</code> when you want to show the <em>Backside</em> instead.</p>
<h2 id="turn-ofon-if-material-reacts-to-fog">Turn of/on if material reacts to fog</h2>
<p>Materials react by default to fog. We can change that with
<code>material.fog = false</code></p>
<h2 id="changing-all-materials-of-scene-or-object">Changing all materials of scene or object</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nx">child</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshStandardMaterial</span><span class="p">){</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">    </span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">envMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">environmentMap</span><span class="p">;</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="p">})</span>
</code></pre></div>
<h2 id="wireframe-material">Wireframe Material</h2>
<p>We set a property inside the Material <code>wireframe: true</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">wireframe</span><span class="o">:</span><span class="kc">true</span><span class="p">})</span>
</code></pre></div>
<h2 id="meshlambert-material">MeshLambert Material</h2>
<p>The <code>MeshLambert</code> material is a really performant material but also has less realism and options.
It requires information from light.</p>
<h2 id="meshphong-material">MeshPhong Material</h2>
<p>With a MeshPong Material we get a light reflection/shininess property. The higher the value the more shiny is the material.
<code>material.shininess = 90</code></p>
<p>To change the color of the reflection we can use the <code>.specular</code> property.
<code>material.specular = new THREE.Color("0xff0000")</code></p>
<h2 id="meshstandardmaterial">MeshStandardMaterial</h2>
<p>The <code>MeshStandardMaterial</code> is based on Physically based rendering(PBR) and gets used a lot in Three.js.
The material gets effected my light and allows to use properties like <code>roughness</code> and <code>metalness</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MEshStandartMaterial</span><span class="p">();</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="s2">&quot;blue&quot;</span><span class="p">);</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="nx">material</span><span class="p">.</span><span class="nx">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">colorTexture</span><span class="p">;</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="nx">material</span><span class="p">.</span><span class="nx">roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3</span><span class="p">;</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="nx">material</span><span class="p">.</span><span class="nx">metalness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.6</span><span class="p">;</span>
</code></pre></div>
<p>The <code>MeshStandardMaterial</code> also allows to add <em>ambient oclussion</em> maps. These add shadows where the texture of the map is dark. So we create more contrast around the dark parts of the texture.
The <code>aoMap</code> requires a second set of uvs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="nx">myGeo</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;uv2&#39;</span><span class="p">,</span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferAttribute</span><span class="p">(</span><span class="nx">myGeo</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">uv</span><span class="p">.</span><span class="nx">array</span><span class="p">,</span><span class="mf">2</span><span class="p">))</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="nx">material</span><span class="p">.</span><span class="nx">aoMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ambientOcclusionTexture</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="nx">material</span><span class="p">.</span><span class="nx">aoMapIntensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span>
</code></pre></div>
<p>In a <code>MeshStandardMaterial</code> we also can add a <em>displacementMap</em> to displace the vertices of the geometry. It is important that the geometry has enough vertices to work with otherwise it is gonna look weardly distorded.</p>
<p><code>material.displacementMap = displaceTex</code>
<code>material.displaementScale = 0.05</code></p>
<p>For the <code>metalness</code> and the <code>roughness</code> we can assign maps
<code>material.metallnessMap = metalNessTexture</code>
<code>material.roughnessMap = roughnessTexture</code></p>
<p>If the result doesn't look as expected reset the <code>metalness</code> and <code>roughness</code> properties
<code>material.metalness = 0</code>
<code>material.roughness = 1</code></p>
<p>We also can add the material specific normal map to add details without having a high subdivision of the geometry
<code>material.normalMap = normalTexture</code>
<code>material.normalScale.set(0.2,0.2)</code></p>
<h2 id="meshphysicalmaterial">MeshPhysicalMaterial</h2>
<p>The <code>MeshPhysical</code> material has same properties like the <code>MeshStandard</code> but
has more properties like <code>reflectivity</code> and <code>clearcoat</code></p>
<p><code>reflectivity</code> allows you to have a reflective material which has a low <code>metalness</code> value.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PhysicalMaterial</span><span class="p">();</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="mh">0xff33ff</span><span class="p">);</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="nx">material</span><span class="p">.</span><span class="nx">reflectivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3</span><span class="p">;</span>
</code></pre></div>
<p><code>clearcoat</code> is like a reflective gloss or like a wax on the car.</p>
<p><code>material.clearcoat = 0.9</code></p>
<p><img alt="PhysicalMaterial Properties" src="https://Three.JS.org/examples/?q=clear#webgl_materials_physical_clearcoat" /></p>
<h2 id="meshnormalmaterial">MeshNormalMaterial</h2>
<p>This materials shows the normals of the object.
<code>const normalMat = new THREE.MeshNormalMaterial()</code></p>
<p><code>MeshNormalMaterial</code> has also the property <code>.flatShading</code> which allows us to flatten the faces of the geometry - normals won't be interpolated between the vertices.</p>
<h2 id="meshtoonmaterial">MeshToonMaterial</h2>
<p>The <code>MeshToonMaterial</code> is similar to the <code>MeshLambertMaterial</code> but creates a more toon style.
<code>material = new THREE.MeshToonMaterial()</code>
It creates a coloration with two steps - one for light and one for shadow.
With a gradient texture we can get more color steps.
<code>material.gradientMap = gradientTexture</code></p>
<p>When the gradient texture is small Three.JS is not automatically picking the nearest pixel on the texture but is interpolating the pixel colors. In the case of <code>MeshToonMaterial</code> we want to prevent that.
To make it work we need to set <code>.minFilter</code>, <code>.magFilter</code> and deactivate the generation of mipmaps</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="nx">gradientTexture</span><span class="p">.</span><span class="nx">minFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">NearestFilter</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="nx">gradientTexture</span><span class="p">.</span><span class="nx">maxFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">NearestFilter</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="nx">gradientTexture</span><span class="p">.</span><span class="nx">generateMipMaps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div>
<h2 id="meshmatcapmaterial">MeshMatcapMaterial</h2>
<p>The <code>MeshMatcapMaterial</code> can create a nice look while being very performant. It needs a texture that looks like a sphere</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/12-materials/files/1.jpg"></iframe>
<p>The normal orientation relative to the camera decides which color the material is gonna pick for the vertex.</p>
<h2 id="meshdepthmaterial">MeshDepthMaterial</h2>
<p>The <code>MeshDepthMaterial</code> will color the parts of a material according to the closeness of the pixel to the camera.</p>
<p>If can be useful if you want to create effects where you need to know how far the pixel is from the camera.</p>
<h2 id="pointsmaterial">PointsMaterial</h2>
<p>When you work with particles it makes sense to use the <code>PointsMaterial</code></p>
<h2 id="shadermaterial">ShaderMaterial</h2>
<p>To create material for your geometries from shaders you can use <code>ShaderMaterial</code> and <code>RawShaderMaterial</code></p>
<h2 id="environment-map">Environment map</h2>
<p>With environment maps we can add images of the surrounding scene. They create more realistic reflection or refraction for your materials and lighting.
We can use environment maps as a background or on the objects as reflection and lightning.</p>
<p>To add the environment map to our material we use the <code>.envMap</code> property.</p>
<p>Three.js only supports cube environment maps. They contain 6 images each for one side of a environment.</p>
<p>To load a cube environment map we use <code>CubeTextureLoader</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cubeTextureLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">CubeTextureLoader</span><span class="p">()</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">environmentMapTexture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cubeTextureLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">([</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">    </span><span class="s1">&#39;/textures/environmentMaps/px.jpg&#39;</span><span class="p">,</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">    </span><span class="s1">&#39;/textures/environmentMaps/nx.jpg&#39;</span><span class="p">,</span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">    </span><span class="s1">&#39;/textures/environmentMaps/py.jpg&#39;</span><span class="p">,</span>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">    </span><span class="s1">&#39;/textures/environmentMaps/ny.jpg&#39;</span><span class="p">,</span>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">    </span><span class="s1">&#39;/textures/environmentMaps/pz.jpg&#39;</span><span class="p">,</span>
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="w">    </span><span class="s1">&#39;/textures/environmentMaps/nz.jpg&#39;</span>
<a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="p">])</span>
<a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="nx">material</span><span class="p">.</span><span class="nx">envMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">environmentMapTexture</span>
</code></pre></div>
<p>You can find environment maps on <a href="https://polyhaven.com/">Poly Haven</a>
But you need to convert the HDRI into a cubemap with <a href="https://matheowis.github.io/HDRI-to-CubeMap/">HRDI to Cubemap</a>.
Maybe convert the <code>png</code> into <code>jpg</code></p>
<p>To apply an environment map to the whole scene as a background we can assign the map to the <code>scene</code> itself
<code>scene.background = envMap</code>
<code>scene.environment = envMap</code></p>
<p>To get a more realistic render it is essential to add an environment map to lighten the model itself.</p>
<h3 id="intensity">Intensity</h3>
<p>When the objects look to dark we can increase the <code>environmentintensity</code> property
<code>scene.environmentIntensity = 3</code></p>
<h3 id="bluriness">Bluriness</h3>
<p>To blur the background we can change <code>backgroundBlurriness</code> property.</p>
<p><code>scene.backgroundBlurriness = 0.2</code></p>
<h3 id="brightness">Brightness</h3>
<p>To alter the <em>intensity</em> of the background we can change <code>backgroundIntensity</code>
<code>scene.backgroundIntensity = 4</code></p>
<h3 id="rotation">Rotation</h3>
<p>If you want to change the rotation of your environment map you can change the <code>backgroundRotation</code> and the <code>environmentRotation</code> properties.</p>
<p><code>scene.backgroundRotation.y = 2</code>
<code>scene.backgroundRotation.y = 3</code></p>
<p>Be aware of changing the <code>x</code> and <code>z</code> axis because normally you want the floor stay on the bottom</p>
<h3 id="hdr">HDR</h3>
<p>"High Dynamic Range Image"(HDRI) have a higher range of color values stored in the image - for example luminosity.</p>
<p>They are often <code>equirectangular</code> but don't have to be.</p>
<p>To load HDRI we neet to import the <code>RGBELoader</code>
<code>import { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js'</code></p>
<p><code>RGBE</code> is the encoding for the HDRI images.
The E stands for exponent which stores the brightness.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">rgbeLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RGBELoader</span><span class="p">();</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="nx">rgbeloader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;/environmentMaps/../name.hdr&#39;</span><span class="p">,(</span><span class="nx">envMap</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">envMap</span><span class="p">)</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">  </span><span class="nx">envtMap</span><span class="p">.</span><span class="nx">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">EquirectangularReflectionMapping</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">envMap</span><span class="p">;</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">envMap</span><span class="p">;</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="p">})</span>
</code></pre></div>
<p>The only problem with hrds is that they are more costly for the performance. Using lower resolutions and blurring the background can help to reduce the performance impact.</p>
<p>To import <code>exr</code>files we need a different loader</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">EXRLoader</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three/addons/loaders/EXRLoader.js&#39;</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">exrLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EXRLoader</span><span class="p">()</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="nx">exrLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,(</span><span class="nx">envMap</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="w">  </span><span class="nx">envMap</span><span class="p">.</span><span class="nx">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">EquirectangularReflectionMapping</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">environmentMap</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">environmentMap</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="p">})</span>
</code></pre></div>
<p>For <code>jpg</code> environment maps set the <code>colorSpace</code> for the environment map to <code>THREE.SRGBColorSpace</code> and
maybe increase the <code>environmentIntensity</code> of the scene.
<code>envMap.colorSpace = THREE.SRGBColorSpace</code>
<code>scene.environmentIntensity = 2</code></p>
<p>Also we need to load the texture with <code>THREE.TextureLoader()</code></p>
<h3 id="grounded-environment-map">Grounded environment map</h3>
<p>The problem with environment maps is that when we have an object in the center and we want to use the environment actually as a background texture than the object always seem to fly - the object is too far away from the floor.
For that we can use <code>ground projected skybox</code></p>
<p><code>import {GroundedSkybox} from 'three/addons/objects/GroundedSkybox.js'</code>
We then initiate a <code>GroundedSkybox(envMap,15,70)</code> in the callback of the environmentmap loader.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="nx">rgbeLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,(</span><span class="nx">envMap</span><span class="p">)=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">  </span><span class="c1">//...</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">skybox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GroundedSkybox</span><span class="p">(</span><span class="nx">envMap</span><span class="p">,</span><span class="mf">15</span><span class="p">,</span><span class="mf">70</span><span class="p">)</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">skybox</span><span class="p">);</span>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="p">})</span>
</code></pre></div>
<p>This creates a sphere that is squished at the bottom so the center of the scene is closer to the bottom of the <code>GroundedSkybox</code>
We then adapt the <code>y-position</code> of the sphere to match with the scener of the scene
Setting the <code>skybox.material.wireframe</code> <code>true</code> makes the positioning easier.</p>
<h3 id="real-time-environment-map">Real-time environment map</h3>
<p>We also can render every frame of the scene, store the render in a <code>render target</code> and then apply it as a environmentmap to the scene. This allows us to have a real-time environmentmap.</p>
<p>So we render the scene to a <code>THREE.WebGLCubeRenderTarget()</code> and assign that <code>texture</code> to the <code>scene.environment</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cubeRenderTarget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLCubeRenderTarget</span><span class="p">(</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">  </span><span class="mf">256</span><span class="p">,</span><span class="c1">//Resolution of each side</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">    </span><span class="c1">//Properties to set the render Target</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">FloatType</span><span class="c1">//32 bits to save information</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">    </span><span class="c1">//type:THREE.HalfFloatType //16 bits to store information</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="p">)</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cubeRenderTarget</span><span class="p">.</span><span class="nx">texture</span>
</code></pre></div>
Because of performance reasons try to set the smallest possible resolution.</p>
<p>We then create a <code>CubeCamera</code> to render all 6 sides of the scene.
<code>THREE.CubeCamera(near,far,WebGLCubeRenderTarget)</code>
<code>const cubeCam = new THREE.CubeCamera(0.1,100,cubeRenderTarget)</code></p>
<p>Then on every frame we render the camera with
<code>cubeCamera.update(renderer,scene)</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1">//loading base environmentmap</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="p">...</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cubeRenderTarget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">WEbGLCubeRenderTarget</span><span class="p">(</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w">  </span><span class="mf">256</span><span class="p">,</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">FloatType</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="p">)</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cubeRenderTarget</span><span class="p">.</span><span class="nx">texture</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="c1">//Creating a light donut</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="kd">const</span><span class="w"> </span><span class="nx">lightDonut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">TorusGeometry</span><span class="p">(</span><span class="mf">8</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="mf">4</span><span class="p">,</span><span class="mf">2</span><span class="p">)})</span><span class="c1">//When you have a high-range texture you can use color values beyond 1</span>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="p">)</span>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">lightDonut</span><span class="p">)</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a>
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Clock</span><span class="p">();</span>
<a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clock</span><span class="p">.</span><span class="nx">getElapsedTime</span><span class="p">()</span>
<a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a>
<a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="w">  </span><span class="nx">lightDonut</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="p">;</span>
<a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a><span class="w">  </span><span class="nx">lightDonut</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="p">;</span>
<a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a><span class="w">  </span><span class="nx">lightDonut</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="p">;</span>
<a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a>
<a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a><span class="p">}</span>
</code></pre></div>
<p>To decide which objects get included in the rendering of the camera and which get's ignored we can create <code>Layers</code>.
So by setting layers on a camera it will only show the objects that have the same Layer. By default all camera and object layers are set to <code>0</code>. </p>
<p>To add a layer <code>object.layers.enable()</code>
To remove a layer <code>object.layers.disable()</code>
To only enable one layer and disable all others <code>object.layers.set()</code></p>
<p>So if you want an real-time environmentmap with moving lightning you would <code>set</code> the lighning source and ignore all other objects.
<code>cubeCamera.layers.set(1)</code>
<code>lightDonut.layers.set(1)</code></p>
<h2 id="normals">Normals</h2>
<p>Normals contain information about the direction of the outside of the face on each vertex of the mesh.
You can image normals as arrows coming out of the vertex of the geometry and pointing into a direction.</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/12-materials/files/normals.png"></iframe>

<p>The material will then pick colors on the texture according to the normal orientation relative to the camera.
<code>material.matcap = matcapTexture</code></p>
<p>You can find a big list of matcaps <a href="https://github.com/nidorx/matcaps?tab=readme-ov-file">here</a></p>
<p>To create your own matcap material you can render a sphere in front of a camera into a squared image.</p>
<h2 id="textures">Textures</h2>
<h3 id="what-are-textures">What are Textures?</h3>
<p>Textures are images that will cover the surface of your geometry.
There are different textures that create certain effects on the appearance of the object.</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/11-textures/files/color.jpg"></iframe>
<p><em>Color/Albedo:</em> It takes the pixel of the texture and applies it to the geometry</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/11-textures/files/alpha.jpg"></iframe>
<p><em>Alpha:</em> A grayscale image where the white parts define that the texture will be shown and the black parts won't.</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/11-textures/files/height.png"></iframe>
<p><em>Height:</em> A grayscale image that moves the vertices of the geometry to create a relief effect. For that your geometry needs certain subdivision to be able to create the relief.</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/11-textures/files/normal.jpg"></iframe>
<p><em>Normal:</em> Adds details but doesn't actually changes the geometry. It basically fakes to the light source that some faces of the geometry are oriented in a certain direction. Good way to add details without subdividing your geometry.</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/11-textures/files/ambientOcclusion.jpg"></iframe>
<p><em>Ambient Occlusion:</em> Grayscale image that fakes shadow on the surface of the geometry.</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/11-textures/files/metalness.jpg"></iframe>
<p><em>Metalness:</em> Grayscale image that specifies which parts of the geometry are metallic(white) and which parts are not(black)</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/11-textures/files/roughness.jpg"></iframe>
<p><em>Roughness:</em> Grayscale image that defines which parts of the surface are rough(white) or smooth(black)</p>
<p>These textures we use to apply <em>Physically Based Rendering(PBR)</em> to our scene to create realistic renders.</p>
<p>We can get good free materials at
<a href="https://www.freepbr.com">FreePBR.com</a></p>
<p>To load the textures into THREE.JS we need to first initialize a loader that loads the textures.</p>
<p>More information about <a href="https://marmoset.co/posts/basic-theory-of-physically-based-rendering/">PBR here</a> <a href="https://marmoset.co/posts/physically-based-rendering-and-you-can-too/">and here</a></p>
<h3 id="loading-textures">Loading Textures</h3>
<p>There are different ways to load textures.</p>
<h4 id="loading-with-native-js">Loading with native JS</h4>
<p>With JS we need to create an <code>Image</code> instance, listen to the <code>load</code> event and the assign it to the <code>src</code> of the Image.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">Image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Image</span><span class="p">()</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Texture</span><span class="p">(</span><span class="nx">image</span><span class="p">)</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="nx">Image</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">  </span><span class="nx">texture</span><span class="p">.</span><span class="nx">needsUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="p">})</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="nx">image</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;textures/.../filename.png&#39;</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="c1">// we then assign the texture to the map property of the material</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span><span class="nx">texture</span><span class="p">})</span>
</code></pre></div>
<h4 id="using-texture-loader">Using Texture Loader</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1">//Only create this once - even if you use the loader more often - its a utility class</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">texLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">TextureLoader</span><span class="p">();</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="c1">// initialize the texture</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">textureLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;path/to/file&#39;</span><span class="p">)</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="c1">// assign texture to map property of a material</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshStandardMaterial</span><span class="p">();</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="nx">material</span><span class="p">.</span><span class="nx">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">texture</span><span class="p">;</span>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="nx">material</span><span class="p">.</span><span class="nx">roughnessMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">textureRoughness</span><span class="p">;</span>
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="nx">material</span><span class="p">.</span><span class="nx">roughnessMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="w"> </span><span class="c1">// won&#39;t effect parts of the texture that aren&#39;t rough we only apply this value to the parts that are specifies as roughness</span>
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="nx">material</span><span class="p">.</span><span class="nx">metalnessMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">textureMetall</span><span class="p">;</span>
<a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="nx">material</span><span class="p">.</span><span class="nx">normalMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normal</span><span class="p">;</span><span class="w"> </span><span class="c1">// normalmap holds information about how to fake the way light bounces of of this material.</span>
<a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a><span class="nx">material</span><span class="p">.</span><span class="nx">displacementMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">heightMap</span><span class="p">;</span><span class="w"> </span><span class="c1">//The heightmap actually displaces the vertices of the Mesh</span>
<a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a><span class="nx">material</span><span class="p">.</span><span class="nx">displacementScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span>
<a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a><span class="cm">/*ambient occlusion is technique to add more depth and realism to the scene. it simulates how light is occluded or blocked where elements are close together or one elements throws shadows on another.</span>
<a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a><span class="cm">the ao map requires a second set of uvs. We can pass them from the actual geometry*/</span>
<a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a>
<a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a><span class="kd">const</span><span class="w"> </span><span class="nx">uv2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferAttribute</span><span class="p">(</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">attribute</span><span class="p">.</span><span class="nx">uv</span><span class="p">.</span><span class="nx">array</span><span class="p">,</span><span class="mf">2</span><span class="p">)</span><span class="c1">//2 is for the item size x and y</span>
<a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a><span class="nx">geometry</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;uv2&#39;</span><span class="p">,</span><span class="nx">uv2</span><span class="p">);</span>
<a id="__codelineno-76-21" name="__codelineno-76-21" href="#__codelineno-76-21"></a><span class="p">)</span>
<a id="__codelineno-76-22" name="__codelineno-76-22" href="#__codelineno-76-22"></a><span class="nx">material</span><span class="p">.</span><span class="nx">aoMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">grassAo</span><span class="p">;</span>
<a id="__codelineno-76-23" name="__codelineno-76-23" href="#__codelineno-76-23"></a><span class="nx">material</span><span class="p">.</span><span class="nx">aoMapIntensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span>
</code></pre></div>
<p>We also can call this directly in the material initiation</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">TextureLoader</span><span class="p">();</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshStandardMaterial</span><span class="p">({</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">  </span><span class="nx">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="p">})</span>
</code></pre></div>
<p>If the loading of your functions not worked as you expected, in the <code>.load</code> function we can call three functions to control if the loading of the function worked properly.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="nx">textureLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">  </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loading finished&#39;</span><span class="p">)</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w">  </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loading progressing&#39;</span><span class="p">)</span>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">  </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loading error&#39;</span><span class="p">)</span>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="p">)</span>
</code></pre></div>
<h4 id="using-loading-manager">Using Loading Manager</h4>
<p>When you want to load multiple textures and be notified after the successful load we can also use the <code>LoadingManager</code>class and pass it into the <code>TextureLoader</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">loadingManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">LoadingManager</span><span class="p">();</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">textureLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">TextureLoader</span><span class="p">(</span><span class="nx">loadingManager</span><span class="p">)</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="c1">// you the can listen to the different events of the Loading manager</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="nx">loadingManager</span><span class="p">.</span><span class="nx">onStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loading started&#39;</span><span class="p">)</span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="p">}</span>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="nx">loadingManger</span><span class="p">.</span><span class="nx">onLoaded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loading finished&#39;</span><span class="p">);</span>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="p">}</span>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="nx">loadingManager</span><span class="p">.</span><span class="nx">onProgress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loading progressing&#39;</span><span class="p">)</span>
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="p">}</span>
<a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="nx">loadingManger</span><span class="p">.</span><span class="nx">onError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loading error&#39;</span><span class="p">);</span>
<a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="p">}</span>
</code></pre></div>
<h3 id="uv-unwrapping">UV unwrapping</h3>
<p><em>UV Unwrapping</em> defines how the texture is wrapped around the surface of the geometry. Each vertex has a 2D coordinate on a flat square plane that defines which part of the texture will displaces at that vertex position.</p>
<iframe src="https://github.com/PineappleBeer/threejs-journey/raw/master/11-textures/files/uvUnwrapping1.png"></iframe>

<p>To see the uv coordinates you can use the
<code>geometry.attributes.uv</code> property.</p>
<p>Three.js creates these uv properties for it's primitives. But if you create your own geometry in a 3D software or you import geometry you need specify the uv coordinates and need to to the uv unwrapping yourself.</p>
<h4 id="uv-maps">UV Maps</h4>
<p>A <em>UV Map</em> tells THREE.js how to map a texture on an object.
By default THREE.js maps textures differently than blender. Blender wraps a texture over all sides of an object.
Three.js maps the whole texture on one <em>face</em>.</p>
<h3 id="transforming-the-texture">Transforming the texture</h3>
<h4 id="repeat">Repeat</h4>
<p>Especially if you use texture on bigger surfaces it can make sense to change the repeat of the texture otherwise it gets streched a lot.</p>
<p><em>Lets repeat this texture 10 times x and 10 times y</em>
<code>texture.repeat.x = 10</code>
<code>texture.repeat.y = 10</code>
<code>texture.repeat.set(10,10)</code>
To make this work we need to set the <code>wrapS</code> and <code>wrapT</code> property of the texture.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="nx">grassTexture</span><span class="p">.</span><span class="nx">wrapT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">grassTexture</span><span class="p">.</span><span class="nx">wrapS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">RepeatWrapping</span>
</code></pre></div>
<p>Another type of wrapping is <code>THREE.MirrorRepeatWrapping</code></p>
<h4 id="offset">Offset</h4>
<p>We can offset the texture with the <code>offset</code> property.
<code>texture.offset.x = 0.5</code>
<code>texture.offset.y = 0.5</code></p>
<h4 id="rotation_1">Rotation</h4>
<p>To rotate the texture we use the <code>rotation</code> property.
<code>texture.rotation = Math.PI *0.25</code>
The rotation occurs around the bottom left corner which is the <code>0,0</code> uv coordinate.
To change the pivot point of the rotation you can use the <code>center</code> property</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="nx">texture</span><span class="p">.</span><span class="nx">rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="mf">0.25</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="nx">texture</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="nx">texture</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span>
</code></pre></div>
<h4 id="filtering-and-mipmapping">Filtering and Mipmapping</h4>
<p><em>Mipmapping</em> creates smaller versions of the texture - always halfed in size till 1x1. The GPU the picks the right texture for the render.
Three.js and the GPU handle this and we can decide which algorithm to use for that.
There are two types of filter alogrithms:</p>
<h5 id="minification">Minification</h5>
<p>The <em>minification</em> filter happens when pixels of the texture are smaller than the pixels of the render or the texture is to big for the surface it covers.
Different filter:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="nx">THREE</span><span class="p">.</span><span class="nx">NearestFilter</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="nx">THREE</span><span class="p">.</span><span class="nx">LinearFilter</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="nx">THREE</span><span class="p">.</span><span class="nx">NearestMipmapNearestFilter</span>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="nx">THREE</span><span class="p">.</span><span class="nx">NearestMipmapLinearFilter</span>
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="nx">THREE</span><span class="p">.</span><span class="nx">LinearMipmapNearestFilter</span>
<a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="nx">THREE</span><span class="p">.</span><span class="nx">LinearMipmapLinearFilter</span><span class="c1">//Default filter</span>
</code></pre></div>
<p>To set the filter
<code>texture.minFilter = THREE.NearestFilter</code></p>
<h5 id="magnification-filter">Magnification Filter</h5>
<p><em>Magnification</em> filter works when the pixels of the texture are bigger thant the renders pixel - the texture is too small for the surface.
The texture gets then blurry because it gets stretched on the large surface.
Filter:
<code>THREE.NearestFilter</code>
<code>THREE.LinearFilter//Default</code>
<code>texture.magFilter = THREE.NearestFilter</code></p>
<p>Generally <code>THREE.NearestFiler</code> is computationally cheaper than the other filter.
Also only mipmaps for the <code>minFilter</code> property. If you are using <code>THREE.NearestFilter</code> you don't need mipmaps and you can deactivate them with
<code>texture.generateMipmaps = false</code>
<code>texture.minFilter = THREE.NearestFilter</code>
This will creates less load for the GPU.</p>
<h4 id="texture-format-and-optimisation">Texture Format and optimisation</h4>
<p>Be aware of 3 factors when you prepare your textures:
<em>Weight</em>
<em>Size/Resolution</em>
<em>Data</em></p>
<h5 id="weight">Weight</h5>
<p>The users that are going to your website are going to download the textures. Use <code>.jpg</code>(lossy compression but lighter) or <code>.png</code>(lossless compression but heavier) for your files.</p>
<p><em>Try to get an acceptable image but as light as possible</em>
<a href="https://tinypng.com/">TinyPNG</a> can help.</p>
<h5 id="size">Size</h5>
<p>Try to reduce the size of the images as much as possible because every pixel of the image needs to get stored on the GPU - and with mipmapping even more pixel.</p>
<p>The size of your texture must have a power of 2
<code>512x512</code> <code>1024x1024</code> <code>512x2048</code></p>
<p>or otherwise Three.js have to stretch the texture to the next power of two.</p>
<h5 id="data">Data</h5>
<p>For normal textures it makes sense to use <code>png</code> so you get a lossless compression.</p>
<h5 id="sources">Sources</h5>
<p>To get good textures you can go to
<a href="https://www.poliigon.com/">Poliigon</a>
<a href="https://3dtextures.me/">3Dtextures.me</a></p>
<h2 id="glsl-as-material">GLSL as Material</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">createBackMaterial</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="w">     </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="mh">0x66775f</span><span class="p">,</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="w">     </span><span class="nx">side</span><span class="o">:</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BackSide</span><span class="p">,</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="w">     </span><span class="nx">onBeforeCompile</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">shader</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">       </span><span class="nx">shader</span><span class="p">.</span><span class="nx">fragmentShader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="sb">         </span><span class="si">${</span><span class="nx">shader</span><span class="p">.</span><span class="nx">fragmentShader</span><span class="si">}</span>
<a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="sb">       `</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span>
<a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="w">         </span><span class="sb">`vec4 diffuseColor = vec4( diffuse, opacity );`</span><span class="p">,</span>
<a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w">         </span><span class="sb">`</span>
<a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="sb">         vec3 col = mix(diffuse, diffuse + vec3(0.75), smoothstep(0.5, 0.7, vUv.y));</span>
<a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="sb">         vec4 diffuseColor = vec4( col, opacity );</span>
<a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="sb">         `</span>
<a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">       </span><span class="p">);</span>
<a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="w">     </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">shader</span><span class="p">.</span><span class="nx">fragmentShader</span><span class="p">);</span>
<a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="w">     </span><span class="p">},</span>
<a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a><span class="w">   </span><span class="p">});</span>
<a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a><span class="w">   </span><span class="nx">m</span><span class="p">.</span><span class="nx">defines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">USE_UV</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nx">m</span><span class="p">;</span>
<a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="w"> </span><span class="p">};</span>
</code></pre></div>
<h2 id="displace-material-via-displacement-map">Displace material via displacement map</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">textureLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">TextureLoader</span><span class="p">();</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">displacementMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">textureLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="sb">`src/assets/img/height.png`</span><span class="p">)</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="nx">displacementMap</span><span class="p">.</span><span class="nx">wrapS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">displacementMap</span><span class="p">.</span><span class="nx">wrapT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">RepeatWrapping</span><span class="p">;</span>
</code></pre></div>
<h2 id="blending-materials">Blending Materials</h2>
<p>We can blend the materials of the different objects when we set 
<code>blending:THREE.AdditiveBlending</code> for the materials.</p>
<h1 id="scene">Scene</h1>
<p>The <code>scene</code> object has <code>.children</code> property which allows us to access the children of the scene and more importantly
loop through all the children of the scene.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">  </span><span class="c1">//Test if child is actually a mesh</span>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nx">child</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">){</span>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="w">  </span><span class="nx">child</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="p">})</span>
</code></pre></div>
<p>To be more performant because you don't want to loop through all the children on every frame you create a group
add that to the scene and then loop through the children of the group. Now we only loop through the elements that
we really want to.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="p">...</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Group</span><span class="p">();</span>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="nx">group</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">plane</span><span class="p">,</span><span class="nx">sphere</span><span class="p">,</span><span class="nx">cylinder</span><span class="p">);</span>
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">group</span><span class="p">);</span>
<a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a>
<a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="nx">group</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">child</span><span class="p">)=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nx">child</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">mesh</span><span class="p">){</span>
<a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">    </span><span class="nx">child</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="mf">0.2</span><span class="p">;</span>
<a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="p">})</span>
</code></pre></div>
<h2 id="group">Group</h2>
<p>If you have multiple objects that belong together and maybe need to be transformed together it can make sense to group them together with the <code>Group</code> class which inherits also from <code>Object3D</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Group</span><span class="p">()</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="nx">group</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">group</span><span class="p">)</span>
</code></pre></div>
<p>You then can add objects to the group</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">boxGeo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BoxGeometry</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">boxMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span><span class="mh">0xff0000</span><span class="p">})</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">boxGeo</span><span class="p">,</span><span class="nx">boxMat</span><span class="p">);</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="nx">group</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">mesh</span><span class="p">)</span>
</code></pre></div>
<h2 id="frustum-culling">Frustum Culling</h2>
<p>Three.js calculates if the geometry is on the screen and if not the object won't be rendered.</p>
<h1 id="light">Light</h1>
<h2 id="ambientlight">AmbientLight</h2>
<p>In reality light reflects of all the surface.
To create some light even behind our objects we want to add an <code>AmbientLight</code> to the scene.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">ambLight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">AmbientLight</span><span class="p">(</span><span class="mh">0xffffff</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="nx">ambLight</span><span class="p">.</span><span class="nx">intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">ambLight</span><span class="p">);</span>
</code></pre></div>
<h2 id="point-light">Point Light</h2>
<p>A <code>Point Light</code> has a small light source and spreads uniformly in every direction
<code>const pointLight = new THREE.PointLight(color,intensity)</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">pointLight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PointLight</span><span class="p">(</span><span class="mh">0xffffff</span><span class="p">,</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="nx">pointLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">5</span><span class="p">,</span><span class="mf">5</span><span class="p">);</span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pointLight</span><span class="p">);</span>
</code></pre></div>
<p>We also can control how the intensity of the light fades and how fast it is fading
<code>const pointLight = new THREE.PointLight(color,intensity,distance,decay)</code>
<code>const pointLight = new THREE.PointLight(0xff0000,0.5,8,5)</code></p>
<h2 id="directionallight">DirectionalLight</h2>
<p>If you want a light like the sun you can use a <code>THREE.DirectionalLight('color',intensity)</code></p>
<p>To have it shine more from the side we move it
<code>directionalLight.position.set(1,0.2,0.);</code></p>
<p>We also can set the target of the directional light with the <code>target</code> property
<code>directionalLight.target.position.set(0,5,0)</code>
<code>directionalLight.target.updateWorldMatrix()</code></p>
<h2 id="hemispherelight">HemisphereLight</h2>
<p>The <code>HemisphereLight</code> is similar to the <code>AmbientLight</code> but it emits a different color from the ground than from the sky.
<code>const hemLight = new THREE.HemisphereLight('colorSky','colorGround',intensity)</code></p>
<p>You also can add <code>flatShading:true</code> as a parameter.</p>
<h2 id="rectarealight">RectAreaLight</h2>
<p>Works like a rectangle light. It mixes directional light with diffuse light.
<code>const rectAreaLight = new THREE.ReactAreaLight(color,intensity,widthRect,height)</code>
<code>const rectAreaLight = new THREE.RectAreaLight(0x0000ff, 2, 1, 1)</code></p>
<p>This light only works with MeshStandardMaterial and MeshPhysicalMaterial</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="nx">rectAreaLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="o">-</span><span class="mf">2</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">)</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="c1">// to look at center of the scene</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="nx">rectAreaLight</span><span class="p">.</span><span class="nx">lookAt</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">())</span>
</code></pre></div>
<h2 id="spotlight">SpotLight</h2>
<p>Works like a flashlight with a cone of light starting at a point and oriented in one direction.
<code>distance</code> - At which distance drops intensity to 0
<code>angle</code> - How big is the beam
<code>penumbra</code>- How diffused is contour of the beam
<code>decay</code> - how fast does the light dim
<code>const spotLight = new THREE.SpotLight(color,intensity,distance,angle,penumbra,decay)</code>
<code>const spotLight = new THREE.SpotLight(0xff0022,0.5,10,Math.PI * 0.1,0.25,1)</code></p>
<p>To rotate the <code>SpotLight</code> we have to add its <code>.target</code> to the scene</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">spotLight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">SpotLight</span><span class="p">(</span><span class="mh">0xff0022</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">10</span><span class="p">,</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="nx">spotLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">2</span><span class="p">);</span>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="nx">spotLight</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">spotLight</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
</code></pre></div>
<h2 id="performance-optimizations">Performance optimizations</h2>
<p>Try to add as few lights as possible and use the light that has the lowest performance cost because lights are intensive to compute.</p>
<p><em>Minimal Cost:</em></p>
<ul>
<li>AmbientLight</li>
<li>HemisphereLight
  <em>Moderate cost:</em></li>
<li>DirectionalLight</li>
<li>PointLight
  <em>High Cost</em></li>
<li>SpotLight</li>
<li>RectAreaLight</li>
</ul>
<h3 id="baking-lights">Baking lights</h3>
<p>Baking is a technique where we already can bake in the lightings of the scene into the material texture so we don't need
real time lighting.</p>
<h3 id="light-helpers">Light Helpers</h3>
<p>We can use Three.js helpers to see how the lights are positioned</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">hemisphereLightHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">HemisphereLightHelper</span><span class="p">(</span><span class="nx">hemisphereLight</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">hemisphereLight</span><span class="p">);</span>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">directionalLightHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">DirectionalLightHelper</span><span class="p">(</span><span class="nx">diretionalLight</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">directionalLight</span><span class="p">);</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>
<a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">pointLightHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PointLightHelper</span><span class="p">(</span><span class="nx">pointLight</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
<a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pointLightHelper</span><span class="p">)</span>
<a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a>
<a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">spotLightHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">SpotLightHelper</span><span class="p">(</span><span class="nx">spotLight</span><span class="p">);</span>
<a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">spotLightHelper</span><span class="p">);</span>
<a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="c1">//needs to be updated</span>
<a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a><span class="w">  </span><span class="nx">spotLightHelper</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
<a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="p">})</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RectAreaLightHelper</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three/examples/jsm/helpers/RectAreaLightHelper.js&#39;</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">rectAreaLightHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RectAreaLightHelper</span><span class="p">(</span><span class="nx">reactAreaLight</span><span class="p">)</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">rectAreaLightHelper</span><span class="p">)</span>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="c1">//needs to be updated</span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span>
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="p">{</span>
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="w">    </span><span class="nx">rectAreaLightHelper</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">rectAreaLight</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="w">    </span><span class="nx">rectAreaLightHelper</span><span class="p">.</span><span class="nx">quaternion</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">rectAreaLight</span><span class="p">.</span><span class="nx">quaternion</span><span class="p">)</span>
<a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="w">    </span><span class="nx">rectAreaLightHelper</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
<a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="p">})</span>
</code></pre></div>
<h2 id="shadows">Shadows</h2>
<p>The goal with shadows is to draw realistic shadows with keeping a reasonable frame rate.
How Three.js creates shadows is it first does a render for each light that is suppose to create shadows. These renders simulate what the light sees - similar to what a camera sees. It then creates a MeshDepthMaterial that replaces all meshes materials.
The result is stored as a shadow maps texture. These are used on every material that is supposed to receive shadows.</p>
<p><img alt="Shadow Map Visualisation" src="https://threejs.org/examples/webgl_shadowmap_viewer.html" /></p>
<p>To activate shadows we set them in the renderer
<code>renderer.shadowMap.enabled = true</code></p>
<p>We then decide for each object in the scene if it can cast shadows or not and set the property <code>castShadow</code> to true.
<code>geo.castShadow = true</code></p>
<p>At the end we also have to activate the shadows on the light sources.
<code>directionalLight.castShadow = true</code></p>
<p><code>PointLight,DirectionalLight,SpotLight</code> allow to activate shadows.</p>
<h2 id="optimization-of-shadow-maps">Optimization of shadow maps</h2>
<p>Generally one problem with shadow maps in Three.js is that it handles every shadow map for every object by itself so if you have multiple objects it doesn't merge the shadows of different objects.</p>
<p>Beware of settings to many <code>PointLights</code> with shadows in your scene. Three.js creates a cube shadow map and has to render 6 shadow map textures for each side of the directions.</p>
<h3 id="size-of-render">Size of Render</h3>
<p>To improve the shadows we can access the <code>shadowMap</code> property to change the size of the shadowmap
<code>directionalLight.shadowMap.mapSize.width = 1024</code>
<code>directionalLight.shadowMap.mapSize.height = 1024</code></p>
<h3 id="near-and-far">Near and far</h3>
<p>If you have a situation where your shadow is cropped or you can't see the shadow at all it can be a problem of <code>near</code> and <code>far</code>. Three.js uses Cameras to render the shadow map so the <code>near</code> and <code>far</code> values of these cameras can cut off the shadow.</p>
<p>We can access the camera that is used for a shadow map with <code>light.shadow.camera</code>
To see the <code>near</code> and <code>far</code> values it can be useful to use a
<code>CameraHelper</code>
<code>const lightCameraHelper = new THREE.CameraHelper(light.shadow.camera)</code>
<code>scene.add(lightCameraHelper)</code></p>
<p>We then can adjust the <code>near</code> and <code>far</code> values
<code>light.shadow.camera.near = 1</code>
<code>light.shadow.camera.far = 6</code></p>
<h3 id="amplitude">Amplitude</h3>
<p>For <a href="#directionallight">DirectionalLight</a> Three.js uses a <a href="#orthographic-camera">OrthographicCamera</a>. We can adjust and reduce the field of view to create more accurate shadows - the smaller the values the more accurate the shadows - but only reduce the values till you cut off your shadows.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="nx">directionalLight</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="nx">directionalLight</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="nx">directionalLight</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">bottom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">2</span>
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="nx">directionalLight</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">2</span>
</code></pre></div>
<p>For <a href="#spotlight">SpotLight</a> Three.js uses a <a href="#perspectivecamera">Perspective Camera</a> so have to set the field of view <code>.fov</code> property.
<code>spotLight.shadow.camera.fov = 20</code></p>
<h3 id="blur">Blur</h3>
<p>To reduce the sharp edges of your shadow if can make sense to add some <code>blur</code> to your shadows.
<code>light.shadow.radius = 5</code></p>
<h3 id="shadow-map-algorithm">Shadow map algorithm</h3>
<p>Three.js has different types of shadow map algorithms that we can use:</p>
<ul>
<li><code>THREE.BasicShadowMap</code> - Very performant but low quality</li>
<li><code>THREE.PCFShadowMap</code> - Less performant with smoother edges</li>
<li><code>THREE.PCFSoftShadowMap</code> - Less performant but edges are even smoother</li>
<li><code>THREE.VSMShadowMap</code> - Less performant</li>
</ul>
<p>We can set the shadow map algorithm with <code>renderer.shadowMap.type = THREE.PCFSoftShadowMap</code>
Three.js uses <code>PCFShadowMap</code> as the default.</p>
<h3 id="baking-shadows">Baking shadows</h3>
<p>A good alternative to using Three.js shadows is to bake the shadows similar to <a href="#baking-lights">baking the lights</a>.
The problem is that they only work for non dynamic scenes where the objects don't change there position or rotation.</p>
<p>Another more dynamic way is to bake a shadow and then set it as a material for a plane that lies a little bit over the
ground plane. If the object then comes close to the ground we set the opacity of that material to high and if it far from ground we set it to low</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">sphereShadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PlaneGeometry</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">),</span>
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="w">        </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="mh">0x000000</span><span class="p">,</span>
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="w">        </span><span class="nx">transparent</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="w">        </span><span class="nx">alphaMap</span><span class="o">:</span><span class="w"> </span><span class="nx">simpleShadow</span>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="p">)</span>
<a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="p">...</span>
<a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="nx">sphereShadow</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">plane</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.01</span>
<a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a><span class="nx">sphereShadow</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sphere</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.3</span>
</code></pre></div>
<p>See more at the end of this <a href="https://github.com/PineappleBeer/threejs-journey/tree/master/15-shadows">Site</a></p>
<h1 id="optimizations">Optimizations</h1>
<h2 id="one-instance-of-material-and-geometry">One Instance of material and geometry</h2>
<p>Use one material and one geometry for multiple meshes.
If you create a loop to create multiple meshes set the material and the geometry outside</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshMatcapMaterial</span><span class="p">({</span><span class="nx">matcap</span><span class="o">:</span><span class="nx">matcapTexture</span><span class="p">});</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">geo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">BoxGeometry</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">&lt;</span><span class="mf">100</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">mesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">geo</span><span class="p">,</span><span class="nx">material</span><span class="p">);</span>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="p">}</span>
</code></pre></div>
<h2 id="disposing-unused-instances">Disposing unused instances</h2>
<p>To improve the performance and avoid memory leaks we should dispose unused Three.js library entities.
Whenever we create an instance of a three.js type, certain amount of memory gets allocated.</p>
<p>Free up our memory of unused instances of three.js types we can use the <code>.dispose()</code> method.</p>
<p><code>myMaterial.dispose()</code>
<code>myGeo.dispose()</code>
<code>scene.remove(Mesh/Points)</code></p>
<h1 id="realistic-render">Realistic Render</h1>
<p>The goal is to render as realistic as possible.</p>
<p>For environmentmap try to use the smallest possible texture - especially if you don't use it as a background.</p>
<h2 id="tone-mapping">Tone mapping</h2>
<p>Tone mapping is a technique where Three.js fakes the process of converting low dynamic range(LDR) values to high dynamic range(HDR) values.
<code>renderer.toneMapping = THREE.NoToneMapping</code>(default)
Possible values that we can use are:
<code>THREE.LinearToneMapping</code>
<code>THREE.ReinhardToneMapping</code> - settings similar to a camera with improper settings.
<code>THREE.CineonToneMapping</code>
<code>THREE.ACESFilmicToneMapping</code></p>
<p>To influence the amount of light that we want to allow in the scene we can adjust the expose of the tone mapping.
<code>renderer.toneMappingExposure = 3</code></p>
<h2 id="antialiasing_1">Antialiasing</h2>
<p>Aliasing happens because the renderer tests what geometry is being rendered in that currently rendered pixel. Because the edges of the geometry are not aligned with the vertical and horizontal particle grid the geometry seems to be pixelated because every pixel just can have one color.</p>
<p>One solution is to increase the resolution of the renderer and render the scene at a much higher resolution than needed and then shrinking it down. This is called <em>Super Sampling Anti-Aliasing(SSAA)</em>.
- Render everything at 2x the size
- Resize it back down to normal size
- Final image is smoother because each pixel is average of 4 higher-resolution pixels</p>
<p>This leads to a better quality but also is heavy on the performance.</p>
<p>Another way is <em>Multi Sampling Anti-Alisaing</em> which just applies the anti-aliasing to the edges of the object, where jaggedness is most visible.
- Only samples multiple points on the geometry edges
- Blends samples to produce smoother edges.
Like only smoothing out the lines of a drawing without touching the inside or the background.</p>
<p>This is much faster than SSAA but doesn't work well with certain effects like post-processing shaders or transparent objects.</p>
<p>We can activate <em>MSAA</em> by setting <code>renderer.antialias:true</code> in the `WebGLRenderer.</p>
<p>Because screens with a pixel ratio above 1 don't need antialiasing it can make sense to only allow antialiasing when the screen pixel ratio is below 2.</p>
<h2 id="shadow">Shadow</h2>
<p>To create realistic shadows when we are using environmentmap we need to add a light in the scene that is similar to the lighting of the environmentmap.
Then activate shows in the renderer
<code>renderer.shadowMap.enabled=true</code>
<code>renderer.shadowMap.type = THREE.PCFSoftShadowMap</code>
<code>directionalLight.castShadow = true</code></p>
<p>When we enable shadows for a <code>directionalLight</code> Three.js uses an orthographic camera to render the shadow map - a black and white picture of what the light sees. 
For that camera we also can set the <code>near</code> and <code>far</code> values - they define how close or far objects can be form the light to cast shadows.
So we can reduce the default value of <code>far</code> 
<code>directionalLight.shadow.camera.far = 20</code></p>
<p>So only object between 1 and 20 units away from the light should cast shadows.</p>
<p>To increase the quality of the shadows we also can increase the shadow map to something like <code>1024x1024</code>.
<code>directionalLight.shadow.mapSize.set(1024,1024)</code>
Also play with smaller resolutions if you get good enough results and can improve your performance.</p>
<p>To activate shadows in all materials of the loaded object we can create a function <code>updateAllMaterials</code> that activates the shadows in each material and call it when the model got loaded.
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateAllMaterials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="w">  </span><span class="c1">//</span>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isMesh</span><span class="p">){</span>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="w">      </span><span class="nx">child</span><span class="p">.</span><span class="nx">castShadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="w">      </span><span class="nx">child</span><span class="p">.</span><span class="nx">receiveShadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a><span class="p">}</span>
</code></pre></div>
<code>traverse()</code> is a build in Three.js function that loops through the entire hierachy of the scene and all objects in scene graph - including children, grandchildren etc.</p>
<p>Especially when you use your own created models it can happen that you get <code>shadow acne</code>. It means the shape is casting a shadow on its own surface. It can happen when calculating if the surface is in the shadow or not. </p>
<p>To fix that we have to change the <code>bias</code> and <code>normalBias</code> of the shadow.
<code>bias</code> - helps for flat the surfaces
<code>normalBias</code> - helps for rounded surfaces
Play with the values and debug.ui to find the right values.</p>
<h2 id="textures-and-color-space">Textures and color space</h2>
<p>You can get good textures at <a href="https://polyhaven.com/textures">Polyhaven</a>
Here are some exemplary settings:
<img alt="alt text" src="../img/ExemplaryPolyhavenSettings.png" /></p>
<p><code>Color space</code> defines how color values are intepreted - especially brighness.
But humans don't see brighness linearly - because we are more sensitive to darker tones than lighter ones. Often images are stored in a <code>non-linear color space</code> called <code>sRGB</code>.</p>
<p>Three.js uses two color spaces:
- <code>THREE.LinearSRGBColorSpace</code> - Default color space used for math,lighting,shaders etc
- <code>THREE.SRGBColorSpace</code> - used for textures meant to be seen(albedo/diffuse/color maps)</p>
<p>So we can split textures into two categories:
- Visual textures
  - Color textures -&gt; <code>texture.colorSpace = THREE.SRGBColorSpace</code>
- Data textures -
  - Non color information
  - normal textures
  - roughness texture -&gt; should stay in linear space
  - ambientocculusion texture</p>
<h1 id="add-gizmo-to-object">Add Gizmo to object</h1>
<p>With <em>TransformControls</em> you can add a gizmo to an object so you can move an object.</p>
<p><em>DragControls</em> allows you to move an object ona plane facing the camera by drag and drop them.</p>
<h1 id="interactions">Interactions</h1>
<h2 id="raycaster">Raycaster</h2>
<p>A Raycaster shoots a ray in a specific direction and checks if it hits any objects or any object intersects with it.
This allows us for example to detect if the camera/player is facing a specific object or something is currently under the mouse and more.</p>
<p>Raycaster work on Meshes and on Groups because the raycaster checks by default the children and the children of children of the object.</p>
<p>To create a raycaster we call
<code>const raycaster = new THREE.Raycaster();</code></p>
<p>With the <code>.set(postion,direction)</code> method we can set the position and direction of the Raycaster</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">rayCaster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Raycaster</span><span class="p">();</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">rayOrigin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">3</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">);</span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">rayDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">);</span>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="nx">rayDirection</span><span class="p">.</span><span class="nx">normalize</span><span class="p">()</span>
<a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a><span class="nx">rayCaster</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">rayOrigin</span><span class="p">,</span><span class="nx">rayDirection</span><span class="p">);</span>
</code></pre></div>
<p>To detect the objects that lay in the ray we can use<code>intersectObject()</code> and <code>intersectObjects()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">intersectObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rayCaster</span><span class="p">.</span><span class="nx">intersectObject</span><span class="p">(</span><span class="nx">objectX</span><span class="p">)</span>
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">intersectObjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rayCaster</span><span class="p">.</span><span class="nx">intersectObjects</span><span class="p">([</span><span class="nx">objectX</span><span class="p">,</span><span class="nx">objectY</span><span class="p">,</span><span class="nx">objectZ</span><span class="p">]);</span>
</code></pre></div>
<p>By setting the second parameter to false we can set that the raycaster doesn't check for collisions with the children of the object.
<code>const intersectObject = rayCaster.intersectObject(objectX,false)</code></p>
<p>We always get back an Array as the result of the <code>intersectObject/s</code> functions because a ray can go through an object mulitple times.
The information that we get returned are:</p>
<ul>
<li><code>distance</code> - distance between origin of ray and collision point</li>
<li><code>face</code> - what face of the geometry got hit by the ray</li>
<li><code>faceIndex</code> - index of face</li>
<li><code>object</code> - what is object of the collision</li>
<li><code>point</code> - <code>Vector3</code> of exact position in 3D space of the collision</li>
<li><code>uv</code> - UV coordinates in the geometry</li>
</ul>
<p>To test if there is an object in front of the player we can use <code>distance</code>.
To change the color of an object we can manipulate the <code>object</code>.
To trigger an explosion at the impact point of the ray we can use <code>point</code>.</p>
<p>To test if moving objects hit a raycast we need to execute the test every frame.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="p">...</span>
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Clock</span><span class="p">()</span>
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clock</span><span class="p">.</span><span class="nx">getElapsedTime</span><span class="p">();</span>
<a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a>
<a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">rayOrigin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">3</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">);</span>
<a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">rayDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">);</span>
<a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="w">  </span><span class="nx">rayDirection</span><span class="p">.</span><span class="nx">normalize</span><span class="p">();</span>
<a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="w">  </span><span class="nx">rayCaster</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">rayOrigin</span><span class="p">,</span><span class="nx">rayDirection</span><span class="p">);</span>
<a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">objectsToTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">object1</span><span class="p">,</span><span class="nx">object2</span><span class="p">,</span><span class="nx">object3</span><span class="p">]</span>
<a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">intersects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rayCaster</span><span class="p">.</span><span class="nx">intersectObjects</span><span class="p">(</span><span class="nx">objectsToTest</span><span class="p">);</span>
<a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a>
<a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">objectsToTest</span><span class="p">){</span>
<a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a><span class="w">    </span><span class="nx">object</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;#00ff00&#39;</span><span class="p">)</span>
<a id="__codelineno-101-15" name="__codelineno-101-15" href="#__codelineno-101-15"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-16" name="__codelineno-101-16" href="#__codelineno-101-16"></a>
<a id="__codelineno-101-17" name="__codelineno-101-17" href="#__codelineno-101-17"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">intersect</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">intersects</span><span class="p">){</span>
<a id="__codelineno-101-18" name="__codelineno-101-18" href="#__codelineno-101-18"></a><span class="w">    </span><span class="nx">intersect</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;#ff0022&#39;</span><span class="p">)</span>
<a id="__codelineno-101-19" name="__codelineno-101-19" href="#__codelineno-101-19"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-20" name="__codelineno-101-20" href="#__codelineno-101-20"></a>
<a id="__codelineno-101-21" name="__codelineno-101-21" href="#__codelineno-101-21"></a><span class="w">  </span><span class="nx">object1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">*</span><span class="mf">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">;</span>
<a id="__codelineno-101-22" name="__codelineno-101-22" href="#__codelineno-101-22"></a><span class="w">  </span><span class="nx">object2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">*</span><span class="mf">0.6</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">;</span>
<a id="__codelineno-101-23" name="__codelineno-101-23" href="#__codelineno-101-23"></a><span class="w">  </span><span class="nx">object3</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">*</span><span class="mf">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">;</span>
<a id="__codelineno-101-24" name="__codelineno-101-24" href="#__codelineno-101-24"></a><span class="p">}</span>
</code></pre></div>
<h3 id="raycaster-with-mouse">Raycaster with mouse</h3>
<h4 id="hovering">Hovering</h4>
<p>To evaluate if the mouse is hovering an object we need to get the position of the mouse.
We want the value range from <code>-1 to 1</code> on the vertical and the horizontal with the vertical value being postivie when the mouse is up.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>(-1|1)                (1|1)
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a>
<a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a>            (0|0)
<a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a>
<a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a>(-1|-1)               (1|-1)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector2</span><span class="p">();</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a>
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mousemove&quot;</span><span class="p">,(</span><span class="nx">event</span><span class="p">)=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">  </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="o">/</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w">  </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="o">/</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">+</span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="p">});</span>
<a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a>
<a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="c1">// Recommended to cast the ray in the tick because in some browser casting in the eventlistener could trigger it multiple times</span>
<a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a>
<a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="w">  </span><span class="c1">//To point the ray in the right direction</span>
<a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="w">  </span><span class="nx">rayCaster</span><span class="p">.</span><span class="nx">setFromCamera</span><span class="p">(</span><span class="nx">mouse</span><span class="p">,</span><span class="nx">camera</span><span class="p">);</span>
<a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">objectsToIntersect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">object1</span><span class="p">,</span><span class="nx">object2</span><span class="p">,</span><span class="nx">object</span><span class="p">]</span>
<a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a>
<a id="__codelineno-103-15" name="__codelineno-103-15" href="#__codelineno-103-15"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">intersects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rayCaster</span><span class="p">.</span><span class="nx">intersectObjects</span><span class="p">(</span><span class="nx">objectsToIntersect</span><span class="p">);</span>
<a id="__codelineno-103-16" name="__codelineno-103-16" href="#__codelineno-103-16"></a>
<a id="__codelineno-103-17" name="__codelineno-103-17" href="#__codelineno-103-17"></a><span class="w">  </span><span class="c1">//Set object to blue</span>
<a id="__codelineno-103-18" name="__codelineno-103-18" href="#__codelineno-103-18"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">intersect</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">intersects</span><span class="p">){</span>
<a id="__codelineno-103-19" name="__codelineno-103-19" href="#__codelineno-103-19"></a><span class="w">    </span><span class="nx">intersect</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;#0000ff&#39;</span><span class="p">)</span>
<a id="__codelineno-103-20" name="__codelineno-103-20" href="#__codelineno-103-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-103-21" name="__codelineno-103-21" href="#__codelineno-103-21"></a><span class="w">  </span><span class="c1">//Set to red</span>
<a id="__codelineno-103-22" name="__codelineno-103-22" href="#__codelineno-103-22"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">objectsToIntersect</span><span class="p">){</span>
<a id="__codelineno-103-23" name="__codelineno-103-23" href="#__codelineno-103-23"></a>
<a id="__codelineno-103-24" name="__codelineno-103-24" href="#__codelineno-103-24"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">intersects</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">intersect</span><span class="p">=&gt;</span><span class="nx">intersect</span><span class="p">.</span><span class="nx">object</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">object</span><span class="p">)){</span>
<a id="__codelineno-103-25" name="__codelineno-103-25" href="#__codelineno-103-25"></a><span class="w">      </span><span class="nx">object</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;#00ff00&#39;</span><span class="p">)</span>
<a id="__codelineno-103-26" name="__codelineno-103-26" href="#__codelineno-103-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-103-27" name="__codelineno-103-27" href="#__codelineno-103-27"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-103-28" name="__codelineno-103-28" href="#__codelineno-103-28"></a>
<a id="__codelineno-103-29" name="__codelineno-103-29" href="#__codelineno-103-29"></a><span class="p">}</span>
</code></pre></div>
<h4 id="mouse-enter-mouse-leave">Mouse Enter Mouse Leave</h4>
<p>To see if the mouse enters or leaves an area or an object we can create a variable that tracks if the object still intersects or not. We then set and reset it in <code>tick()</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">currIntersect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="w">  </span><span class="nx">raycaster</span><span class="p">.</span><span class="nx">setFromCamera</span><span class="p">(</span><span class="nx">mouse</span><span class="p">,</span><span class="nx">camera</span><span class="p">);</span>
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">objectsToIntersect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">object1</span><span class="p">,</span><span class="nx">object2</span><span class="p">,</span><span class="nx">object3</span><span class="p">]</span>
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">intersects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">raycaster</span><span class="p">.</span><span class="nx">intersectObjects</span><span class="p">(</span><span class="nx">objectsToIntersect</span><span class="p">)</span>
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="w">  </span><span class="c1">//if intersects.length = 0 -&gt; false</span>
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nx">intersects</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
<a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">currentIntersect</span><span class="p">){</span>
<a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;mouse enter&#39;</span><span class="p">);</span>
<a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-13" name="__codelineno-104-13" href="#__codelineno-104-13"></a><span class="w">    </span><span class="nx">currIntersect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intersect</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>
<a id="__codelineno-104-14" name="__codelineno-104-14" href="#__codelineno-104-14"></a>
<a id="__codelineno-104-15" name="__codelineno-104-15" href="#__codelineno-104-15"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-16" name="__codelineno-104-16" href="#__codelineno-104-16"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">currIntersect</span><span class="p">){</span>
<a id="__codelineno-104-17" name="__codelineno-104-17" href="#__codelineno-104-17"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;mouse leave&#39;</span><span class="p">)</span>
<a id="__codelineno-104-18" name="__codelineno-104-18" href="#__codelineno-104-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-19" name="__codelineno-104-19" href="#__codelineno-104-19"></a><span class="w">    </span><span class="nx">currIntersect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a id="__codelineno-104-20" name="__codelineno-104-20" href="#__codelineno-104-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-104-21" name="__codelineno-104-21" href="#__codelineno-104-21"></a><span class="p">}</span>
<a id="__codelineno-104-22" name="__codelineno-104-22" href="#__codelineno-104-22"></a>
<a id="__codelineno-104-23" name="__codelineno-104-23" href="#__codelineno-104-23"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-24" name="__codelineno-104-24" href="#__codelineno-104-24"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nx">currIntersect</span><span class="p">){</span>
<a id="__codelineno-104-25" name="__codelineno-104-25" href="#__codelineno-104-25"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">)</span>
<a id="__codelineno-104-26" name="__codelineno-104-26" href="#__codelineno-104-26"></a><span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="nx">currIntersect</span><span class="p">.</span><span class="nx">object</span><span class="p">){</span>
<a id="__codelineno-104-27" name="__codelineno-104-27" href="#__codelineno-104-27"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="nx">object1</span><span class="o">:</span>
<a id="__codelineno-104-28" name="__codelineno-104-28" href="#__codelineno-104-28"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;obj 1&quot;</span><span class="p">);</span>
<a id="__codelineno-104-29" name="__codelineno-104-29" href="#__codelineno-104-29"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-104-30" name="__codelineno-104-30" href="#__codelineno-104-30"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="nx">object2</span><span class="o">:</span>
<a id="__codelineno-104-31" name="__codelineno-104-31" href="#__codelineno-104-31"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;obj 2&quot;</span><span class="p">);</span>
<a id="__codelineno-104-32" name="__codelineno-104-32" href="#__codelineno-104-32"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-104-33" name="__codelineno-104-33" href="#__codelineno-104-33"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="nx">object3</span><span class="o">:</span>
<a id="__codelineno-104-34" name="__codelineno-104-34" href="#__codelineno-104-34"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;obj 3&quot;</span><span class="p">);</span>
<a id="__codelineno-104-35" name="__codelineno-104-35" href="#__codelineno-104-35"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-104-36" name="__codelineno-104-36" href="#__codelineno-104-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-37" name="__codelineno-104-37" href="#__codelineno-104-37"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-104-38" name="__codelineno-104-38" href="#__codelineno-104-38"></a><span class="p">})</span>
</code></pre></div>
<h2 id="mouse-movement">Mouse Movement</h2>
<p>We can use the mouse to set the position of our camera and let the camera always look at the object.</p>
<p>To get the mouse position we listen to the JS event <code>mousemove</code> with the <code>addEventListener</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span><span class="mf">75</span><span class="p">,</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">100</span><span class="p">);</span>
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>
<a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span>
<a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">lookAt</span><span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">camera</span><span class="p">);</span>
</code></pre></div>
<iframe height="300" style="width: 100%;" scrolling="no" title="T3.JS Look at Object Move Camera with Mouse" src="https://codepen.io/levoxtrip/embed/jEOGYxd?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href="https://codepen.io/levoxtrip/pen/jEOGYxd">
  T3.JS Look at Object Move Camera with Mouse</a> by levoxtrip (<a href="https://codepen.io/levoxtrip">@levoxtrip</a>)
  on <a href="https://codepen.io">CodePen</a>.
</iframe>

<h3 id="doing-full-rotation-around-object">Doing full rotation around object</h3>
<p>By using <code>Math.PI</code> we can map the mouse position onto a specific angle on the circle. So we translate the camera on a circle shape around the object and let it look at the object.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">*</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">radius</span><span class="p">;</span>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="mf">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">radius</span><span class="p">;</span>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">lookAt</span><span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>
</code></pre></div>
<iframe height="300" style="width: 100%;" scrolling="no" title="T3JS Camera rotate around obj" src="https://codepen.io/levoxtrip/embed/raNYKxV?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href="https://codepen.io/levoxtrip/pen/raNYKxV">
  T3JS Camera rotate around obj</a> by levoxtrip (<a href="https://codepen.io/levoxtrip">@levoxtrip</a>)
  on <a href="https://codepen.io">CodePen</a>.
</iframe>

<h2 id="scrolling">Scrolling</h2>
<h3 id="scroll-along-a-path">Scroll Along a Path</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="w">    </span><span class="c1">// First define your variables</span>
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">scrollTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">scrollSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span>
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">scrollMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">scrollMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span><span class="p">;</span>
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">scrollPathPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a>
<a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="w">    </span><span class="c1">// Define the function first</span>
<a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleWheel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a><span class="w">      </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">deltaY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">deltaY</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">-</span><span class="nx">event</span><span class="p">.</span><span class="nx">wheelDelta</span><span class="p">;</span>
<a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a>
<a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a><span class="w">      </span><span class="c1">// Update total scroll</span>
<a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a><span class="w">      </span><span class="nx">scrollTotal</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">deltaY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">scrollSpeed</span><span class="p">;</span>
<a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">scrollTotal</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">scrollTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a><span class="w">      </span><span class="c1">// Clamp the TOTAL scroll value</span>
<a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">clampedScroll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span>
<a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a><span class="w">        </span><span class="nx">scrollMin</span><span class="p">,</span>
<a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a><span class="w">        </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">scrollMax</span><span class="p">,</span><span class="w"> </span><span class="nx">scrollTotal</span><span class="p">)</span>
<a id="__codelineno-107-20" name="__codelineno-107-20" href="#__codelineno-107-20"></a><span class="w">      </span><span class="p">);</span>
<a id="__codelineno-107-21" name="__codelineno-107-21" href="#__codelineno-107-21"></a>
<a id="__codelineno-107-22" name="__codelineno-107-22" href="#__codelineno-107-22"></a><span class="w">      </span><span class="c1">// Map from scroll range to 0-1 range</span>
<a id="__codelineno-107-23" name="__codelineno-107-23" href="#__codelineno-107-23"></a><span class="w">      </span><span class="nx">scrollPathPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">clampedScroll</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">scrollMin</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">scrollMax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">scrollMin</span><span class="p">);</span>
<a id="__codelineno-107-24" name="__codelineno-107-24" href="#__codelineno-107-24"></a>
<a id="__codelineno-107-25" name="__codelineno-107-25" href="#__codelineno-107-25"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">pathT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">scrollPathPos</span><span class="p">));</span>
<a id="__codelineno-107-26" name="__codelineno-107-26" href="#__codelineno-107-26"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">pathT</span><span class="p">);</span>
<a id="__codelineno-107-27" name="__codelineno-107-27" href="#__codelineno-107-27"></a>
<a id="__codelineno-107-28" name="__codelineno-107-28" href="#__codelineno-107-28"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">camPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">getPointAt</span><span class="p">(</span><span class="nx">pathT</span><span class="p">);</span>
<a id="__codelineno-107-29" name="__codelineno-107-29" href="#__codelineno-107-29"></a><span class="w">      </span><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">camPos</span><span class="p">);</span>
<a id="__codelineno-107-30" name="__codelineno-107-30" href="#__codelineno-107-30"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">tangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">getTangentAt</span><span class="p">(</span><span class="nx">pathT</span><span class="p">).</span><span class="nx">normalize</span><span class="p">();</span>
<a id="__codelineno-107-31" name="__codelineno-107-31" href="#__codelineno-107-31"></a><span class="w">      </span><span class="nx">camera</span><span class="p">.</span><span class="nx">lookAt</span><span class="p">(</span><span class="nx">camPos</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">tangent</span><span class="p">));</span>
<a id="__codelineno-107-32" name="__codelineno-107-32" href="#__codelineno-107-32"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-107-33" name="__codelineno-107-33" href="#__codelineno-107-33"></a>
<a id="__codelineno-107-34" name="__codelineno-107-34" href="#__codelineno-107-34"></a><span class="w">    </span><span class="c1">// Then add the event listener</span>
<a id="__codelineno-107-35" name="__codelineno-107-35" href="#__codelineno-107-35"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">domElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span><span class="p">;</span>
<a id="__codelineno-107-36" name="__codelineno-107-36" href="#__codelineno-107-36"></a><span class="w">    </span><span class="nx">domElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;wheel&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleWheel</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">passive</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
<h3 id="scroll-elements-top-to-bottom">Scroll Elements top to bottom</h3>
<p>The idea is that we position of objects on different y axis in the scene and then make the camera scroll with the
scroll event.
For the html elements you need to wrap them in <code>&lt;section&gt;</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="c1">//Position objects</span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">objectDistance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span>
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="nx">mesh1</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">objectsDistance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0</span>
<a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="nx">mesh2</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">objectsDistance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1</span>
<a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="nx">mesh3</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">objectsDistance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span>
</code></pre></div>
<p>To get the scroll value we can get <code>window.scrollY</code>. This value contains the amount of pixels that have been scrolled. This number can get quite big. To show only one element per viewport section we can divide the scrolling value with the height of the viewport.
<code>window.innerHeight</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">scrollY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="w">  </span><span class="nx">scrollY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span>
<a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="p">})</span>
<a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a>
<a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="w">  </span><span class="c1">// Scroll Y is positive when scrolling down so we need to invert it.</span>
<a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="w">  </span><span class="c1">//If the user scrolls down one section, the camera moves down to the next object</span>
<a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a><span class="w">  </span><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">scrollY</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">objectDistance</span>
<a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="p">}</span>
</code></pre></div>
<h4 id="parallax">Parallax</h4>
<p>To make the experience more immersive and intresting we can add a parallax effect by additionally moving the objects
according to the mouse.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="nx">cursor</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="nx">cursor</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mousemove&quot;</span><span class="p">,()=&gt;{</span>
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="w">  </span><span class="c1">//Pixel position of the mouse</span>
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w">  </span><span class="c1">// Normalise these values so users with different viewports have the same experience</span>
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="w">  </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">  </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="p">})</span>
<a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a>
<a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">paralaxX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">paralaxY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">  </span><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parallaxX</span><span class="p">;</span>
<a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="w">  </span><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parallaxY</span><span class="p">;</span>
<a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="p">}</span>
</code></pre></div>
<p>The problem is when we apply the mouse position to the camera the scroll effect doesn't work anymore. Because
the scroll gets overwritten.
To solve the problem we add the camera to a group and then apply the parallax effect to the group not the camera itself.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">camGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Group</span><span class="p">();</span>
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">camGroup</span><span class="p">)</span>
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span><span class="mf">35</span><span class="p">,</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">100</span><span class="p">);</span>
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6</span><span class="p">;</span>
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="nx">cameraGroup</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">camera</span><span class="p">);</span>
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="p">...</span>
<a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a>
<a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a><span class="w">  </span><span class="c1">// Animate camera</span>
<a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a><span class="w">    </span><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">scrollY</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">objectsDistance</span>
<a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a>
<a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">paralaxX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">paralaxY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a><span class="w">  </span><span class="nx">camGroup</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parallaxX</span><span class="p">;</span>
<a id="__codelineno-111-15" name="__codelineno-111-15" href="#__codelineno-111-15"></a><span class="w">  </span><span class="nx">camGroup</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parallaxY</span><span class="p">;</span>
<a id="__codelineno-111-16" name="__codelineno-111-16" href="#__codelineno-111-16"></a><span class="p">}</span>
</code></pre></div>
<h4 id="easing">Easing</h4>
<p>To make the experience even smoother we should apply some easing.
The idea is that on each frame instead of lineally moving straight to the target we move a fraction of the total distance like 1/20th closer to the target. So every frame the camera gets closer to the target and the fraction of the distance smaller so - so first the camera moves faster and the closer it gets to the target the slower it moves.</p>
<p>To again assure this works on every device the same way we need to multiply it with the time between the current frame and the previous frame</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Clock</span><span class="p">();</span>
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">previousTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">elapsedTimes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clock</span><span class="p">.</span><span class="nx">getElapsedTime</span><span class="p">();</span>
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">deltaTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">previousTime</span><span class="p">;</span>
<a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="w">  </span><span class="nx">previousTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="p">;</span>
<a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="p">}</span>
<a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>
<a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="c1">//parallaxX -cameraGroup.postion calculates the distance</span>
<a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a><span class="nx">cameraGroup</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="nx">parallaxX</span><span class="o">-</span><span class="nx">cameraGroup</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">deltaTime</span><span class="o">*</span><span class="mf">5</span><span class="p">;</span>
<a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="nx">cameraGroup</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="nx">parallaxY</span><span class="o">-</span><span class="nx">cameraGroup</span><span class="p">.</span><span class="nx">postion</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="o">*</span><span class="nx">deltaTime</span><span class="o">*</span><span class="mf">5</span><span class="p">;</span>
</code></pre></div>
<h4 id="trigger-animations">Trigger animations</h4>
<p>To trigger animations when we reach a section we can create a <code>currentSection</code> variable and set it to the <code>scrollY/window.innerHeight</code>. This create an index value with <code>Math.round()</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">scrollY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">currentSection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a>
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,()=&gt;{</span>
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">  </span><span class="nx">scrollY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">;</span>
<a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">newSection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">scrollY</span><span class="o">/</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span>
<a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nx">newsection</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">currentSection</span><span class="p">){</span>
<a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="w">    </span><span class="nx">currentSection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newSection</span><span class="p">;</span>
<a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a>
<a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="w">    </span><span class="nx">gsap</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span>
<a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a><span class="w">      </span><span class="nx">sectionMeshes</span><span class="p">[</span><span class="nx">currentSection</span><span class="p">].</span><span class="nx">rotation</span><span class="p">,</span>
<a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a><span class="w">        </span><span class="nx">duration</span><span class="o">:</span><span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a><span class="w">        </span><span class="nx">ease</span><span class="o">:</span><span class="s1">&#39;power2.inOut&#39;</span><span class="p">,</span>
<a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="w">        </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;+=6&#39;</span><span class="p">,</span>
<a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a><span class="w">        </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;+=3&#39;</span>
<a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="w">        </span><span class="nx">z</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;+=1.5&#39;</span>
<a id="__codelineno-113-18" name="__codelineno-113-18" href="#__codelineno-113-18"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-113-19" name="__codelineno-113-19" href="#__codelineno-113-19"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-113-20" name="__codelineno-113-20" href="#__codelineno-113-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-113-21" name="__codelineno-113-21" href="#__codelineno-113-21"></a>
<a id="__codelineno-113-22" name="__codelineno-113-22" href="#__codelineno-113-22"></a><span class="p">})</span>
<a id="__codelineno-113-23" name="__codelineno-113-23" href="#__codelineno-113-23"></a>
<a id="__codelineno-113-24" name="__codelineno-113-24" href="#__codelineno-113-24"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-25" name="__codelineno-113-25" href="#__codelineno-113-25"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-113-26" name="__codelineno-113-26" href="#__codelineno-113-26"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">mesh</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">sectionMeshes</span><span class="p">){</span>
<a id="__codelineno-113-27" name="__codelineno-113-27" href="#__codelineno-113-27"></a><span class="w">    </span><span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">deltaTime</span><span class="o">*</span><span class="mf">0.1</span>
<a id="__codelineno-113-28" name="__codelineno-113-28" href="#__codelineno-113-28"></a><span class="w">    </span><span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">deltaTime</span><span class="o">*</span><span class="mf">0.12</span>
<a id="__codelineno-113-29" name="__codelineno-113-29" href="#__codelineno-113-29"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-113-30" name="__codelineno-113-30" href="#__codelineno-113-30"></a><span class="p">}</span>
</code></pre></div>
<h1 id="physics">Physics</h1>
<p>Physics help to make the experience of your website more playful.
To get realistic physics with tension, friction, bouncing etc it makes sense to use a library instead of writing all your own physics.</p>
<h2 id="theory">Theory</h2>
<p>To have physics in our Three.js scene we need to create a physics world where the laws of physics rule. But we can't see it. It is theoretical.
We create our mesh in the Three.js scene and also create a version of that mesh in the physics world. On each frame before the rendering happens we tell the physics world to update itself. We then take the values from the objects in the phyics world and assign them to the Three.js objects.</p>
<h2 id="libraries">Libraries</h2>
<h3 id="3d">3D</h3>
<h4 id="ammojs">Ammo.js</h4>
<p><a href="http://schteppe.github.io/ammo.js-demos/">Website</a>
A can be quite heavy
Still updated by community
Mostly used.
Three.js examples.</p>
<h4 id="cannonjs">Cannon.js</h4>
<p><a href="https://github.com/schteppe/cannon.js">Website</a>
Lighter than Ammo.js and easier to implement.</p>
<p>To install cannon.js <code>npm install cannon</code> and then <code>import CANNON from 'cannon'</code></p>
<p>There is also a library that is based on cannon but actually still get's updated. It is called <code>Cannon-es</code>
<code>npm install cannon-es</code></p>
<p>To create a physics world we use <code>new CANNON.Wolrd()</code>
<code>const world = new CANNON.World()</code></p>
<p>To add gravity we set a <code>Vec3</code>
<code>cannon.gravity.set(0,-9.82,0)</code></p>
<p>When we want to add shapes the the physics world we need to add <code>Body</code>. It is a an object that will fall and collide with other bodies. But before that we decide which shape the body should take</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="p">...</span>
<a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">sphreShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Sphere</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>
<a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">sphereBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Body</span><span class="p">({</span>
<a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="w">  </span><span class="nx">mass</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="w">  </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">0</span><span class="p">),</span>
<a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="w">  </span><span class="nx">shape</span><span class="o">:</span><span class="w"> </span><span class="nx">sphereShape</span>
<a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="p">})</span>
<a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="c1">//Adding body to the world</span>
<a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="nx">world</span><span class="p">.</span><span class="nx">addBody</span><span class="p">(</span><span class="nx">sphereBody</span><span class="p">)</span>
</code></pre></div>
<p>To update the physics world we need to use the <code>step()</code>function. How it works gets described here:<a href="https://gafferongames.com/post/fix_your_timestep/">Timesteps</a>.
The <code>.step()</code> function expects a fixed time step. For 60 FPS we give it a value of <code>1/60</code>.
For the number of iterations we can use a value like <code>3</code>.
For delta time we use the clock and calculate the delta time with elapsedTime</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Clock</span><span class="p">();</span>
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">oldElapsedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a>
<a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clock</span><span class="p">.</span><span class="nx">getElapsedTime</span><span class="p">();</span>
<a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">deltaTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="o">-</span><span class="nx">oldElapsedTime</span><span class="p">;</span>
<a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="w">  </span><span class="nx">oldElapsedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elapsedTime</span><span class="p">;</span>
<a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a>
<a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">  </span><span class="nx">world</span><span class="p">.</span><span class="nx">setp</span><span class="p">(</span><span class="mf">1</span><span class="o">/</span><span class="mf">60</span><span class="p">,</span><span class="nx">deltaTime</span><span class="p">,</span><span class="mf">3</span><span class="p">);</span>
<a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a><span class="p">}</span>
</code></pre></div>
<p>What is missing now is that we need to assign the values from the <code>sphereBody</code> to the shape in three.js</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="nx">sphere</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sphereBody</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span>
<a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="nx">sphere</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sphereBody</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span>
<a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="nx">sphere</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sphereBody</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span>
</code></pre></div>
<p>OR
<code>sphere.position.copy(sphereBody.position);</code></p>
<p>To make objects interact/react to each other all the object need to bodies in the physics world.</p>
<h5 id="adding-box">Adding Box</h5>
<p>A Box Body in Cannon has a different messure than in Three.js.
It needs a <code>halfExtents</code> which is a <code>Vec3</code> and represents a segment from the center of the box to the box corners.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">boxShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Box</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">(</span><span class="nx">width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span><span class="nx">height</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span><span class="nx">depth</span><span class="o">*</span><span class="mf">0.5</span><span class="p">));</span>
<a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">boxBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Body</span><span class="p">({</span>
<a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="w">  </span><span class="nx">mass</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="w">  </span><span class="nx">position</span><span class="o">:</span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">);</span>
<a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="w">  </span><span class="nx">shape</span><span class="o">:</span><span class="nx">boxShape</span><span class="p">,</span>
<a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="w">  </span><span class="nx">material</span><span class="o">:</span><span class="nx">defaultMaterial</span>
<a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="p">})</span>
<a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a><span class="nx">world</span><span class="p">.</span><span class="nx">addBody</span><span class="p">(</span><span class="nx">boxBody</span><span class="p">)</span>
</code></pre></div>
<h5 id="static-body">Static Body</h5>
<p>If you want an object to be static, so not affected by gravity we can set <code>mass =  0</code>
You also can first create your <code>shape</code> and <code>body</code> and then assign the properties</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">plane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Plane</span><span class="p">()</span>
<a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">planeBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Body</span><span class="p">();</span>
<a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="nx">planeBody</span><span class="p">.</span><span class="nx">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="nx">planeBody</span><span class="p">.</span><span class="nx">addShape</span><span class="p">(</span><span class="nx">plane</span><span class="p">);</span>
<a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="nx">world</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">planeBody</span><span class="p">);</span>
<a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a><span class="c1">// To rotate we use quaternion in CANNON</span>
<a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="nx">planeBody</span><span class="p">.</span><span class="nx">quaternion</span><span class="p">.</span><span class="nx">setFromAxisAngle</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">),</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mf">0.5</span><span class="p">);</span>
</code></pre></div>
<p>In <code>Cannon</code> we can also create a <code>Body</code> and add multiple <code>Shapes</code> for example for complex but solid shapes.</p>
<h5 id="contact-material">Contact Material</h5>
<p>To affect how different bodies react with each other we can set a <code>Cannon</code> <code>ContactMaterial</code> and <code>Material</code>. So we create a material for each type of material we have in our scene.
The <code>default</code> material is <code>plastic</code>. We can write both <code>default</code> or <code>plastic</code> for that material.
<code>const plasticMat = new CANNON.Material('plastic')</code></p>
<p>For the interaction between the materials in the scene we also have to create a <code>ContactMaterial</code> that defines how these two materials react to each other.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">plasticMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Material</span><span class="p">(</span><span class="s1">&#39;plastic&#39;</span><span class="p">);</span>
<a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">concreteMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Material</span><span class="p">(</span><span class="s1">&#39;concrete&#39;</span><span class="p">);</span>
<a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a>
<a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">plasticConcreteContactMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">ContactMaterial</span><span class="p">(</span>
<a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a><span class="w">  </span><span class="nx">concreteMaterial</span><span class="p">,</span>
<a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a><span class="w">  </span><span class="nx">plasticMaterial</span><span class="p">,</span>
<a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a><span class="w">    </span><span class="nx">friction</span><span class="o">:</span><span class="mf">0.1</span><span class="p">,</span><span class="c1">//How much does it rub - default value 0.3</span>
<a id="__codelineno-119-9" name="__codelineno-119-9" href="#__codelineno-119-9"></a><span class="w">    </span><span class="nx">restitution</span><span class="o">:</span><span class="mf">0.7</span><span class="c1">// how much does it bounce - default value 0.3</span>
<a id="__codelineno-119-10" name="__codelineno-119-10" href="#__codelineno-119-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-119-11" name="__codelineno-119-11" href="#__codelineno-119-11"></a><span class="p">)</span>
<a id="__codelineno-119-12" name="__codelineno-119-12" href="#__codelineno-119-12"></a><span class="nx">world</span><span class="p">.</span><span class="nx">addContactMaterial</span><span class="p">(</span><span class="nx">plasticConcreteContactMaterial</span><span class="p">);</span>
</code></pre></div>
<p>We also then have to assign these physics materials to the bodies</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">sphereBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Body</span><span class="p">({</span>
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="w">  </span><span class="nx">material</span><span class="o">:</span><span class="nx">plasticMaterial</span>
<a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="p">})</span>
<a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a>
<a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a><span class="nx">planeBody</span><span class="p">.</span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">concreteMaterial</span><span class="p">;</span>
</code></pre></div>
<p>or delete the assigning for each material and just set the contact material for the world
<code>world.defaultContactMaterial = defaultContactMaterial</code></p>
<h5 id="applying-forces">Applying forces</h5>
<p>There are multiple ways to apply different forces in CANNON:</p>
<ul>
<li><code>applyForce</code> to apply a force from specific point in space:</li>
<li><a href="#applying-wind">wind</a></li>
<li>small sudden push on domino</li>
<li>greate sudden force like a jump</li>
<li><code>applyImpulse</code> similar to <code>applyForce</code>applies directly to the velocity</li>
<li>
<p><code>applyLocalForce</code> same as <code>applyForce</code> but coordinates are local to the body <code>(0,0,0) center of the body</code></p>
</li>
<li>
<p>to apply a small impulse
    <code>sphereBody.applyLocalForce(new CANNON.Vec3(150,0,0), new CANNON.Vec3(0,0,0))</code></p>
</li>
<li>
<p><code>applyLocalImpulse</code> is the same as <code>applyImpulse</code> but the coordinates are local to the Body.</p>
</li>
</ul>
<h6 id="applying-wind">Applying wind</h6>
<p>Because the wind force is happening every frame we apply these force in <code>tick()</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="w">  </span><span class="nx">sphereBodey</span><span class="p">.</span><span class="nx">applyForce</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">),</span><span class="w"> </span><span class="nx">sphereBody</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="w">  </span><span class="nx">world</span><span class="p">.</span><span class="nx">step</span><span class="p">(</span><span class="mf">1</span><span class="o">/</span><span class="mf">60</span><span class="p">,</span><span class="nx">deltaTime</span><span class="p">,</span><span class="mf">3</span><span class="p">);</span>
<a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="p">}</span>
</code></pre></div>
<h5 id="multiple-objects">Multiple Objects</h5>
<p>When we handle multiple objects first it makes sense to create functions that handle the <code>THREE.js</code> mesh and the <code>CANNON.Body</code> creation in one function. Second we create an array where we add the created objects so we can change them later</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">objectsToUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createSphere</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">position</span><span class="p">,</span><span class="nx">radius</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sphereMesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">()</span>
<a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sphereGeo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span><span class="nx">radius</span><span class="p">,</span><span class="mf">20</span><span class="p">,</span><span class="mf">20</span><span class="p">);</span>
<a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sphereMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshStandardMaterial</span><span class="p">({</span>
<a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">    </span><span class="nx">metalness</span><span class="o">:</span><span class="mf">0.3</span><span class="p">,</span>
<a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="w">    </span><span class="nx">roughness</span><span class="o">:</span><span class="mf">0.4</span><span class="p">,</span>
<a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="w">    </span><span class="nx">envMap</span><span class="o">:</span><span class="nx">environmentMapTexture</span><span class="p">,</span>
<a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">    </span><span class="nx">envMapIntensity</span><span class="o">:</span><span class="mf">0.5</span>
<a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="w">  </span><span class="nx">sphereMesh</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">sphereGeo</span><span class="p">,</span><span class="nx">sphereMat</span><span class="p">);</span>
<a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="w">  </span><span class="nx">sphereMesh</span><span class="p">.</span><span class="nx">castShadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="w">  </span><span class="nx">sphereMesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
<a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="w">  </span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">sphereMesh</span><span class="p">);</span>
<a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a>
<a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a>
<a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sphereShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Sphere</span><span class="p">(</span><span class="nx">radius</span><span class="p">);</span>
<a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sphereBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CANNON</span><span class="p">.</span><span class="nx">Body</span><span class="p">({</span>
<a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a><span class="w">    </span><span class="nx">mass</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a><span class="w">    </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="nx">position</span><span class="p">,</span>
<a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a><span class="w">    </span><span class="nx">shape</span><span class="o">:</span><span class="nx">sphreShape</span><span class="p">,</span>
<a id="__codelineno-122-22" name="__codelineno-122-22" href="#__codelineno-122-22"></a><span class="w">    </span><span class="nx">material</span><span class="o">:</span><span class="nx">defaultMaterial</span>
<a id="__codelineno-122-23" name="__codelineno-122-23" href="#__codelineno-122-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-122-24" name="__codelineno-122-24" href="#__codelineno-122-24"></a><span class="w">  </span><span class="p">)</span>
<a id="__codelineno-122-25" name="__codelineno-122-25" href="#__codelineno-122-25"></a><span class="w">   </span><span class="nx">world</span><span class="p">.</span><span class="nx">addBody</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
<a id="__codelineno-122-26" name="__codelineno-122-26" href="#__codelineno-122-26"></a><span class="w">   </span><span class="nx">objectsToUpdate</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<a id="__codelineno-122-27" name="__codelineno-122-27" href="#__codelineno-122-27"></a><span class="w">    </span><span class="nx">mesh</span><span class="o">:</span><span class="nx">sphereMesh</span><span class="p">,</span>
<a id="__codelineno-122-28" name="__codelineno-122-28" href="#__codelineno-122-28"></a><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="nx">sphereBody</span>
<a id="__codelineno-122-29" name="__codelineno-122-29" href="#__codelineno-122-29"></a><span class="w">   </span><span class="p">})</span>
<a id="__codelineno-122-30" name="__codelineno-122-30" href="#__codelineno-122-30"></a><span class="p">}</span>
<a id="__codelineno-122-31" name="__codelineno-122-31" href="#__codelineno-122-31"></a>
<a id="__codelineno-122-32" name="__codelineno-122-32" href="#__codelineno-122-32"></a>
<a id="__codelineno-122-33" name="__codelineno-122-33" href="#__codelineno-122-33"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-34" name="__codelineno-122-34" href="#__codelineno-122-34"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-122-35" name="__codelineno-122-35" href="#__codelineno-122-35"></a><span class="w">  </span><span class="nx">world</span><span class="p">.</span><span class="nx">step</span><span class="p">(</span><span class="mf">1</span><span class="o">/</span><span class="mf">60</span><span class="p">,</span><span class="nx">deltaTime</span><span class="p">,</span><span class="mf">3</span><span class="p">);</span>
<a id="__codelineno-122-36" name="__codelineno-122-36" href="#__codelineno-122-36"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">objectsToUpdate</span><span class="p">){</span>
<a id="__codelineno-122-37" name="__codelineno-122-37" href="#__codelineno-122-37"></a><span class="w">    </span><span class="c1">//Assign position of physics body to the threejs mesh</span>
<a id="__codelineno-122-38" name="__codelineno-122-38" href="#__codelineno-122-38"></a><span class="w">    </span><span class="nx">obj</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<a id="__codelineno-122-39" name="__codelineno-122-39" href="#__codelineno-122-39"></a><span class="w">    </span><span class="c1">//Copy the rotation</span>
<a id="__codelineno-122-40" name="__codelineno-122-40" href="#__codelineno-122-40"></a><span class="w">    </span><span class="nx">obj</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">quaternion</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">quaternion</span><span class="p">);</span>
<a id="__codelineno-122-41" name="__codelineno-122-41" href="#__codelineno-122-41"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-122-42" name="__codelineno-122-42" href="#__codelineno-122-42"></a><span class="p">}</span>
</code></pre></div>
<h5 id="events">Events</h5>
<p>We can listen and use events to execute some logic for our scene.
Event we can listen to are <code>colide</code>, <code>sleep</code>,<code>wakeup</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;collide&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">playSound</span><span class="p">)</span>
<a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a>
<a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">playSound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">collision</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="w">  </span><span class="c1">//Resetting time of sound so if another sound is playing it starts again from the start.</span>
<a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="w">  </span><span class="nx">sound</span><span class="p">.</span><span class="nx">currentTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a><span class="w">  </span><span class="nx">sound</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
<a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a><span class="p">}</span>
</code></pre></div>
<p>We also get from the event the strength of the <code>collision</code> with <code>collision.contact.getImpactVelocityAlongNormal()</code> which we then can use to determine some logic.</p>
<p>When you remove bodies from the scene don't forget to remove also the eventlistener
<code>body.removeEventListener('collide',playSound)</code></p>
<h5 id="constrains">Constrains</h5>
<p>CANNON has different constrains to create certain behavior:</p>
<ul>
<li><code>HingeConstraint</code> Doorhinge behaviour</li>
<li><code>DistanceConstraint</code> Bodies are forced to keep distance between each other</li>
<li><code>LockContraint</code> mergin bodies</li>
<li><code>PointToPointConstraint</code> gluying body to specifc point</li>
</ul>
<h5 id="performance">Performance</h5>
<h6 id="removing-elements">Removing Elements</h6>
<p>To remove <code>Bodies</code> from the world we can use <code>world.removeBody(obj.body)</code></p>
<h6 id="broadphase">Broadphase</h6>
<p>To assure a good performance of your scene you don't want to calculcate every <code>Body</code> against all other <code>Bodies</code>.
The goal is to just process the bodies that are actually close to each other and react with each other.
For that CANNON has <code>Broadphase</code> with different algorithms to presorts the <code>Bodies</code> before it processes the calculations:</p>
<ul>
<li><code>NaiveBroadphase</code>: Actually tests all the <code>Bodies</code> against each other(default).</li>
<li><code>GridBroadphase</code>: Splits up the world into girdcells and only tests the <code>Bodies</code> that are in the same or the neighbors gridcell.</li>
<li><code>SAPBroadphase</code>: Test <code>Bodies</code> on arbitrary axes during multiple steps(recommendet).</li>
</ul>
<p><code>world.broadphase = new CANNON.SAPBroadphase(world);</code></p>
<h6 id="sleep">Sleep</h6>
<p>Even if the <code>Body</code> stays still it gets tested by <code>Broadphase</code>. To avoid that we can put the object into <code>sleep</code> if the
<code>Body's</code> velocity is really low until a force is applied to it or a collision happens.
<code>world.allowSleep = true</code></p>
<p>With <code>sleepSpeedLimit</code> and <code>sleepTimeLimit</code>we can define thresholds to the sleep behaviour</p>
<h6 id="workers">Workers</h6>
<p>Workes allow you to put part of your code on a different thread to improve performance. But that code has to be seperated
as you can see here <a href="https://github.com/schteppe/cannon.js/blob/master/examples/worker.html">Worker Example</a>;</p>
<p>Further information <a href="https://schteppe.github.io/cannon.js/">here</a></p>
<h4 id="oimojs">Oimo.js</h4>
<p><a href="https://lo-th.github.io/Oimo.js/">Website</a>
Lighter than Ammo.js and also easier</p>
<h4 id="rapier">Rapier</h4>
<p><a href="https://rapier.rs">Website</a>
Good performance
Currently maintained</p>
<h3 id="2d">2D</h3>
<h4 id="matterjs">Matter.js</h4>
<p><a href="https://brm.io/matter-js/">Website</a>
Still kind of updated</p>
<h4 id="p2js">P2.js</h4>
<p>[Website:] (https://schteppe.github.io/p2.js/)
Hasn't been update for 2 years</p>
<h4 id="planckjs">Planck.js</h4>
<p><a href="https://piqnt.com/planck.js/">Website:</a></p>
<h4 id="box2djs">Box2D.js</h4>
<p>[Website:] (http://kripken.github.io/box2d.js/demo/webgl/box2d.html)</p>
<h1 id="color-class">Color class</h1>
<h2 id="set-color-of-a-material">Set color of a material</h2>
<p><code>object.material.color.set('#ff0000')</code></p>
<h2 id="mix-colors">Mix Colors</h2>
<p>We can use the <code>color1.lerp(color2,alpha)</code> function to mix two colors</p>
<h1 id="vector3-class">Vector3 class</h1>
<h3 id="set-vector">Set Vector</h3>
<p><code>mesh.position.set(0.2,0.7,0.3)</code>3</p>
<h3 id="get-the-length-of-the-position-vector">Get the length of the position vector</h3>
<p><code>mesh.position.length()</code></p>
<h3 id="get-the-distance-from-another-vector">Get the distance from another Vector</h3>
<p><code>mesh.position.distanceTo(camera.position)</code></p>
<h3 id="normalize-length-of-vector">Normalize Length of Vector</h3>
<p><code>mesh.position.normalize()</code></p>
<h1 id="debug-ui">Debug UI</h1>
<p>There are multiple libraries to create some Debug UIs.
The most popular like <a href="https://github.com/dataarts/dat.gui">dat.GUI</a>
or
<a href="https://github.com/freeman-lab/control-panel">control-panel</a>
<a href="https://github.com/automat/controlkit.js">controlkit</a>
<a href="https://github.com/colejd/guify">guify</a>
<a href="https://github.com/wearekuva/oui">oui</a></p>
<h2 id="datgui">Dat.GUI</h2>
<h3 id="implementation">Implementation</h3>
<p>Installation
<code>npm install --save dat.gui</code>
Import
<code>import * as dat from 'dat.gui'</code>
Instantiation
<code>const gui = new dat.GUI</code></p>
<h3 id="elements">Elements</h3>
<p><code>Range</code> - numbeers with minimum and maximum value
<code>Color</code> - for various color formats
<code>Text</code> - Simple Text
<code>Checkbox</code> - for booleans
<code>Select</code> - Choice from list of values
<code>Button</code> - to trigger functions
<code>Folder</code> - to organize panel with lot of elements</p>
<h3 id="add-elements">Add Elements</h3>
<p>We add elements with <code>gui.add(object,property of object)</code> to add elements to the GUI.</p>
<p><code>gui.add(mesh.position, 'y')</code></p>
<p>Specifying ranges and steps
<code>gui.add(mesh.position,'y',-3,3,0.01)</code>
or use methods from <em>dat.GUI</em>.
<code>gui.add(mesh.position,'y').min(-3).max(3).step(0.01).name('elevation')</code></p>
<h3 id="set-element-visible-via-gui">Set Element visible via GUI</h3>
<p><code>gui.add(mesh,'visible')</code></p>
<h3 id="drop-down">Drop-down</h3>
<p>To create a drop down we add an object with key value pairs to it
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="nx">gui</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">renderer</span><span class="p">,</span><span class="s1">&#39;toneMapping&#39;</span><span class="p">){</span>
<a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="w">  </span><span class="nx">key1</span><span class="o">:</span><span class="nx">value1</span><span class="p">,</span>
<a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="w">  </span><span class="nx">key2</span><span class="o">:</span><span class="nx">value2</span><span class="p">,</span>
<a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="w">  </span><span class="nx">key3</span><span class="o">:</span><span class="nx">value3</span><span class="p">,</span>
<a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="w">  </span><span class="nx">key4</span><span class="o">:</span><span class="nx">value4</span><span class="p">,</span>
<a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a>
<a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="colors">Colors</h3>
<p>Define object with color as its property
<code>const parameters = { color: 0xff0000}</code>
Add object
<code>gui.addColor(parameters,'color')</code></p>
<p>Signaling changes of property in Dat.GUI properts and setting property in three.js</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="w">  </span><span class="nx">color</span><span class="o">:</span><span class="mh">0xff0000</span>
<a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="p">}</span>
<a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="nx">gui</span><span class="p">.</span><span class="nx">addColor</span><span class="p">(</span><span class="nx">parameters</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">)</span>
<a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="p">.</span><span class="nx">onChange</span><span class="p">(()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="w">  </span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">color</span><span class="p">)</span>
<a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="p">})</span>
<a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a>
<a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a><span class="kd">const</span><span class="w"> </span><span class="nx">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">color</span><span class="p">})</span>
</code></pre></div>
<h3 id="update-values">Update Values</h3>
<p>If we want to show and update the values in our scene we have to call <code>.onChange()</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="nx">gui</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">parameters</span><span class="p">,</span><span class="s1">&#39;materialColor&#39;</span><span class="p">)</span>
<a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="w">  </span><span class="p">.</span><span class="nx">onChange</span><span class="p">(()=&gt;{</span>
<a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="w">    </span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">materialColor</span><span class="p">)</span>
<a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="w">  </span><span class="p">})</span>
</code></pre></div>
<h3 id="trigger-a-function">Trigger a function</h3>
<p>To trigger a function we have to add the function again like with colors to an object.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">gsap</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;gsap&#39;</span>
<a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="p">...</span>
<a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="w">  </span><span class="nx">color</span><span class="p">,</span><span class="mh">0xff0000</span><span class="p">,</span>
<a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="w">  </span><span class="nx">spin</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="w">    </span><span class="nx">gsap</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">,{</span><span class="nx">duration</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mf">2</span><span class="p">})</span>
<a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a><span class="p">}</span>
<a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a>
<a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a><span class="nx">gui</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">parameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;spin&#39;</span><span class="p">)</span>
</code></pre></div>
<p>If you want to trigger a function which also needs parameters we can create an object for that</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">gui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GUI</span><span class="p">();</span>
<a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">debugObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="nx">debugObject</span><span class="p">.</span><span class="nx">createSphere</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="w">  </span><span class="nx">createSphere</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,{</span><span class="nx">x</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="mf">2</span><span class="p">,</span><span class="nx">x</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
<a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="p">}</span>
<a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a><span class="nx">gui</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">debugObject</span><span class="p">,</span><span class="s1">&#39;createSphere&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="hide-panel">Hide Panel</h3>
<p>We can press <code>H</code> to hide the panel
or set it hidden from beginning
<code>gui.hide()</code></p>
<h3 id="close-panel">Close Panel</h3>
<p>To have your GUI closed at the beginning
<code>const gui = new dat.GUI({closed:true})</code></p>
<h3 id="set-width-of-panel">Set Width of Panel</h3>
<p><code>const gui = new dat.GUI({width:400})</code></p>
<p>More infos under <a href="https://github.com/dataarts/dat.gui/blob/HEAD/API.md">dat.GUI API</a></p>
<h1 id="show-window-to-control-and-change-properties-of-the-objects">Show window to control and change properties of the objects</h1>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">pane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Pane</span><span class="p">()</span>
<a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="nx">pane</span><span class="p">.</span><span class="nx">addInput</span><span class="p">(</span><span class="nx">material</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;shininess&#39;</span><span class="p">,{</span>
<a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="w">  </span><span class="nx">min</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">  </span><span class="nx">max</span><span class="o">:</span><span class="mf">100</span><span class="p">,</span>
<a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="w">  </span><span class="nx">step</span><span class="o">:</span><span class="mf">1</span>
<a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a><span class="p">})</span>
<a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a>
<a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="c1">// passing two objects</span>
<a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="nx">pane</span><span class="p">.</span><span class="nx">addInput</span><span class="p">(</span><span class="nx">grassTexture</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;offset&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a><span class="w">  </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a><span class="w">    </span><span class="nx">min</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-129-12" name="__codelineno-129-12" href="#__codelineno-129-12"></a><span class="w">    </span><span class="nx">max</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-129-13" name="__codelineno-129-13" href="#__codelineno-129-13"></a><span class="w">    </span><span class="nx">step</span><span class="o">:</span><span class="mf">0.001</span>
<a id="__codelineno-129-14" name="__codelineno-129-14" href="#__codelineno-129-14"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-129-15" name="__codelineno-129-15" href="#__codelineno-129-15"></a><span class="w">  </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-16" name="__codelineno-129-16" href="#__codelineno-129-16"></a><span class="w">    </span><span class="nx">min</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-129-17" name="__codelineno-129-17" href="#__codelineno-129-17"></a><span class="w">    </span><span class="nx">max</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<a id="__codelineno-129-18" name="__codelineno-129-18" href="#__codelineno-129-18"></a><span class="w">    </span><span class="nx">step</span><span class="o">:</span><span class="mf">0.001</span>
<a id="__codelineno-129-19" name="__codelineno-129-19" href="#__codelineno-129-19"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-129-20" name="__codelineno-129-20" href="#__codelineno-129-20"></a><span class="p">})</span>
</code></pre></div>
<h1 id="vite-config-file">Vite Config file</h1>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="w">    </span><span class="nx">root</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;src/&#39;</span><span class="p">,</span><span class="c1">//Where are we serving up our experience</span>
<a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="w">    </span><span class="nx">publicDir</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;../static/&#39;</span><span class="p">,</span><span class="c1">//We are hosting our static assets in the static folder</span>
<a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="w">    </span><span class="nx">base</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
<a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="p">}</span>
</code></pre></div>
<h1 id="math-functions">Math functions</h1>
<p><em>PI</em>: <code>Math.PI</code>
<em>SINE</em>: <code>Math.sin()</code></p>
<h2 id="create-random-angles">create random angles</h2>
<p><code>const angle = Math.Random() * Math.PI *2;</code></p>
<h1 id="code-structure-for-bigger-projects">Code Structure for bigger projects</h1>
<p>== TO JAVASCRIPT BASICS LATER ==</p>
<h2 id="modules">Modules</h2>
<p>Modules allow us to seperate our code into multiple files and then import them when needed
<code>import test from './test.js'</code></p>
<p>Modules can export one or multiple things.
<code>export default 'Hello World, this is my first module'</code></p>
<p>In the other script 
<div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./test.js&#39;</span>
<a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">test</span><span class="p">)</span>
<a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="c1">//Hello World, this is my first module</span>
</code></pre></div></p>
<p>It's important that for our own modules we need to add <code>./</code> before the file otherwise JS tries to find it in the <code>node_modules</code></p>
<p><em>Export a function</em>
To export a function
<div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hallo&quot;</span><span class="p">)</span>
<a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a><span class="p">}</span>
</code></pre></div>
<em>Export object</em>
<div class="highlight"><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="w">  </span><span class="nx">me</span><span class="o">:</span><span class="s2">&quot;Hallo world&quot;</span>
<a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="p">}</span>
<a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a>
<a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">printMe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;me&quot;</span><span class="p">)</span>
<a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a><span class="p">}</span>
<a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a><span class="c1">//Export one object</span>
<a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">object</span><span class="p">;</span>
<a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a><span class="c1">//Or export multiple</span>
<a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">{</span><span class="nx">object</span><span class="p">,</span><span class="nx">printMe</span><span class="p">}</span>
<a id="__codelineno-133-12" name="__codelineno-133-12" href="#__codelineno-133-12"></a>
<a id="__codelineno-133-13" name="__codelineno-133-13" href="#__codelineno-133-13"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">object</span><span class="p">,</span><span class="nx">printMe</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./test.js&#39;</span>
<a id="__codelineno-133-14" name="__codelineno-133-14" href="#__codelineno-133-14"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span>
<a id="__codelineno-133-15" name="__codelineno-133-15" href="#__codelineno-133-15"></a><span class="nx">printMe</span><span class="p">()</span>
</code></pre></div></p>
<h2 id="classes">Classes</h2>
<p>Classes in JS allow to use <em>Object-oriented Programming</em></p>
<p>To create a class
<code>class MyClass{}</code>
By convention classes are written in <em>PascalCase</em> starting with a capital letter.</p>
<p>Classes are blueprints to create an object. We then can use that blueprint to create multiple objects.</p>
<p>To create an <em>instance</em>  of the the class
<code>const classInstance = new MyClass()</code></p>
<p>Functions inside a class
<div class="highlight"><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="kd">class</span><span class="w"> </span><span class="nx">MyClass</span><span class="p">{</span>
<a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a><span class="w">  </span><span class="nx">doThis</span><span class="p">(){</span>
<a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m doing this&quot;</span><span class="p">)</span>
<a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a><span class="p">}</span>
<a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a>
<a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a><span class="nx">classInstance</span><span class="p">.</span><span class="nx">doThis</span><span class="p">();</span>
</code></pre></div></p>
<p>Classes have a <code>constructor</code> method that get's called when the class got instantiated
<div class="highlight"><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="kd">class</span><span class="w"> </span><span class="nx">MyClass</span><span class="p">{</span>
<a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">age</span><span class="p">){</span>
<a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span>
<a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">age</span>
<a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`I&#39;m </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> and I&#39;m alive`</span><span class="p">)</span>
<a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">doThis</span><span class="p">();</span>
<a id="__codelineno-135-7" name="__codelineno-135-7" href="#__codelineno-135-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-135-8" name="__codelineno-135-8" href="#__codelineno-135-8"></a><span class="w">  </span><span class="nx">doThis</span><span class="p">(){</span>
<a id="__codelineno-135-9" name="__codelineno-135-9" href="#__codelineno-135-9"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`And now </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> do this`</span><span class="p">)</span>
<a id="__codelineno-135-10" name="__codelineno-135-10" href="#__codelineno-135-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-135-11" name="__codelineno-135-11" href="#__codelineno-135-11"></a><span class="p">}</span>
<a id="__codelineno-135-12" name="__codelineno-135-12" href="#__codelineno-135-12"></a>
<a id="__codelineno-135-13" name="__codelineno-135-13" href="#__codelineno-135-13"></a><span class="kd">const</span><span class="w"> </span><span class="nx">classInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MyClass</span><span class="p">(</span><span class="s2">&quot;MyName&quot;</span><span class="p">)</span>
<a id="__codelineno-135-14" name="__codelineno-135-14" href="#__codelineno-135-14"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">classInstance</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="inheritance">Inheritance</h3>
<p>Classes allow us to let a class inherit from a parent class. So we can create a <code>Parent</code> class and then let a <code>Child</code> class inherit behaviour and values from the <code>Parent</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">ParentClass</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ParentClass.js&#39;</span>
<a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="kd">class</span><span class="w"> </span><span class="nx">ChildClass</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ParentClass</span>
<a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="p">{</span>
<a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="w">  </span><span class="nx">childBehaviour1</span><span class="p">(){</span>
<a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> is hungry but can&#39;t make dinner on his own`</span><span class="p">)</span>
<a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a>
<a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a><span class="w">  </span><span class="c1">//Methods in the Childclass with the same name like the parent will overwrite the parent class</span>
<a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a>
<a id="__codelineno-136-10" name="__codelineno-136-10" href="#__codelineno-136-10"></a><span class="w">  </span><span class="nx">doThis</span><span class="p">(){</span>
<a id="__codelineno-136-11" name="__codelineno-136-11" href="#__codelineno-136-11"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`now a child does this`</span><span class="p">)</span>
<a id="__codelineno-136-12" name="__codelineno-136-12" href="#__codelineno-136-12"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-136-13" name="__codelineno-136-13" href="#__codelineno-136-13"></a>
<a id="__codelineno-136-14" name="__codelineno-136-14" href="#__codelineno-136-14"></a><span class="p">}</span>
</code></pre></div>
<p>If you want the <code>Child</code> class to have a different constructor or you want to extent the <code>Parent</code> constructor in the <code>Child</code> class we need to call<code>super()</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">ParentClass</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ParentClass.js&#39;</span>
<a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="kd">class</span><span class="w"> </span><span class="nx">ChildClass</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">ParentClass</span><span class="p">{</span>
<a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">age</span><span class="p">){</span>
<a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="w">    </span><span class="c1">//super basically calls the constructor of the parent class</span>
<a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a><span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">age</span><span class="p">);</span>
<a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a>
<a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">canEat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-137-8" name="__codelineno-137-8" href="#__codelineno-137-8"></a>
<a id="__codelineno-137-9" name="__codelineno-137-9" href="#__codelineno-137-9"></a><span class="w">    </span><span class="c1">//you could even call the method from the parent class but this can make the code complicated</span>
<a id="__codelineno-137-10" name="__codelineno-137-10" href="#__codelineno-137-10"></a><span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="nx">doThis</span><span class="p">()</span>
<a id="__codelineno-137-11" name="__codelineno-137-11" href="#__codelineno-137-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-137-12" name="__codelineno-137-12" href="#__codelineno-137-12"></a><span class="p">}</span>
</code></pre></div></p>
<h2 id="structuring-code">Structuring Code</h2>
<p>So the idea is to seperate the code into different files and export in each file a class .</p>
<p>A good practise is to put the whole three.js experience into its own <code>Experience</code> class.
<div class="highlight"><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="p">{</span>
<a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Welcome to my experience&quot;</span><span class="p">)</span>
<a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a><span class="p">}</span>
<a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a>
<a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a><span class="k">import</span><span class="w"> </span><span class="nx">Experience</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./Experience.js&#39;</span>
<a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Experience</span><span class="p">();</span>
</code></pre></div></p>
<p>It makes sense to send the canvas as a parameter into the class</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">;</span>
<a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="p">}</span>
<a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="p">...</span>
<a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Experience</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getSelector</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">))</span>
</code></pre></div>
If you have only one experience and you want to access the window object you can write</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">;</span>
<a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="w">    </span><span class="c1">//CAREFUL WITH MULTIPLE EXPERIENCES THIS OVERWRITES THEM</span>
<a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a><span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="c1">//This gives us the window object</span>
<a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="p">}</span>
</code></pre></div>
<p>It always can make sense to have some <em>Util</em> classes saved that you can use in different projects.
<div class="highlight"><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Sizes</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">;</span>
<a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">;</span>
<a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">pixelRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span><span class="p">,</span><span class="mf">2</span><span class="p">);</span>
<a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a>
<a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a><span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,()=&gt;{</span>
<a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">;</span>
<a id="__codelineno-141-9" name="__codelineno-141-9" href="#__codelineno-141-9"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">;</span>
<a id="__codelineno-141-10" name="__codelineno-141-10" href="#__codelineno-141-10"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">pixelRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span><span class="p">,</span><span class="mf">2</span><span class="p">);</span>
<a id="__codelineno-141-11" name="__codelineno-141-11" href="#__codelineno-141-11"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-141-12" name="__codelineno-141-12" href="#__codelineno-141-12"></a>
<a id="__codelineno-141-13" name="__codelineno-141-13" href="#__codelineno-141-13"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-141-14" name="__codelineno-141-14" href="#__codelineno-141-14"></a>
<a id="__codelineno-141-15" name="__codelineno-141-15" href="#__codelineno-141-15"></a>
<a id="__codelineno-141-16" name="__codelineno-141-16" href="#__codelineno-141-16"></a><span class="p">}</span>
<a id="__codelineno-141-17" name="__codelineno-141-17" href="#__codelineno-141-17"></a><span class="p">...</span>
<a id="__codelineno-141-18" name="__codelineno-141-18" href="#__codelineno-141-18"></a><span class="k">import</span><span class="w"> </span><span class="nx">Sizes</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./Utils/Sizes.js&#39;</span>
<a id="__codelineno-141-19" name="__codelineno-141-19" href="#__codelineno-141-19"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-141-20" name="__codelineno-141-20" href="#__codelineno-141-20"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-141-21" name="__codelineno-141-21" href="#__codelineno-141-21"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Sizes</span><span class="p">();</span>
<a id="__codelineno-141-22" name="__codelineno-141-22" href="#__codelineno-141-22"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
<a id="__codelineno-141-23" name="__codelineno-141-23" href="#__codelineno-141-23"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
<a id="__codelineno-141-24" name="__codelineno-141-24" href="#__codelineno-141-24"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">pixelRatio</span><span class="p">)</span>
<a id="__codelineno-141-25" name="__codelineno-141-25" href="#__codelineno-141-25"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-141-26" name="__codelineno-141-26" href="#__codelineno-141-26"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="event-emitter">Event Emitter</h3>
<p>To enable the class to emit events it needs to inherit from a <code>EventEmitter</code> class.
<div class="highlight"><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="c1">// This class lets you create and manage custom events.</span>
<a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="c1">// You can &quot;listen&quot; to events with `on()`, stop listening with `off()`, and &quot;trigger&quot; events with `trigger()`.</span>
<a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a>
<a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">EventEmitter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a><span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-6" name="__codelineno-142-6" href="#__codelineno-142-6"></a><span class="w">        </span><span class="c1">// Create an object to store all the event listeners (callbacks)</span>
<a id="__codelineno-142-7" name="__codelineno-142-7" href="#__codelineno-142-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-142-8" name="__codelineno-142-8" href="#__codelineno-142-8"></a>
<a id="__codelineno-142-9" name="__codelineno-142-9" href="#__codelineno-142-9"></a><span class="w">        </span><span class="c1">// Add a default &quot;base&quot; namespace to organize events</span>
<a id="__codelineno-142-10" name="__codelineno-142-10" href="#__codelineno-142-10"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-142-11" name="__codelineno-142-11" href="#__codelineno-142-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-142-12" name="__codelineno-142-12" href="#__codelineno-142-12"></a>
<a id="__codelineno-142-13" name="__codelineno-142-13" href="#__codelineno-142-13"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-142-14" name="__codelineno-142-14" href="#__codelineno-142-14"></a><span class="cm">     * Start listening to events.</span>
<a id="__codelineno-142-15" name="__codelineno-142-15" href="#__codelineno-142-15"></a><span class="cm">     * </span>
<a id="__codelineno-142-16" name="__codelineno-142-16" href="#__codelineno-142-16"></a><span class="cm">     * @param _eventNames - The name(s) of the events to listen for (e.g. &#39;click&#39;, &#39;hover.menu&#39;)</span>
<a id="__codelineno-142-17" name="__codelineno-142-17" href="#__codelineno-142-17"></a><span class="cm">     * @param callback - The function to run when the event is triggered</span>
<a id="__codelineno-142-18" name="__codelineno-142-18" href="#__codelineno-142-18"></a><span class="cm">     */</span>
<a id="__codelineno-142-19" name="__codelineno-142-19" href="#__codelineno-142-19"></a><span class="w">    </span><span class="nx">on</span><span class="p">(</span><span class="nx">_eventNames</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-20" name="__codelineno-142-20" href="#__codelineno-142-20"></a><span class="w">        </span><span class="c1">// Check if event names or callback are missing</span>
<a id="__codelineno-142-21" name="__codelineno-142-21" href="#__codelineno-142-21"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">_eventNames</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">_eventNames</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-22" name="__codelineno-142-22" href="#__codelineno-142-22"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;wrong names&#39;</span><span class="p">)</span>
<a id="__codelineno-142-23" name="__codelineno-142-23" href="#__codelineno-142-23"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-142-24" name="__codelineno-142-24" href="#__codelineno-142-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-142-25" name="__codelineno-142-25" href="#__codelineno-142-25"></a>
<a id="__codelineno-142-26" name="__codelineno-142-26" href="#__codelineno-142-26"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">callback</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-27" name="__codelineno-142-27" href="#__codelineno-142-27"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;wrong callback&#39;</span><span class="p">)</span>
<a id="__codelineno-142-28" name="__codelineno-142-28" href="#__codelineno-142-28"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-142-29" name="__codelineno-142-29" href="#__codelineno-142-29"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-142-30" name="__codelineno-142-30" href="#__codelineno-142-30"></a>
<a id="__codelineno-142-31" name="__codelineno-142-31" href="#__codelineno-142-31"></a><span class="w">        </span><span class="c1">// Clean up and split the string of event names into an array</span>
<a id="__codelineno-142-32" name="__codelineno-142-32" href="#__codelineno-142-32"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">eventNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">resolveNames</span><span class="p">(</span><span class="nx">_eventNames</span><span class="p">)</span>
<a id="__codelineno-142-33" name="__codelineno-142-33" href="#__codelineno-142-33"></a>
<a id="__codelineno-142-34" name="__codelineno-142-34" href="#__codelineno-142-34"></a><span class="w">        </span><span class="c1">// Go through each event name in the list</span>
<a id="__codelineno-142-35" name="__codelineno-142-35" href="#__codelineno-142-35"></a><span class="w">        </span><span class="nx">eventNames</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">eventName</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-36" name="__codelineno-142-36" href="#__codelineno-142-36"></a><span class="w">            </span><span class="c1">// Separate the event name and namespace (e.g. &#39;hover.menu&#39; → value: &#39;hover&#39;, namespace: &#39;menu&#39;)</span>
<a id="__codelineno-142-37" name="__codelineno-142-37" href="#__codelineno-142-37"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">_eventName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">resolveName</span><span class="p">(</span><span class="nx">eventName</span><span class="p">)</span>
<a id="__codelineno-142-38" name="__codelineno-142-38" href="#__codelineno-142-38"></a>
<a id="__codelineno-142-39" name="__codelineno-142-39" href="#__codelineno-142-39"></a><span class="w">            </span><span class="c1">// If the namespace doesn’t exist yet, create it</span>
<a id="__codelineno-142-40" name="__codelineno-142-40" href="#__codelineno-142-40"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Object</span><span class="p">))</span>
<a id="__codelineno-142-41" name="__codelineno-142-41" href="#__codelineno-142-41"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-142-42" name="__codelineno-142-42" href="#__codelineno-142-42"></a>
<a id="__codelineno-142-43" name="__codelineno-142-43" href="#__codelineno-142-43"></a><span class="w">            </span><span class="c1">// If this specific event name doesn’t exist yet, create an empty list to store all the functions that listen to event</span>
<a id="__codelineno-142-44" name="__codelineno-142-44" href="#__codelineno-142-44"></a><span class="w">            </span><span class="c1">//If there is no list of callbacks yet for this specific event, create an empty one.&quot;</span>
<a id="__codelineno-142-45" name="__codelineno-142-45" href="#__codelineno-142-45"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Array</span><span class="p">))</span>
<a id="__codelineno-142-46" name="__codelineno-142-46" href="#__codelineno-142-46"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<a id="__codelineno-142-47" name="__codelineno-142-47" href="#__codelineno-142-47"></a>
<a id="__codelineno-142-48" name="__codelineno-142-48" href="#__codelineno-142-48"></a><span class="w">            </span><span class="c1">// Add the callback function to this event</span>
<a id="__codelineno-142-49" name="__codelineno-142-49" href="#__codelineno-142-49"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">value</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span>
<a id="__codelineno-142-50" name="__codelineno-142-50" href="#__codelineno-142-50"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-142-51" name="__codelineno-142-51" href="#__codelineno-142-51"></a>
<a id="__codelineno-142-52" name="__codelineno-142-52" href="#__codelineno-142-52"></a><span class="w">        </span><span class="c1">// Allow method chaining (e.g. emitter.on(...).on(...))</span>
<a id="__codelineno-142-53" name="__codelineno-142-53" href="#__codelineno-142-53"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span>
<a id="__codelineno-142-54" name="__codelineno-142-54" href="#__codelineno-142-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-142-55" name="__codelineno-142-55" href="#__codelineno-142-55"></a>
<a id="__codelineno-142-56" name="__codelineno-142-56" href="#__codelineno-142-56"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-142-57" name="__codelineno-142-57" href="#__codelineno-142-57"></a><span class="cm">     * Stop listening to one or more events.</span>
<a id="__codelineno-142-58" name="__codelineno-142-58" href="#__codelineno-142-58"></a><span class="cm">     * </span>
<a id="__codelineno-142-59" name="__codelineno-142-59" href="#__codelineno-142-59"></a><span class="cm">     * @param eventNames - One or more event names to remove (e.g. &#39;click&#39;, &#39;hover.menu&#39;, &#39;menu.&#39;)</span>
<a id="__codelineno-142-60" name="__codelineno-142-60" href="#__codelineno-142-60"></a><span class="cm">     */</span>
<a id="__codelineno-142-61" name="__codelineno-142-61" href="#__codelineno-142-61"></a><span class="w">    </span><span class="nx">off</span><span class="p">(</span><span class="nx">eventNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-62" name="__codelineno-142-62" href="#__codelineno-142-62"></a><span class="w">        </span><span class="c1">// Check if input is missing</span>
<a id="__codelineno-142-63" name="__codelineno-142-63" href="#__codelineno-142-63"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">eventNames</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">eventNames</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-64" name="__codelineno-142-64" href="#__codelineno-142-64"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;wrong name&#39;</span><span class="p">)</span>
<a id="__codelineno-142-65" name="__codelineno-142-65" href="#__codelineno-142-65"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-142-66" name="__codelineno-142-66" href="#__codelineno-142-66"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-142-67" name="__codelineno-142-67" href="#__codelineno-142-67"></a>
<a id="__codelineno-142-68" name="__codelineno-142-68" href="#__codelineno-142-68"></a><span class="w">        </span><span class="c1">// Clean up and split the string of event names into an array</span>
<a id="__codelineno-142-69" name="__codelineno-142-69" href="#__codelineno-142-69"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">_eventNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">resolveNames</span><span class="p">(</span><span class="nx">eventNames</span><span class="p">)</span>
<a id="__codelineno-142-70" name="__codelineno-142-70" href="#__codelineno-142-70"></a>
<a id="__codelineno-142-71" name="__codelineno-142-71" href="#__codelineno-142-71"></a><span class="w">        </span><span class="c1">// Go through each event name</span>
<a id="__codelineno-142-72" name="__codelineno-142-72" href="#__codelineno-142-72"></a><span class="w">        </span><span class="nx">_eventNames</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">eventName</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-73" name="__codelineno-142-73" href="#__codelineno-142-73"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">_eventName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">resolveName</span><span class="p">(</span><span class="nx">eventName</span><span class="p">)</span>
<a id="__codelineno-142-74" name="__codelineno-142-74" href="#__codelineno-142-74"></a>
<a id="__codelineno-142-75" name="__codelineno-142-75" href="#__codelineno-142-75"></a><span class="w">            </span><span class="c1">// If only a namespace was provided (e.g. &#39;menu.&#39;), remove the entire namespace</span>
<a id="__codelineno-142-76" name="__codelineno-142-76" href="#__codelineno-142-76"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;base&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-77" name="__codelineno-142-77" href="#__codelineno-142-77"></a><span class="w">                </span><span class="ow">delete</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">]</span>
<a id="__codelineno-142-78" name="__codelineno-142-78" href="#__codelineno-142-78"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-142-79" name="__codelineno-142-79" href="#__codelineno-142-79"></a>
<a id="__codelineno-142-80" name="__codelineno-142-80" href="#__codelineno-142-80"></a><span class="w">            </span><span class="c1">// Otherwise, remove a specific event in one or all namespaces</span>
<a id="__codelineno-142-81" name="__codelineno-142-81" href="#__codelineno-142-81"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-82" name="__codelineno-142-82" href="#__codelineno-142-82"></a><span class="w">                </span><span class="c1">// If no namespace is specified, try to remove the event from every namespace</span>
<a id="__codelineno-142-83" name="__codelineno-142-83" href="#__codelineno-142-83"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;base&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-84" name="__codelineno-142-84" href="#__codelineno-142-84"></a><span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-85" name="__codelineno-142-85" href="#__codelineno-142-85"></a><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-142-86" name="__codelineno-142-86" href="#__codelineno-142-86"></a><span class="w">                            </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Object</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-142-87" name="__codelineno-142-87" href="#__codelineno-142-87"></a><span class="w">                            </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Array</span>
<a id="__codelineno-142-88" name="__codelineno-142-88" href="#__codelineno-142-88"></a><span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-89" name="__codelineno-142-89" href="#__codelineno-142-89"></a><span class="w">                            </span><span class="c1">// Delete this event from the namespace</span>
<a id="__codelineno-142-90" name="__codelineno-142-90" href="#__codelineno-142-90"></a><span class="w">                            </span><span class="ow">delete</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span>
<a id="__codelineno-142-91" name="__codelineno-142-91" href="#__codelineno-142-91"></a>
<a id="__codelineno-142-92" name="__codelineno-142-92" href="#__codelineno-142-92"></a><span class="w">                            </span><span class="c1">// If the namespace is now empty, delete it too</span>
<a id="__codelineno-142-93" name="__codelineno-142-93" href="#__codelineno-142-93"></a><span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]).</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
<a id="__codelineno-142-94" name="__codelineno-142-94" href="#__codelineno-142-94"></a><span class="w">                                </span><span class="ow">delete</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span>
<a id="__codelineno-142-95" name="__codelineno-142-95" href="#__codelineno-142-95"></a><span class="w">                        </span><span class="p">}</span>
<a id="__codelineno-142-96" name="__codelineno-142-96" href="#__codelineno-142-96"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-142-97" name="__codelineno-142-97" href="#__codelineno-142-97"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-142-98" name="__codelineno-142-98" href="#__codelineno-142-98"></a>
<a id="__codelineno-142-99" name="__codelineno-142-99" href="#__codelineno-142-99"></a><span class="w">                </span><span class="c1">// If a specific namespace is given, remove only from that one</span>
<a id="__codelineno-142-100" name="__codelineno-142-100" href="#__codelineno-142-100"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-142-101" name="__codelineno-142-101" href="#__codelineno-142-101"></a><span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Object</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-142-102" name="__codelineno-142-102" href="#__codelineno-142-102"></a><span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Array</span>
<a id="__codelineno-142-103" name="__codelineno-142-103" href="#__codelineno-142-103"></a><span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-104" name="__codelineno-142-104" href="#__codelineno-142-104"></a><span class="w">                    </span><span class="ow">delete</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span>
<a id="__codelineno-142-105" name="__codelineno-142-105" href="#__codelineno-142-105"></a>
<a id="__codelineno-142-106" name="__codelineno-142-106" href="#__codelineno-142-106"></a><span class="w">                    </span><span class="c1">// Remove namespace if empty</span>
<a id="__codelineno-142-107" name="__codelineno-142-107" href="#__codelineno-142-107"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">]).</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
<a id="__codelineno-142-108" name="__codelineno-142-108" href="#__codelineno-142-108"></a><span class="w">                        </span><span class="ow">delete</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">_eventName</span><span class="p">.</span><span class="nx">namespace</span><span class="p">]</span>
<a id="__codelineno-142-109" name="__codelineno-142-109" href="#__codelineno-142-109"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-142-110" name="__codelineno-142-110" href="#__codelineno-142-110"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-142-111" name="__codelineno-142-111" href="#__codelineno-142-111"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-142-112" name="__codelineno-142-112" href="#__codelineno-142-112"></a>
<a id="__codelineno-142-113" name="__codelineno-142-113" href="#__codelineno-142-113"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span>
<a id="__codelineno-142-114" name="__codelineno-142-114" href="#__codelineno-142-114"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-142-115" name="__codelineno-142-115" href="#__codelineno-142-115"></a>
<a id="__codelineno-142-116" name="__codelineno-142-116" href="#__codelineno-142-116"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-142-117" name="__codelineno-142-117" href="#__codelineno-142-117"></a><span class="cm">     * Trigger (fire) an event so that all the functions listening to it will run.</span>
<a id="__codelineno-142-118" name="__codelineno-142-118" href="#__codelineno-142-118"></a><span class="cm">     * </span>
<a id="__codelineno-142-119" name="__codelineno-142-119" href="#__codelineno-142-119"></a><span class="cm">     * @param _eventName - The name of the event to trigger</span>
<a id="__codelineno-142-120" name="__codelineno-142-120" href="#__codelineno-142-120"></a><span class="cm">     * @param _args - Optional array of arguments to pass to the callback functions</span>
<a id="__codelineno-142-121" name="__codelineno-142-121" href="#__codelineno-142-121"></a><span class="cm">     */</span>
<a id="__codelineno-142-122" name="__codelineno-142-122" href="#__codelineno-142-122"></a><span class="w">    </span><span class="nx">trigger</span><span class="p">(</span><span class="nx">_eventName</span><span class="p">,</span><span class="w"> </span><span class="nx">_args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-123" name="__codelineno-142-123" href="#__codelineno-142-123"></a><span class="w">        </span><span class="c1">// Check if name is missing</span>
<a id="__codelineno-142-124" name="__codelineno-142-124" href="#__codelineno-142-124"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">_eventName</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">_eventName</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-125" name="__codelineno-142-125" href="#__codelineno-142-125"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;wrong name&#39;</span><span class="p">)</span>
<a id="__codelineno-142-126" name="__codelineno-142-126" href="#__codelineno-142-126"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-142-127" name="__codelineno-142-127" href="#__codelineno-142-127"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-142-128" name="__codelineno-142-128" href="#__codelineno-142-128"></a>
<a id="__codelineno-142-129" name="__codelineno-142-129" href="#__codelineno-142-129"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">finalResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a id="__codelineno-142-130" name="__codelineno-142-130" href="#__codelineno-142-130"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a id="__codelineno-142-131" name="__codelineno-142-131" href="#__codelineno-142-131"></a>
<a id="__codelineno-142-132" name="__codelineno-142-132" href="#__codelineno-142-132"></a><span class="w">        </span><span class="c1">// Make sure _args is an array, or use an empty array if none provided</span>
<a id="__codelineno-142-133" name="__codelineno-142-133" href="#__codelineno-142-133"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nx">_args</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Array</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">_args</span>
<a id="__codelineno-142-134" name="__codelineno-142-134" href="#__codelineno-142-134"></a>
<a id="__codelineno-142-135" name="__codelineno-142-135" href="#__codelineno-142-135"></a><span class="w">        </span><span class="c1">// Clean and resolve the event name</span>
<a id="__codelineno-142-136" name="__codelineno-142-136" href="#__codelineno-142-136"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">resolveNames</span><span class="p">(</span><span class="nx">_eventName</span><span class="p">)</span>
<a id="__codelineno-142-137" name="__codelineno-142-137" href="#__codelineno-142-137"></a><span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">resolveName</span><span class="p">(</span><span class="nx">name</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="w"> </span><span class="c1">// Only take the first resolved name</span>
<a id="__codelineno-142-138" name="__codelineno-142-138" href="#__codelineno-142-138"></a>
<a id="__codelineno-142-139" name="__codelineno-142-139" href="#__codelineno-142-139"></a><span class="w">        </span><span class="c1">// If no specific namespace is given</span>
<a id="__codelineno-142-140" name="__codelineno-142-140" href="#__codelineno-142-140"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">namespace</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;base&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-141" name="__codelineno-142-141" href="#__codelineno-142-141"></a><span class="w">            </span><span class="c1">// Look for the event in every namespace</span>
<a id="__codelineno-142-142" name="__codelineno-142-142" href="#__codelineno-142-142"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-143" name="__codelineno-142-143" href="#__codelineno-142-143"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-142-144" name="__codelineno-142-144" href="#__codelineno-142-144"></a><span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Object</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-142-145" name="__codelineno-142-145" href="#__codelineno-142-145"></a><span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">name</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Array</span>
<a id="__codelineno-142-146" name="__codelineno-142-146" href="#__codelineno-142-146"></a><span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-147" name="__codelineno-142-147" href="#__codelineno-142-147"></a><span class="w">                    </span><span class="c1">// Call every function attached to this event</span>
<a id="__codelineno-142-148" name="__codelineno-142-148" href="#__codelineno-142-148"></a><span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">name</span><span class="p">.</span><span class="nx">value</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-149" name="__codelineno-142-149" href="#__codelineno-142-149"></a><span class="w">                        </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span>
<a id="__codelineno-142-150" name="__codelineno-142-150" href="#__codelineno-142-150"></a>
<a id="__codelineno-142-151" name="__codelineno-142-151" href="#__codelineno-142-151"></a><span class="w">                        </span><span class="c1">// Store the first result returned</span>
<a id="__codelineno-142-152" name="__codelineno-142-152" href="#__codelineno-142-152"></a><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">finalResult</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-153" name="__codelineno-142-153" href="#__codelineno-142-153"></a><span class="w">                            </span><span class="nx">finalResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span>
<a id="__codelineno-142-154" name="__codelineno-142-154" href="#__codelineno-142-154"></a><span class="w">                        </span><span class="p">}</span>
<a id="__codelineno-142-155" name="__codelineno-142-155" href="#__codelineno-142-155"></a><span class="w">                    </span><span class="p">})</span>
<a id="__codelineno-142-156" name="__codelineno-142-156" href="#__codelineno-142-156"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-142-157" name="__codelineno-142-157" href="#__codelineno-142-157"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-142-158" name="__codelineno-142-158" href="#__codelineno-142-158"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-142-159" name="__codelineno-142-159" href="#__codelineno-142-159"></a>
<a id="__codelineno-142-160" name="__codelineno-142-160" href="#__codelineno-142-160"></a><span class="w">        </span><span class="c1">// If a specific namespace is given</span>
<a id="__codelineno-142-161" name="__codelineno-142-161" href="#__codelineno-142-161"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">name</span><span class="p">.</span><span class="nx">namespace</span><span class="p">]</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nb">Object</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-162" name="__codelineno-142-162" href="#__codelineno-142-162"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-163" name="__codelineno-142-163" href="#__codelineno-142-163"></a><span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;wrong name&#39;</span><span class="p">)</span>
<a id="__codelineno-142-164" name="__codelineno-142-164" href="#__codelineno-142-164"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="k">this</span>
<a id="__codelineno-142-165" name="__codelineno-142-165" href="#__codelineno-142-165"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-142-166" name="__codelineno-142-166" href="#__codelineno-142-166"></a>
<a id="__codelineno-142-167" name="__codelineno-142-167" href="#__codelineno-142-167"></a><span class="w">            </span><span class="c1">// Call every function attached to this event in the given namespace</span>
<a id="__codelineno-142-168" name="__codelineno-142-168" href="#__codelineno-142-168"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">name</span><span class="p">.</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">name</span><span class="p">.</span><span class="nx">value</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-169" name="__codelineno-142-169" href="#__codelineno-142-169"></a><span class="w">                </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span>
<a id="__codelineno-142-170" name="__codelineno-142-170" href="#__codelineno-142-170"></a>
<a id="__codelineno-142-171" name="__codelineno-142-171" href="#__codelineno-142-171"></a><span class="w">                </span><span class="c1">// Store the first result</span>
<a id="__codelineno-142-172" name="__codelineno-142-172" href="#__codelineno-142-172"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">finalResult</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
<a id="__codelineno-142-173" name="__codelineno-142-173" href="#__codelineno-142-173"></a><span class="w">                    </span><span class="nx">finalResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span>
<a id="__codelineno-142-174" name="__codelineno-142-174" href="#__codelineno-142-174"></a><span class="w">            </span><span class="p">})</span>
<a id="__codelineno-142-175" name="__codelineno-142-175" href="#__codelineno-142-175"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-142-176" name="__codelineno-142-176" href="#__codelineno-142-176"></a>
<a id="__codelineno-142-177" name="__codelineno-142-177" href="#__codelineno-142-177"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">finalResult</span>
<a id="__codelineno-142-178" name="__codelineno-142-178" href="#__codelineno-142-178"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-142-179" name="__codelineno-142-179" href="#__codelineno-142-179"></a>
<a id="__codelineno-142-180" name="__codelineno-142-180" href="#__codelineno-142-180"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-142-181" name="__codelineno-142-181" href="#__codelineno-142-181"></a><span class="cm">     * Helper function that cleans and splits event name strings.</span>
<a id="__codelineno-142-182" name="__codelineno-142-182" href="#__codelineno-142-182"></a><span class="cm">     * </span>
<a id="__codelineno-142-183" name="__codelineno-142-183" href="#__codelineno-142-183"></a><span class="cm">     * Example: &#39;click, move.menu&#39; → [&#39;click&#39;, &#39;move.menu&#39;]</span>
<a id="__codelineno-142-184" name="__codelineno-142-184" href="#__codelineno-142-184"></a><span class="cm">     */</span>
<a id="__codelineno-142-185" name="__codelineno-142-185" href="#__codelineno-142-185"></a><span class="w">    </span><span class="nx">resolveNames</span><span class="p">(</span><span class="nx">_eventNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-186" name="__codelineno-142-186" href="#__codelineno-142-186"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_eventNames</span>
<a id="__codelineno-142-187" name="__codelineno-142-187" href="#__codelineno-142-187"></a>
<a id="__codelineno-142-188" name="__codelineno-142-188" href="#__codelineno-142-188"></a><span class="w">        </span><span class="c1">// Remove weird characters except letters, numbers, commas, slashes, and dots</span>
<a id="__codelineno-142-189" name="__codelineno-142-189" href="#__codelineno-142-189"></a><span class="w">        </span><span class="nx">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^a-zA-Z0-9 ,/.]/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-142-190" name="__codelineno-142-190" href="#__codelineno-142-190"></a>
<a id="__codelineno-142-191" name="__codelineno-142-191" href="#__codelineno-142-191"></a><span class="w">        </span><span class="c1">// Convert commas and slashes to spaces</span>
<a id="__codelineno-142-192" name="__codelineno-142-192" href="#__codelineno-142-192"></a><span class="w">        </span><span class="nx">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[,/]+/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<a id="__codelineno-142-193" name="__codelineno-142-193" href="#__codelineno-142-193"></a>
<a id="__codelineno-142-194" name="__codelineno-142-194" href="#__codelineno-142-194"></a><span class="w">        </span><span class="c1">// Split by space into an array</span>
<a id="__codelineno-142-195" name="__codelineno-142-195" href="#__codelineno-142-195"></a><span class="w">        </span><span class="nx">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<a id="__codelineno-142-196" name="__codelineno-142-196" href="#__codelineno-142-196"></a>
<a id="__codelineno-142-197" name="__codelineno-142-197" href="#__codelineno-142-197"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">names</span>
<a id="__codelineno-142-198" name="__codelineno-142-198" href="#__codelineno-142-198"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-142-199" name="__codelineno-142-199" href="#__codelineno-142-199"></a>
<a id="__codelineno-142-200" name="__codelineno-142-200" href="#__codelineno-142-200"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-142-201" name="__codelineno-142-201" href="#__codelineno-142-201"></a><span class="cm">     * Helper function that splits a name like &#39;move.menu&#39; into:</span>
<a id="__codelineno-142-202" name="__codelineno-142-202" href="#__codelineno-142-202"></a><span class="cm">     * {</span>
<a id="__codelineno-142-203" name="__codelineno-142-203" href="#__codelineno-142-203"></a><span class="cm">     *   original: &#39;move.menu&#39;,</span>
<a id="__codelineno-142-204" name="__codelineno-142-204" href="#__codelineno-142-204"></a><span class="cm">     *   value: &#39;move&#39;,</span>
<a id="__codelineno-142-205" name="__codelineno-142-205" href="#__codelineno-142-205"></a><span class="cm">     *   namespace: &#39;menu&#39;</span>
<a id="__codelineno-142-206" name="__codelineno-142-206" href="#__codelineno-142-206"></a><span class="cm">     * }</span>
<a id="__codelineno-142-207" name="__codelineno-142-207" href="#__codelineno-142-207"></a><span class="cm">     */</span>
<a id="__codelineno-142-208" name="__codelineno-142-208" href="#__codelineno-142-208"></a><span class="w">    </span><span class="nx">resolveName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-209" name="__codelineno-142-209" href="#__codelineno-142-209"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">newName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-142-210" name="__codelineno-142-210" href="#__codelineno-142-210"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-142-211" name="__codelineno-142-211" href="#__codelineno-142-211"></a>
<a id="__codelineno-142-212" name="__codelineno-142-212" href="#__codelineno-142-212"></a><span class="w">        </span><span class="nx">newName</span><span class="p">.</span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span>
<a id="__codelineno-142-213" name="__codelineno-142-213" href="#__codelineno-142-213"></a><span class="w">        </span><span class="nx">newName</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="c1">// The event name (e.g. &#39;move&#39;)</span>
<a id="__codelineno-142-214" name="__codelineno-142-214" href="#__codelineno-142-214"></a><span class="w">        </span><span class="nx">newName</span><span class="p">.</span><span class="nx">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;base&#39;</span><span class="w"> </span><span class="c1">// Default to &#39;base&#39; if no namespace is given</span>
<a id="__codelineno-142-215" name="__codelineno-142-215" href="#__codelineno-142-215"></a>
<a id="__codelineno-142-216" name="__codelineno-142-216" href="#__codelineno-142-216"></a><span class="w">        </span><span class="c1">// If there&#39;s a namespace, use it</span>
<a id="__codelineno-142-217" name="__codelineno-142-217" href="#__codelineno-142-217"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">parts</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-218" name="__codelineno-142-218" href="#__codelineno-142-218"></a><span class="w">            </span><span class="nx">newName</span><span class="p">.</span><span class="nx">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span>
<a id="__codelineno-142-219" name="__codelineno-142-219" href="#__codelineno-142-219"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-142-220" name="__codelineno-142-220" href="#__codelineno-142-220"></a>
<a id="__codelineno-142-221" name="__codelineno-142-221" href="#__codelineno-142-221"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">newName</span>
<a id="__codelineno-142-222" name="__codelineno-142-222" href="#__codelineno-142-222"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-142-223" name="__codelineno-142-223" href="#__codelineno-142-223"></a><span class="p">}</span>
</code></pre></div></p>
<p>Now we can let the <code>Sizes</code> class inherit from the Event</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">EventEmitter</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;/EventEmitter.js&#39;</span>
<a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Sizes</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">EventEmitter</span>
<a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="p">{</span>
<a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a><span class="w">    </span><span class="k">super</span><span class="p">()</span>
<a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a>
<a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a><span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-143-8" name="__codelineno-143-8" href="#__codelineno-143-8"></a><span class="w">      </span><span class="c1">//we trigger from inside the Sizes class</span>
<a id="__codelineno-143-9" name="__codelineno-143-9" href="#__codelineno-143-9"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">)</span>
<a id="__codelineno-143-10" name="__codelineno-143-10" href="#__codelineno-143-10"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-143-11" name="__codelineno-143-11" href="#__codelineno-143-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-143-12" name="__codelineno-143-12" href="#__codelineno-143-12"></a><span class="p">}</span>
<a id="__codelineno-143-13" name="__codelineno-143-13" href="#__codelineno-143-13"></a><span class="k">import</span><span class="w"> </span><span class="nx">Sizes</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;/Utils/Sizes.js&#39;</span>
<a id="__codelineno-143-14" name="__codelineno-143-14" href="#__codelineno-143-14"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-143-15" name="__codelineno-143-15" href="#__codelineno-143-15"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-143-16" name="__codelineno-143-16" href="#__codelineno-143-16"></a><span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-143-17" name="__codelineno-143-17" href="#__codelineno-143-17"></a>
<a id="__codelineno-143-18" name="__codelineno-143-18" href="#__codelineno-143-18"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span>
<a id="__codelineno-143-19" name="__codelineno-143-19" href="#__codelineno-143-19"></a>
<a id="__codelineno-143-20" name="__codelineno-143-20" href="#__codelineno-143-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Sizes</span><span class="p">()</span>
<a id="__codelineno-143-21" name="__codelineno-143-21" href="#__codelineno-143-21"></a>
<a id="__codelineno-143-22" name="__codelineno-143-22" href="#__codelineno-143-22"></a><span class="w">    </span><span class="c1">//Listen to the event from outside</span>
<a id="__codelineno-143-23" name="__codelineno-143-23" href="#__codelineno-143-23"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,()=&gt;{</span>
<a id="__codelineno-143-24" name="__codelineno-143-24" href="#__codelineno-143-24"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">resize</span><span class="p">()</span>
<a id="__codelineno-143-25" name="__codelineno-143-25" href="#__codelineno-143-25"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-143-26" name="__codelineno-143-26" href="#__codelineno-143-26"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-143-27" name="__codelineno-143-27" href="#__codelineno-143-27"></a>
<a id="__codelineno-143-28" name="__codelineno-143-28" href="#__codelineno-143-28"></a>
<a id="__codelineno-143-29" name="__codelineno-143-29" href="#__codelineno-143-29"></a><span class="w">  </span><span class="nx">resize</span><span class="p">(){</span>
<a id="__codelineno-143-30" name="__codelineno-143-30" href="#__codelineno-143-30"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Window resize happended&quot;</span><span class="p">)</span>
<a id="__codelineno-143-31" name="__codelineno-143-31" href="#__codelineno-143-31"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-143-32" name="__codelineno-143-32" href="#__codelineno-143-32"></a><span class="p">}</span>
</code></pre></div>
<h3 id="time">Time</h3>
<p>A <code>Time</code> class can be useful to store values like <code>currentTime</code>,<code>deltaTime</code></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">EventEmitter</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;/EventEmitter.js&#39;</span>
<a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a>
<a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Time</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">EventEmitter</span>
<a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="p">{</span>
<a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a><span class="w">    </span><span class="k">super</span><span class="p">()</span>
<a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="c1">// Starttime of experience</span>
<a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="w"> </span><span class="c1">// currenttimestand that changes each frame</span>
<a id="__codelineno-144-9" name="__codelineno-144-9" href="#__codelineno-144-9"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="c1">// how much time was spent since start of experience</span>
<a id="__codelineno-144-10" name="__codelineno-144-10" href="#__codelineno-144-10"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">16</span><span class="w"> </span><span class="c1">// how much time was spent since preivous frame - 16 is close to how many milliseconds there ibetween two frames at 60fps</span>
<a id="__codelineno-144-11" name="__codelineno-144-11" href="#__codelineno-144-11"></a><span class="w">  </span><span class="c1">//To avoid delta = 0 on first frame we call window.requestAnimation here</span>
<a id="__codelineno-144-12" name="__codelineno-144-12" href="#__codelineno-144-12"></a><span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(()=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-144-13" name="__codelineno-144-13" href="#__codelineno-144-13"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">()</span>
<a id="__codelineno-144-14" name="__codelineno-144-14" href="#__codelineno-144-14"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-144-15" name="__codelineno-144-15" href="#__codelineno-144-15"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-144-16" name="__codelineno-144-16" href="#__codelineno-144-16"></a>
<a id="__codelineno-144-17" name="__codelineno-144-17" href="#__codelineno-144-17"></a><span class="w">  </span><span class="nx">tick</span><span class="p">(){</span>
<a id="__codelineno-144-18" name="__codelineno-144-18" href="#__codelineno-144-18"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<a id="__codelineno-144-19" name="__codelineno-144-19" href="#__codelineno-144-19"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currenTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">current</span>
<a id="__codelineno-144-20" name="__codelineno-144-20" href="#__codelineno-144-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">;</span>
<a id="__codelineno-144-21" name="__codelineno-144-21" href="#__codelineno-144-21"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">start</span>
<a id="__codelineno-144-22" name="__codelineno-144-22" href="#__codelineno-144-22"></a>
<a id="__codelineno-144-23" name="__codelineno-144-23" href="#__codelineno-144-23"></a>
<a id="__codelineno-144-24" name="__codelineno-144-24" href="#__codelineno-144-24"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;tick&#39;</span><span class="p">)</span>
<a id="__codelineno-144-25" name="__codelineno-144-25" href="#__codelineno-144-25"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;tick&#39;</span><span class="p">)</span>
<a id="__codelineno-144-26" name="__codelineno-144-26" href="#__codelineno-144-26"></a><span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(()=&gt;{</span>
<a id="__codelineno-144-27" name="__codelineno-144-27" href="#__codelineno-144-27"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">()</span>
<a id="__codelineno-144-28" name="__codelineno-144-28" href="#__codelineno-144-28"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-144-29" name="__codelineno-144-29" href="#__codelineno-144-29"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-144-30" name="__codelineno-144-30" href="#__codelineno-144-30"></a>
<a id="__codelineno-144-31" name="__codelineno-144-31" href="#__codelineno-144-31"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="p">...</span>
<a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="k">import</span><span class="w"> </span><span class="nx">Time</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;/Utils/Time.js&#39;</span>
<a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a>
<a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="p">{</span>
<a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-145-7" name="__codelineno-145-7" href="#__codelineno-145-7"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;tick&#39;</span><span class="p">,()=&gt;{</span>
<a id="__codelineno-145-8" name="__codelineno-145-8" href="#__codelineno-145-8"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
<a id="__codelineno-145-9" name="__codelineno-145-9" href="#__codelineno-145-9"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-145-10" name="__codelineno-145-10" href="#__codelineno-145-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-145-11" name="__codelineno-145-11" href="#__codelineno-145-11"></a>
<a id="__codelineno-145-12" name="__codelineno-145-12" href="#__codelineno-145-12"></a><span class="w">  </span><span class="nx">update</span><span class="p">(){</span>
<a id="__codelineno-145-13" name="__codelineno-145-13" href="#__codelineno-145-13"></a>
<a id="__codelineno-145-14" name="__codelineno-145-14" href="#__codelineno-145-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-145-15" name="__codelineno-145-15" href="#__codelineno-145-15"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="import-threejs-with-cameraetc">Import Three.js with Camera,etc</h3>
<p>To handle the camera seprately we can create its own class for it</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Camera</span><span class="p">{</span>
<a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a>
<a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a><span class="p">}</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">THREE</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three&#39;</span>
<a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="p">...</span>
<a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="p">{</span>
<a id="__codelineno-147-4" name="__codelineno-147-4" href="#__codelineno-147-4"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-147-5" name="__codelineno-147-5" href="#__codelineno-147-5"></a><span class="w">    </span><span class="c1">//...</span>
<a id="__codelineno-147-6" name="__codelineno-147-6" href="#__codelineno-147-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Sizes</span><span class="p">()</span>
<a id="__codelineno-147-7" name="__codelineno-147-7" href="#__codelineno-147-7"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Time</span><span class="p">()</span>
<a id="__codelineno-147-8" name="__codelineno-147-8" href="#__codelineno-147-8"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">()</span>
<a id="__codelineno-147-9" name="__codelineno-147-9" href="#__codelineno-147-9"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Camera</span><span class="p">()</span>
<a id="__codelineno-147-10" name="__codelineno-147-10" href="#__codelineno-147-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-147-11" name="__codelineno-147-11" href="#__codelineno-147-11"></a><span class="p">}</span>
</code></pre></div>
In the <code>Camera</code> class we need to access properties from other classes like <code>Sizes</code> and maybe <code>Time</code>. 
Ways to access values and properties from the <code>Experience</code> class from the camera
- (1) Global variable
- (2) Sending parameters
- (3) using singleton</p>
<p>(1) 
With <code>window.experience = this</code> we add the experience as a global object to the window which makes <code>experience</code> accessible everywhere in the code.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Camera</span>
<a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="p">{</span>
<a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">experience</span>
<a id="__codelineno-148-5" name="__codelineno-148-5" href="#__codelineno-148-5"></a>
<a id="__codelineno-148-6" name="__codelineno-148-6" href="#__codelineno-148-6"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">)</span>
<a id="__codelineno-148-7" name="__codelineno-148-7" href="#__codelineno-148-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-148-8" name="__codelineno-148-8" href="#__codelineno-148-8"></a><span class="p">}</span>
</code></pre></div>
This can make sense to use if you are 100% sure to use just one experience.
(2)
To pass the experience as a parameter
<div class="highlight"><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="p">{</span>
<a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a><span class="w">    </span><span class="c1">//this == experience instance</span>
<a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Camera</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-149-7" name="__codelineno-149-7" href="#__codelineno-149-7"></a><span class="p">}</span>
<a id="__codelineno-149-8" name="__codelineno-149-8" href="#__codelineno-149-8"></a><span class="p">}</span>
<a id="__codelineno-149-9" name="__codelineno-149-9" href="#__codelineno-149-9"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Camera</span>
<a id="__codelineno-149-10" name="__codelineno-149-10" href="#__codelineno-149-10"></a><span class="p">{</span>
<a id="__codelineno-149-11" name="__codelineno-149-11" href="#__codelineno-149-11"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">experience</span><span class="p">){</span>
<a id="__codelineno-149-12" name="__codelineno-149-12" href="#__codelineno-149-12"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">experience</span>
<a id="__codelineno-149-13" name="__codelineno-149-13" href="#__codelineno-149-13"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-149-14" name="__codelineno-149-14" href="#__codelineno-149-14"></a><span class="p">}</span>
</code></pre></div>
(3)
A singleton is a coding design pattern that assures that you only have <code>one</code> instance of something. And everytime we create a new instance of the same thing it references to the first created instance.
<div class="highlight"><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a>
<a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="w"> </span>
<a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a><span class="p">{</span>
<a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">instance</span><span class="p">){</span>
<a id="__codelineno-150-7" name="__codelineno-150-7" href="#__codelineno-150-7"></a><span class="w">      </span><span class="c1">//if instance already contains something leave the function </span>
<a id="__codelineno-150-8" name="__codelineno-150-8" href="#__codelineno-150-8"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">instance</span>
<a id="__codelineno-150-9" name="__codelineno-150-9" href="#__codelineno-150-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-150-10" name="__codelineno-150-10" href="#__codelineno-150-10"></a><span class="w">    </span><span class="c1">//if instance is still null assign this instance experience to instance</span>
<a id="__codelineno-150-11" name="__codelineno-150-11" href="#__codelineno-150-11"></a><span class="w">    </span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span>
<a id="__codelineno-150-12" name="__codelineno-150-12" href="#__codelineno-150-12"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-150-13" name="__codelineno-150-13" href="#__codelineno-150-13"></a>
<a id="__codelineno-150-14" name="__codelineno-150-14" href="#__codelineno-150-14"></a>
<a id="__codelineno-150-15" name="__codelineno-150-15" href="#__codelineno-150-15"></a><span class="w">  </span><span class="nx">resize</span><span class="p">(){</span>
<a id="__codelineno-150-16" name="__codelineno-150-16" href="#__codelineno-150-16"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">resize</span><span class="p">()</span>
<a id="__codelineno-150-17" name="__codelineno-150-17" href="#__codelineno-150-17"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-150-18" name="__codelineno-150-18" href="#__codelineno-150-18"></a><span class="p">}</span>
<a id="__codelineno-150-19" name="__codelineno-150-19" href="#__codelineno-150-19"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Camera</span>
<a id="__codelineno-150-20" name="__codelineno-150-20" href="#__codelineno-150-20"></a><span class="p">{</span>
<a id="__codelineno-150-21" name="__codelineno-150-21" href="#__codelineno-150-21"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-150-22" name="__codelineno-150-22" href="#__codelineno-150-22"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Experience</span><span class="p">()</span>
<a id="__codelineno-150-23" name="__codelineno-150-23" href="#__codelineno-150-23"></a><span class="w">    </span><span class="c1">// from the experience class we get the sizes</span>
<a id="__codelineno-150-24" name="__codelineno-150-24" href="#__codelineno-150-24"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">.</span><span class="nx">sizes</span>
<a id="__codelineno-150-25" name="__codelineno-150-25" href="#__codelineno-150-25"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">.</span><span class="nx">scene</span>
<a id="__codelineno-150-26" name="__codelineno-150-26" href="#__codelineno-150-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">.</span><span class="nx">canvas</span>
<a id="__codelineno-150-27" name="__codelineno-150-27" href="#__codelineno-150-27"></a>
<a id="__codelineno-150-28" name="__codelineno-150-28" href="#__codelineno-150-28"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setCamInstance</span><span class="p">()</span>
<a id="__codelineno-150-29" name="__codelineno-150-29" href="#__codelineno-150-29"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setOrbitInstance</span><span class="p">()</span>
<a id="__codelineno-150-30" name="__codelineno-150-30" href="#__codelineno-150-30"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-150-31" name="__codelineno-150-31" href="#__codelineno-150-31"></a><span class="w">  </span><span class="nx">setCamInstance</span><span class="p">(){</span>
<a id="__codelineno-150-32" name="__codelineno-150-32" href="#__codelineno-150-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span><span class="mf">35</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="mf">100</span><span class="p">)</span>
<a id="__codelineno-150-33" name="__codelineno-150-33" href="#__codelineno-150-33"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camInstance</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">,</span><span class="mf">5</span><span class="p">)</span>
<a id="__codelineno-150-34" name="__codelineno-150-34" href="#__codelineno-150-34"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">camInstance</span><span class="p">)</span>
<a id="__codelineno-150-35" name="__codelineno-150-35" href="#__codelineno-150-35"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-150-36" name="__codelineno-150-36" href="#__codelineno-150-36"></a><span class="w">  </span><span class="nx">setOrbitInstance</span><span class="p">(){</span>
<a id="__codelineno-150-37" name="__codelineno-150-37" href="#__codelineno-150-37"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">OrbitControls</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">camInstance</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">)</span>
<a id="__codelineno-150-38" name="__codelineno-150-38" href="#__codelineno-150-38"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">enableDamping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-150-39" name="__codelineno-150-39" href="#__codelineno-150-39"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-150-40" name="__codelineno-150-40" href="#__codelineno-150-40"></a>
<a id="__codelineno-150-41" name="__codelineno-150-41" href="#__codelineno-150-41"></a><span class="w">  </span><span class="nx">resize</span><span class="p">(){</span>
<a id="__codelineno-150-42" name="__codelineno-150-42" href="#__codelineno-150-42"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camInstance</span><span class="p">.</span><span class="nx">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span>
<a id="__codelineno-150-43" name="__codelineno-150-43" href="#__codelineno-150-43"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">updateProjectionMatrix</span><span class="p">()</span>
<a id="__codelineno-150-44" name="__codelineno-150-44" href="#__codelineno-150-44"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-150-45" name="__codelineno-150-45" href="#__codelineno-150-45"></a><span class="p">}</span>
</code></pre></div></p>
<p>Similar to the camera we can create a class for the renderer
<div class="highlight"><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">THREE</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three&#39;</span>
<a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Renderer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Experience</span><span class="p">();</span>
<a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">.</span><span class="nx">canvas</span><span class="p">;</span>
<a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">.</span><span class="nx">sizes</span><span class="p">;</span>
<a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">szene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">.</span><span class="nx">scene</span><span class="p">;</span>
<a id="__codelineno-151-8" name="__codelineno-151-8" href="#__codelineno-151-8"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">.</span><span class="nx">camera</span><span class="p">;</span>
<a id="__codelineno-151-9" name="__codelineno-151-9" href="#__codelineno-151-9"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setRendererInstance</span><span class="p">()</span>
<a id="__codelineno-151-10" name="__codelineno-151-10" href="#__codelineno-151-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-151-11" name="__codelineno-151-11" href="#__codelineno-151-11"></a>
<a id="__codelineno-151-12" name="__codelineno-151-12" href="#__codelineno-151-12"></a><span class="w">  </span><span class="nx">setRendererInstance</span><span class="p">(){</span>
<a id="__codelineno-151-13" name="__codelineno-151-13" href="#__codelineno-151-13"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span><span class="p">({</span>
<a id="__codelineno-151-14" name="__codelineno-151-14" href="#__codelineno-151-14"></a><span class="w">      </span><span class="nx">canvas</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">,</span>
<a id="__codelineno-151-15" name="__codelineno-151-15" href="#__codelineno-151-15"></a><span class="w">      </span><span class="nx">antialias</span><span class="o">:</span><span class="kc">true</span>
<a id="__codelineno-151-16" name="__codelineno-151-16" href="#__codelineno-151-16"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-151-17" name="__codelineno-151-17" href="#__codelineno-151-17"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">toneMapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">CineonToneMapping</span>
<a id="__codelineno-151-18" name="__codelineno-151-18" href="#__codelineno-151-18"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">toneMappingExposure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.75</span>
<a id="__codelineno-151-19" name="__codelineno-151-19" href="#__codelineno-151-19"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">shadowMap</span><span class="p">.</span><span class="nx">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-151-20" name="__codelineno-151-20" href="#__codelineno-151-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">shadowMap</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">PCFSoftShadowMap</span><span class="p">;</span>
<a id="__codelineno-151-21" name="__codelineno-151-21" href="#__codelineno-151-21"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
<a id="__codelineno-151-22" name="__codelineno-151-22" href="#__codelineno-151-22"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">setPixelRation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">pixelRatio</span><span class="p">);</span>
<a id="__codelineno-151-23" name="__codelineno-151-23" href="#__codelineno-151-23"></a>
<a id="__codelineno-151-24" name="__codelineno-151-24" href="#__codelineno-151-24"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-151-25" name="__codelineno-151-25" href="#__codelineno-151-25"></a><span class="w">  </span><span class="nx">resize</span><span class="p">(){</span>
<a id="__codelineno-151-26" name="__codelineno-151-26" href="#__codelineno-151-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
<a id="__codelineno-151-27" name="__codelineno-151-27" href="#__codelineno-151-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">setPixelRatio</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">pixelRatio</span><span class="p">);</span>
<a id="__codelineno-151-28" name="__codelineno-151-28" href="#__codelineno-151-28"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-151-29" name="__codelineno-151-29" href="#__codelineno-151-29"></a><span class="w">  </span><span class="nx">update</span><span class="p">(){</span>
<a id="__codelineno-151-30" name="__codelineno-151-30" href="#__codelineno-151-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">camInstance</span><span class="p">);</span>
<a id="__codelineno-151-31" name="__codelineno-151-31" href="#__codelineno-151-31"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-151-32" name="__codelineno-151-32" href="#__codelineno-151-32"></a><span class="p">}</span>
<a id="__codelineno-151-33" name="__codelineno-151-33" href="#__codelineno-151-33"></a>
<a id="__codelineno-151-34" name="__codelineno-151-34" href="#__codelineno-151-34"></a><span class="k">import</span><span class="w"> </span><span class="nx">Renderer</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;/Renderer.js&#39;</span>
<a id="__codelineno-151-35" name="__codelineno-151-35" href="#__codelineno-151-35"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="p">{</span>
<a id="__codelineno-151-36" name="__codelineno-151-36" href="#__codelineno-151-36"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">){</span>
<a id="__codelineno-151-37" name="__codelineno-151-37" href="#__codelineno-151-37"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-151-38" name="__codelineno-151-38" href="#__codelineno-151-38"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Renderer</span><span class="p">()</span>
<a id="__codelineno-151-39" name="__codelineno-151-39" href="#__codelineno-151-39"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-151-40" name="__codelineno-151-40" href="#__codelineno-151-40"></a>
<a id="__codelineno-151-41" name="__codelineno-151-41" href="#__codelineno-151-41"></a><span class="w">  </span><span class="nx">resize</span><span class="p">(){</span>
<a id="__codelineno-151-42" name="__codelineno-151-42" href="#__codelineno-151-42"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">resize</span><span class="p">();</span>
<a id="__codelineno-151-43" name="__codelineno-151-43" href="#__codelineno-151-43"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">resize</span><span class="p">();</span>
<a id="__codelineno-151-44" name="__codelineno-151-44" href="#__codelineno-151-44"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-151-45" name="__codelineno-151-45" href="#__codelineno-151-45"></a>
<a id="__codelineno-151-46" name="__codelineno-151-46" href="#__codelineno-151-46"></a><span class="w">  </span><span class="nx">update</span><span class="p">(){</span>
<a id="__codelineno-151-47" name="__codelineno-151-47" href="#__codelineno-151-47"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
<a id="__codelineno-151-48" name="__codelineno-151-48" href="#__codelineno-151-48"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
<a id="__codelineno-151-49" name="__codelineno-151-49" href="#__codelineno-151-49"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-151-50" name="__codelineno-151-50" href="#__codelineno-151-50"></a><span class="p">}</span>
</code></pre></div></p>
<p>And collect then all elements in a <code>World</code> class</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">World</span><span class="p">{</span>
<a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Experience</span><span class="p">();</span>
<a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">experience</span><span class="p">.</span><span class="nx">scene</span><span class="p">;</span>
<a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a><span class="p">}</span>
</code></pre></div>
<p>For the world class we then can create classes like <code>Environment</code> with contain the lights, environmentmaps etc.</p>
<p>What can make the code more structured is also a <code>ResourceLoader</code> class dedicated to loading the models
<div class="highlight"><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">EventEmitter</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;/EventEmitter.js&#39;</span>
<a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">THREE</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three&#39;</span>
<a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">GLTFLoader</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;three/examples/jsm/loaders/GLTFLoader.js&#39;</span>
<a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ResourceLoader</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">EventEmitter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">sources</span><span class="p">){</span>
<a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a><span class="w">    </span><span class="k">super</span><span class="p">()</span>
<a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sources</span>
<a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a>
<a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-153-10" name="__codelineno-153-10" href="#__codelineno-153-10"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">toLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<a id="__codelineno-153-11" name="__codelineno-153-11" href="#__codelineno-153-11"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-153-12" name="__codelineno-153-12" href="#__codelineno-153-12"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setLoaders</span><span class="p">();</span>
<a id="__codelineno-153-13" name="__codelineno-153-13" href="#__codelineno-153-13"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">startLoading</span><span class="p">();</span>
<a id="__codelineno-153-14" name="__codelineno-153-14" href="#__codelineno-153-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-153-15" name="__codelineno-153-15" href="#__codelineno-153-15"></a><span class="w">  </span><span class="nx">setLoaders</span><span class="p">(){</span>
<a id="__codelineno-153-16" name="__codelineno-153-16" href="#__codelineno-153-16"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">loaders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-153-17" name="__codelineno-153-17" href="#__codelineno-153-17"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">gltfLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GLTFLoader</span><span class="p">();</span>
<a id="__codelineno-153-18" name="__codelineno-153-18" href="#__codelineno-153-18"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">textureLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">TextureLoader</span><span class="p">();</span>
<a id="__codelineno-153-19" name="__codelineno-153-19" href="#__codelineno-153-19"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">cubeTextureLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">CubeTextureLoader</span><span class="p">();</span>
<a id="__codelineno-153-20" name="__codelineno-153-20" href="#__codelineno-153-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-153-21" name="__codelineno-153-21" href="#__codelineno-153-21"></a>
<a id="__codelineno-153-22" name="__codelineno-153-22" href="#__codelineno-153-22"></a><span class="w">  </span><span class="nx">startLoader</span><span class="p">(){</span>
<a id="__codelineno-153-23" name="__codelineno-153-23" href="#__codelineno-153-23"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">src</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">sources</span><span class="p">){</span>
<a id="__codelineno-153-24" name="__codelineno-153-24" href="#__codelineno-153-24"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;gltfModel&#39;</span><span class="p">){</span>
<a id="__codelineno-153-25" name="__codelineno-153-25" href="#__codelineno-153-25"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">gltfLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">path</span><span class="p">,(</span><span class="nx">file</span><span class="p">)=&gt;{</span>
<a id="__codelineno-153-26" name="__codelineno-153-26" href="#__codelineno-153-26"></a><span class="w">          </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="nx">src</span><span class="p">);</span>
<a id="__codelineno-153-27" name="__codelineno-153-27" href="#__codelineno-153-27"></a><span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="nx">sourceLoaded</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span><span class="nx">file</span><span class="p">);</span>
<a id="__codelineno-153-28" name="__codelineno-153-28" href="#__codelineno-153-28"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-153-29" name="__codelineno-153-29" href="#__codelineno-153-29"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">type</span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;texture&#39;</span><span class="p">){</span>
<a id="__codelineno-153-30" name="__codelineno-153-30" href="#__codelineno-153-30"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">textureLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span>
<a id="__codelineno-153-31" name="__codelineno-153-31" href="#__codelineno-153-31"></a><span class="w">          </span><span class="nx">src</span><span class="p">.</span><span class="nx">path</span><span class="p">,(</span><span class="nx">file</span><span class="p">)=&gt;{</span>
<a id="__codelineno-153-32" name="__codelineno-153-32" href="#__codelineno-153-32"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="nx">src</span><span class="p">);</span>
<a id="__codelineno-153-33" name="__codelineno-153-33" href="#__codelineno-153-33"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">sourceLoaded</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span><span class="nx">file</span><span class="p">);</span>
<a id="__codelineno-153-34" name="__codelineno-153-34" href="#__codelineno-153-34"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-153-35" name="__codelineno-153-35" href="#__codelineno-153-35"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-153-36" name="__codelineno-153-36" href="#__codelineno-153-36"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">type</span><span class="o">===</span><span class="s1">&#39;cubeTexture&#39;</span><span class="p">){</span>
<a id="__codelineno-153-37" name="__codelineno-153-37" href="#__codelineno-153-37"></a><span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">cubeTextureLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span>
<a id="__codelineno-153-38" name="__codelineno-153-38" href="#__codelineno-153-38"></a><span class="w">            </span><span class="nx">src</span><span class="p">.</span><span class="nx">path</span><span class="p">,(</span><span class="nx">file</span><span class="p">)=&gt;{</span>
<a id="__codelineno-153-39" name="__codelineno-153-39" href="#__codelineno-153-39"></a><span class="w">              </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="nx">src</span><span class="p">);</span>
<a id="__codelineno-153-40" name="__codelineno-153-40" href="#__codelineno-153-40"></a><span class="w">              </span><span class="k">this</span><span class="p">.</span><span class="nx">sourceLoaded</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span><span class="nx">file</span><span class="p">);</span>
<a id="__codelineno-153-41" name="__codelineno-153-41" href="#__codelineno-153-41"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-153-42" name="__codelineno-153-42" href="#__codelineno-153-42"></a><span class="w">          </span><span class="p">)</span>
<a id="__codelineno-153-43" name="__codelineno-153-43" href="#__codelineno-153-43"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-153-44" name="__codelineno-153-44" href="#__codelineno-153-44"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-153-45" name="__codelineno-153-45" href="#__codelineno-153-45"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-153-46" name="__codelineno-153-46" href="#__codelineno-153-46"></a>
<a id="__codelineno-153-47" name="__codelineno-153-47" href="#__codelineno-153-47"></a><span class="w">  </span><span class="nx">sourceLoaded</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span><span class="nx">file</span><span class="p">){</span>
<a id="__codelineno-153-48" name="__codelineno-153-48" href="#__codelineno-153-48"></a><span class="w">    </span><span class="nx">items</span><span class="p">[</span><span class="nx">src</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">file</span><span class="p">;</span>
<a id="__codelineno-153-49" name="__codelineno-153-49" href="#__codelineno-153-49"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-153-50" name="__codelineno-153-50" href="#__codelineno-153-50"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">toLoad</span><span class="p">){</span>
<a id="__codelineno-153-51" name="__codelineno-153-51" href="#__codelineno-153-51"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;allItemsLoaded&#39;</span><span class="p">)</span>
<a id="__codelineno-153-52" name="__codelineno-153-52" href="#__codelineno-153-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-153-53" name="__codelineno-153-53" href="#__codelineno-153-53"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-153-54" name="__codelineno-153-54" href="#__codelineno-153-54"></a><span class="p">}</span>
</code></pre></div>
For that we add an extra file where we store the sources and its paths as an array of objets
<div class="highlight"><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="c1">//sources.js</span>
<a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;asset1&#39;</span><span class="p">,</span>
<a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a><span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="s1">&#39;cubeTexture&#39;</span><span class="p">,</span>
<a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a><span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="p">[</span>
<a id="__codelineno-154-7" name="__codelineno-154-7" href="#__codelineno-154-7"></a><span class="w">      </span><span class="s1">&#39;text/px.jpg&#39;</span><span class="p">,</span>
<a id="__codelineno-154-8" name="__codelineno-154-8" href="#__codelineno-154-8"></a><span class="w">      </span><span class="s1">&#39;text/nx.jpg&#39;</span><span class="p">,</span>
<a id="__codelineno-154-9" name="__codelineno-154-9" href="#__codelineno-154-9"></a><span class="w">      </span><span class="p">...</span>
<a id="__codelineno-154-10" name="__codelineno-154-10" href="#__codelineno-154-10"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-154-11" name="__codelineno-154-11" href="#__codelineno-154-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-154-12" name="__codelineno-154-12" href="#__codelineno-154-12"></a><span class="p">]</span>
</code></pre></div></p>
<p>We then can listen to the <code>allItemsLoaded</code> event an execute further code
<div class="highlight"><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">World</span><span class="p">{</span>
<a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="w">  </span><span class="c1">//wait till resources are loaded</span>
<a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;allItemsLoaded&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Environment</span><span class="p">()</span>
<a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a><span class="p">}</span>
</code></pre></div></p>
<p>It also can be useful to create a own class for the <code>DebugUI</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">GUI</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lil-gui&#39;</span>
<a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Debug</span><span class="p">{</span>
<a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(){</span>
<a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="w">    </span><span class="c1">// this allows to only show the debug ui if acces the webisite with #debug at the end</span>
<a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a><span class="w">    </span><span class="c1">//we check if debug is present with window.location.hash</span>
<a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;#debug&#39;</span>
<a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a>
<a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">){</span>
<a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">ui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GUI</span>
<a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-156-12" name="__codelineno-156-12" href="#__codelineno-156-12"></a><span class="p">}</span>
</code></pre></div></p>
<p>It is also important that when the Three.js experience is not used any more or some objects get distroyed that need to properly clean up.
<div class="highlight"><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Experience</span><span class="p">{</span>
<a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a>
<a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a><span class="w">  </span><span class="nx">destroy</span><span class="p">(){</span>
<a id="__codelineno-157-5" name="__codelineno-157-5" href="#__codelineno-157-5"></a><span class="w">    </span><span class="c1">//sizes and till still gonna listen to the native JS events so we need to handle to stop listen to them as well </span>
<a id="__codelineno-157-6" name="__codelineno-157-6" href="#__codelineno-157-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">)</span>
<a id="__codelineno-157-7" name="__codelineno-157-7" href="#__codelineno-157-7"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;tick&#39;</span><span class="p">)</span>
<a id="__codelineno-157-8" name="__codelineno-157-8" href="#__codelineno-157-8"></a>
<a id="__codelineno-157-9" name="__codelineno-157-9" href="#__codelineno-157-9"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">traverse</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-157-10" name="__codelineno-157-10" href="#__codelineno-157-10"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="nx">child</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">){</span>
<a id="__codelineno-157-11" name="__codelineno-157-11" href="#__codelineno-157-11"></a><span class="w">        </span><span class="nx">child</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">dispose</span><span class="p">();</span>
<a id="__codelineno-157-12" name="__codelineno-157-12" href="#__codelineno-157-12"></a><span class="w">        </span><span class="c1">//Loop through material properties</span>
<a id="__codelineno-157-13" name="__codelineno-157-13" href="#__codelineno-157-13"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">){</span>
<a id="__codelineno-157-14" name="__codelineno-157-14" href="#__codelineno-157-14"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">child</span><span class="p">.</span><span class="nx">material</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-157-15" name="__codelineno-157-15" href="#__codelineno-157-15"></a>
<a id="__codelineno-157-16" name="__codelineno-157-16" href="#__codelineno-157-16"></a><span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">dispose</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;function&#39;</span><span class="p">)</span>
<a id="__codelineno-157-17" name="__codelineno-157-17" href="#__codelineno-157-17"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-157-18" name="__codelineno-157-18" href="#__codelineno-157-18"></a><span class="w">            </span><span class="nx">value</span><span class="p">.</span><span class="nx">dispose</span><span class="p">()</span>
<a id="__codelineno-157-19" name="__codelineno-157-19" href="#__codelineno-157-19"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-157-20" name="__codelineno-157-20" href="#__codelineno-157-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-157-21" name="__codelineno-157-21" href="#__codelineno-157-21"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-157-22" name="__codelineno-157-22" href="#__codelineno-157-22"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-157-23" name="__codelineno-157-23" href="#__codelineno-157-23"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">dispose</span><span class="p">()</span>
<a id="__codelineno-157-24" name="__codelineno-157-24" href="#__codelineno-157-24"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">dispose</span><span class="p">()</span>
<a id="__codelineno-157-25" name="__codelineno-157-25" href="#__codelineno-157-25"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">active</span><span class="p">){</span>
<a id="__codelineno-157-26" name="__codelineno-157-26" href="#__codelineno-157-26"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
<a id="__codelineno-157-27" name="__codelineno-157-27" href="#__codelineno-157-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-157-28" name="__codelineno-157-28" href="#__codelineno-157-28"></a>
<a id="__codelineno-157-29" name="__codelineno-157-29" href="#__codelineno-157-29"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-157-30" name="__codelineno-157-30" href="#__codelineno-157-30"></a><span class="p">}</span>
</code></pre></div></p>
<h1 id="own-hacks">Own hacks</h1>
<h2 id="tile-effect">Tile effect</h2>
<p>This often makes sense for big floor materials
<div class="highlight"><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">textureLoader</span><span class="p">.</span><span class="nx">load</span><span class="p">(...)</span>
<a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="nx">tex</span><span class="p">.</span><span class="nx">repeat</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="mf">2</span><span class="p">)</span>
<a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="nx">tex</span><span class="p">.</span><span class="nx">wrapS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tex</span><span class="p">.</span><span class="nx">wrapT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">THREE</span><span class="p">.</span><span class="nx">MirroredRepeatWrapping</span>
<a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a><span class="c1">//tex.wrapS = tex.wrapT = THREE.RepeatWrapping</span>
</code></pre></div></p>
<h1 id="interesting-tools">Interesting Tools</h1>
<h2 id="blender">Blender</h2>
<h3 id="path-conversion">Path conversion</h3>
<iframe src="https://github.com/ClassOutside/Export_Vertices_To_JSON">
https://github.com/ClassOutside/Blender_Path_To_Three.JS

# Ideas

Animate the field of view of the camera from long small to big field of view
![Idea](https://github.com/PineappleBeer/Three.JS-journey/raw/master/07-cameras/files/video-1.gif)

Create a scene where you only see the baked shadows. Use that to tell a story

Physics - on collision switch materials

Animate elements and have a model with black texture on black background so it negates the animated objects

Let shapes unrotated and rotate environment map or background of scene to create intresting effects







  
  






  <h2 id="__comments">Comments</h2>
  <script src="https://giscus.app/client.js"
  data-repo="levoxtrip/TKB"
  data-repo-id="R_kgDOM16hfQ"
  data-category-id="DIC_kwDOM16hfc4CjS9x"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="preferred_color_scheme"
  data-lang="en"
  data-loading="lazy"
  crossorigin="anonymous"
  async>
  </script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2025 <a href="https://github.com/levoxtrip" target="_blank" rel="noopener"> Leon Volbers</a>
<br> 
<a href = "https://www.patreon.com/c/techknowledgebase/membership?view_as=patron" style="font-size: 20px" font-color:"FFFFFF"> Support this project on Patreon</a>
 <br>
<script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="levoxtrip" data-color="#40DCA5" data-emoji="😍"  data-font="Arial" data-text="Support this project" data-outline-color="#000000" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>